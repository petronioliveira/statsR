<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="pt" xml:lang="pt"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.33">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>24&nbsp; Regressão Logística Binária – Bioestatística Usando o R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./glossario.html" rel="next">
<link href="./23-sobrevida.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-ea385d0e468b0dd5ea5bf0780b1290d9.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-364982630eef5352dd1537128a8ed5cb.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "Nenhum resultado",
    "search-matching-documents-text": "documentos correspondentes",
    "search-copy-link-title": "Copiar link para a busca",
    "search-hide-matches-text": "Esconder correspondências adicionais",
    "search-more-match-text": "mais correspondência neste documento",
    "search-more-matches-text": "mais correspondências neste documento",
    "search-clear-button-title": "Limpar",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancelar",
    "search-submit-button-title": "Enviar",
    "search-label": "Procurar"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="style.css">
</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Alternar barra lateral" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./21-testesDiag.html">Parte IX - Bioestatística Aplicada à Epidemiologia</a></li><li class="breadcrumb-item"><a href="./24-reglogbin.html"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Regressão Logística Binária</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Alternar barra lateral" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Procurar" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Bioestatística Usando o R</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Procurar"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Prefácio</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Parte I - Fundamentos</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Alternar seção">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introdução</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-dados.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Natureza dos Dados</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-producaoDados.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Produção dos Dados</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Parte II - Ambiente Computacional com R</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Alternar seção">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-introducaoR.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Introdução ao uso do R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-manipulandoDados.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Manipulando dados no R</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Parte III - Estatística Descritiva</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Alternar seção">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-medidasResumidoras.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Medidas Resumidoras</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-tabelas.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Tabelas</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-graficos.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Gráficos</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Parte IV - Probabilidades e Distribuições</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Alternar seção">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-probabilidades.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Introdução à Teoria das Probabilidades</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-assimetria.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Assimetria e Curtose</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-distAmostrais.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Distribuições Amostrais</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Parte V - Inferência Estatística</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Alternar seção">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-estimacao.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Estimação</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-testeHipoteses.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Teste de Hipóteses</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Parte VI - Testes Paramétricos</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Alternar seção">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14-teste-t.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Comparação entre duas médias</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15-anova.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Análise de Variância</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16-anovaRep.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Anova de Medidas Repetidas</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Parte VII - Relações entre Variáveis</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Alternar seção">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17-correlacao.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Correlação</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./18-regressao.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Regressão Linear Simples</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true">
 <span class="menu-text">Parte VIII - Métodos Não Paramétricos</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true" aria-label="Alternar seção">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./19-dadoscategoricos.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Análise de Dados Categóricos</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./20-testes-naoParametricos.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Métodos não paramétricos</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" role="navigation" aria-expanded="true">
 <span class="menu-text">Parte IX - Bioestatística Aplicada à Epidemiologia</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" role="navigation" aria-expanded="true" aria-label="Alternar seção">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-9" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./21-testesDiag.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Determinação da validade e confiabilidade de testes diagnósticos</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./22-medidasOcorrencia.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Medidas de ocorrência de doença</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./23-sobrevida.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Análise de Sobrevida</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./24-reglogbin.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Regressão Logística Binária</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./glossario.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Glossário</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./referencias.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Referências</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Índice</h2>
   
  <ul>
  <li><a href="#pacotes-necessários-neste-capítulo" id="toc-pacotes-necessários-neste-capítulo" class="nav-link active" data-scroll-target="#pacotes-necessários-neste-capítulo"><span class="header-section-number">24.1</span> Pacotes necessários neste capítulo</a></li>
  <li><a href="#introduçao" id="toc-introduçao" class="nav-link" data-scroll-target="#introduçao"><span class="header-section-number">24.2</span> Introduçao</a></li>
  <li><a href="#sec-logisticfunction" id="toc-sec-logisticfunction" class="nav-link" data-scroll-target="#sec-logisticfunction"><span class="header-section-number">24.3</span> Função Logistica</a></li>
  <li><a href="#pressupostos-da-regressão-logística" id="toc-pressupostos-da-regressão-logística" class="nav-link" data-scroll-target="#pressupostos-da-regressão-logística"><span class="header-section-number">24.4</span> Pressupostos da regressão logística</a></li>
  <li><a href="#dados-para-o-exemplo" id="toc-dados-para-o-exemplo" class="nav-link" data-scroll-target="#dados-para-o-exemplo"><span class="header-section-number">24.5</span> Dados para o exemplo</a>
  <ul class="collapse">
  <li><a href="#leitura-dos-dados" id="toc-leitura-dos-dados" class="nav-link" data-scroll-target="#leitura-dos-dados"><span class="header-section-number">24.5.1</span> Leitura dos dados</a></li>
  <li><a href="#explorando-e-preparando-os-dados" id="toc-explorando-e-preparando-os-dados" class="nav-link" data-scroll-target="#explorando-e-preparando-os-dados"><span class="header-section-number">24.5.2</span> Explorando e preparando os dados</a></li>
  <li><a href="#verificando-e-tratando-os-dados-omissos" id="toc-verificando-e-tratando-os-dados-omissos" class="nav-link" data-scroll-target="#verificando-e-tratando-os-dados-omissos"><span class="header-section-number">24.5.3</span> Verificando e tratando os dados omissos</a></li>
  <li><a href="#outras-transformações-necessárias" id="toc-outras-transformações-necessárias" class="nav-link" data-scroll-target="#outras-transformações-necessárias"><span class="header-section-number">24.5.4</span> Outras transformações necessárias</a></li>
  </ul></li>
  <li><a href="#construção-do-modelo-de-regressão-logística" id="toc-construção-do-modelo-de-regressão-logística" class="nav-link" data-scroll-target="#construção-do-modelo-de-regressão-logística"><span class="header-section-number">24.6</span> Construção do Modelo de Regressão Logística</a>
  <ul class="collapse">
  <li><a href="#divisão-dos-dados-em-treino-e-teste" id="toc-divisão-dos-dados-em-treino-e-teste" class="nav-link" data-scroll-target="#divisão-dos-dados-em-treino-e-teste"><span class="header-section-number">24.6.1</span> Divisão dos dados em Treino e Teste</a></li>
  <li><a href="#sec-modreglog" id="toc-sec-modreglog" class="nav-link" data-scroll-target="#sec-modreglog"><span class="header-section-number">24.6.2</span> Modelo de Regressão Logística</a></li>
  <li><a href="#visualização-da-regressão-logística" id="toc-visualização-da-regressão-logística" class="nav-link" data-scroll-target="#visualização-da-regressão-logística"><span class="header-section-number">24.6.3</span> Visualização da regressão logística</a></li>
  <li><a href="#remoção-de-variáveis-não-significativas" id="toc-remoção-de-variáveis-não-significativas" class="nav-link" data-scroll-target="#remoção-de-variáveis-não-significativas"><span class="header-section-number">24.6.4</span> Remoção de variáveis não significativas</a></li>
  <li><a href="#modelo-de-regreção-e-interação" id="toc-modelo-de-regreção-e-interação" class="nav-link" data-scroll-target="#modelo-de-regreção-e-interação"><span class="header-section-number">24.6.5</span> Modelo de regreção e interação</a></li>
  <li><a href="#sec-compararoc" id="toc-sec-compararoc" class="nav-link" data-scroll-target="#sec-compararoc"><span class="header-section-number">24.6.6</span> Curva ROC para comparar os modelos</a></li>
  <li><a href="#avaliação-do-modelo-de-regressão-logística" id="toc-avaliação-do-modelo-de-regressão-logística" class="nav-link" data-scroll-target="#avaliação-do-modelo-de-regressão-logística"><span class="header-section-number">24.6.7</span> Avaliação do Modelo de Regressão Logística</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./21-testesDiag.html">Parte IX - Bioestatística Aplicada à Epidemiologia</a></li><li class="breadcrumb-item"><a href="./24-reglogbin.html"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Regressão Logística Binária</span></a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Regressão Logística Binária</span></h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Código</button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="pacotes-necessários-neste-capítulo" class="level2" data-number="24.1">
<h2 data-number="24.1" class="anchored" data-anchor-id="pacotes-necessários-neste-capítulo"><span class="header-section-number">24.1</span> Pacotes necessários neste capítulo</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(caret, </span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>               dplyr,</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>               flextable,</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>               ggeffects,</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>               ggplot2,</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>               knitr,</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>               mice,</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>               patchwork,</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>               performance,</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>               pROC,</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>               readxl,</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>               sjPlot)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="introduçao" class="level2" data-number="24.2">
<h2 data-number="24.2" class="anchored" data-anchor-id="introduçao"><span class="header-section-number">24.2</span> Introduçao</h2>
<p>A <strong>regressão logística</strong> (também conhecida como <em>regressão logit</em> ou <em>modelo logit</em>) foi desenvolvida, em 1958, como um a extensão do modelo linear pelo estatístico britânico David Cox (1924-2022) <span class="citation" data-cites="cox1958regression">(<a href="referencias.html#ref-cox1958regression" role="doc-biblioref">1</a>)</span>. Pertence a uma família, denominada <em>Modelo Linear Generalizado</em> (GLM) e é um modelo de regressão em que o desfecho <em>Y</em> é categórico.</p>
<p>A regressão logística permite estimar a probabilidade de uma resposta categórica com base em uma ou mais variáveis preditoras (<em>X</em>). Possibilita informar se a presença de um preditor aumenta (ou diminui) a probabilidade de um determinado desfecho em uma porcentagem específica. No caso em que <em>Y</em> é binário - ou seja, assume apenas dois valores, <code>0</code> e <code>1</code>, que representam desfechos como aprovação/reprovação, sim/não, vivo/morto ou saudável/doente, tem-se a <strong>regressão logística binária</strong>.</p>
<p>Na regressão logística binária, as variáveis que afetam a probabilidade do resultado são medidas como <em>Odds Ratio</em>, que são chamadas de <strong>Odds Ratios ajustadas</strong> <span class="citation" data-cites="peat2014adjusted">(<a href="referencias.html#ref-peat2014adjusted" role="doc-biblioref">2</a>)</span>.</p>
<p>Na regressão linear, os valores das variáveis desfecho são preditos a partir de uma ou mais variáveis explicativas. Na regressão logística, uma vez que o desfecho é binário, a probabilidade de o desfecho ocorrer é calculada com base nos valores das variáveis explicativas. A regressão logística é semelhante à regressão linear na medida em que uma equação de regressão pode ser usada para prever a probabilidade de ocorrência de um desfecho. No entanto, a equação de regressão logística é expressa em termos logarítmicos (ou logits) e, portanto, os coeficientes de regressão devem ser convertidos para serem interpretados.</p>
<p>Embora as variáveis explicativas ou preditores no modelo possam ser variáveis contínuas ou categóricas, a regressão logística é mais adequada para medir os efeitos das exposições ou variáveis explicativas que são variáveis binárias. Variáveis contínuas podem ser incluídas, mas a regressão logística produzirá uma estimativa de risco para cada unidade de medida. Assim, a suposição de que o efeito de risco é linear sobre cada unidade da variável deve ser atendida e a relação não deve ser curva ou ter um ponto de corte sobre o qual o efeito ocorre. Além disso, as interações entre variáveis explicativas podem ser incluídas <span class="citation" data-cites="peat2014adjusted">(<a href="referencias.html#ref-peat2014adjusted" role="doc-biblioref">2</a>)</span>. Os casos em que a variável dependente tem mais de duas categorias de resultados podem ser analisados com <em>regressão logística multinomial</em>, não mostrada neste livro.</p>
</section>
<section id="sec-logisticfunction" class="level2" data-number="24.3">
<h2 data-number="24.3" class="anchored" data-anchor-id="sec-logisticfunction"><span class="header-section-number">24.3</span> Função Logistica</h2>
<p>Na regressão logística, para a estimação dos coeficientes (coeficientes <span class="math inline">\(\beta\)</span>) das variáveis independentes, utiliza-se o modelo logit <span class="citation" data-cites="hair2009analise">(<a href="referencias.html#ref-hair2009analise" role="doc-biblioref">3</a>)</span>:</p>
<p><span class="math display">\[
logit_{i} = ln(\frac{p}{1-p})=b_{0} + b_{1}x_{1} +...+ b_{n}x_{n}
\]</span> ou</p>
<p><span class="math display">\[
logit_{i} = ln(\frac{p}{1-p})=e^{b_{0} + b_{1}x_{1} +...+ b_{n}x_{n}}
\]</span></p>
<p>onde <em>p</em> é a probabilidade de desfecho.</p>
<p>A <strong>função logística</strong> transforma valores entre <span class="math inline">\(-\infty\)</span> a <span class="math inline">\(+\infty\)</span> em valores entre 0 e 1, de modo que os números que especificam as probabilidades estarão entre 0 e 1. Esse termo logarítmico é chamado de <span class="math inline">\(log_{OR}\)</span> (razão de chances logarítmica) ou <em>logit</em>. As chances (<em>odds</em>) associadas a alguma probabilidade são <span class="math inline">\(p/(1-p)\)</span>, o que é evidente se for entendido que um evento com chances <em>a</em> para <em>b</em> significa que em <span class="math inline">\(a+b\)</span> tentativas independentes e identicamente distribuídas, espera-se um sucesso. Portanto, a probabilidade de sucesso deve ser <span class="math inline">\(a/(a+b)\)</span>.</p>
<p>Invertendo, se a probabilidade de sucesso é <span class="math inline">\(a/(a+b)\)</span>, então a razão se torna <span class="math inline">\([a/(a+b)]/[1-a/(a+b)]\)</span> ou <span class="math inline">\(a/b\)</span>, que é a razão de chances ou <em>odds ratio</em>.</p>
<p>Para concluir o modelo, é necesário especificar a distribuição do desfecho <span class="math inline">\(Y_{i}\)</span>. Ela é binomial com probabilidade de sucesso <em>p</em>, de modo que nenhum parâmetro extra, como um desvio padrão, é necessário <span class="citation" data-cites="verzani2014reglog">(<a href="referencias.html#ref-verzani2014reglog" role="doc-biblioref">4</a>)</span>.</p>
<p>A regressão logística frequentemente utiliza a curva logística (<a href="#fig-curvalog" class="quarto-xref">Figura&nbsp;<span>24.1</span></a>) para assim representar a relação entre a variável dependente e as independentes. Os valores previstos, portanto permanecem entre 0 e 1, sendo definidos pelos coeficientes estimados.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-curvalog" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-curvalog-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="https://imgur.com/mBRglgO.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:50.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-curvalog-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;24.1: Curva de Regressão Logística Geral
</figcaption>
</figure>
</div>
</div>
</div>
<p>A estimação dos coeficientes na regressão logística, diferentemente da regressão múltipla que utiliza o método dos mínimos quadrados, é realizada através da <strong>máxima verossimilhança</strong>. Este método busca encontrar as estimativas mais prováveis dos coeficientes e maximizar a probabilidade de ocorrência de um evento. A qualidade do ajuste do modelo é avaliada pelo “pseudo” <span class="math inline">\(R^2\)</span> e pela análise da precisão preditiva (matriz de confusão).</p>
<p>O valor da verossimilhança (<em>likelihood</em>) é semelhante ao procedimento das somas dos quadrados na regressão múltipla, estimando o quão bem o método de máxima verossimilhança se ajusta ao modelo. O ajuste da estimação do modelo é dado pelo valor de -2 vezes o logaritmo da verossimilhança (-2LL), sendo que, quanto menor este valor, melhor o modelo <span class="citation" data-cites="stoltzfus2011logistic">(<a href="referencias.html#ref-stoltzfus2011logistic" role="doc-biblioref">5</a>)</span>.</p>
</section>
<section id="pressupostos-da-regressão-logística" class="level2" data-number="24.4">
<h2 data-number="24.4" class="anchored" data-anchor-id="pressupostos-da-regressão-logística"><span class="header-section-number">24.4</span> Pressupostos da regressão logística</h2>
<p>Para garantir que a regressão seja adequada, para melhorar a precisão do modelo, assumimos quatro pressupostos principais:</p>
<ol type="1">
<li><strong>Independência dos dados</strong>: o valor de uma observação não influencia ou afeta o valor de outras observações. Este é o pressuposto básico.</li>
<li><strong>Linearidade dos dados</strong>: a relação entre as variáveis independentes e a curva logística da variável dependente é considerada linear (quanto mais/menos de uma, mais/menos de outra). A linearidade dos dados pode ser verificada graficamente observando a dispersão dos resíduos com os valores previstos pela regressão.</li>
<li><strong>Independência dos erros/resíduos</strong>: os erros (resíduos) não devem possuir correlação. Este pressuposto pode ser testado pelo teste de Durbin-Watson (veja a <a href="18-regressao.html#sec-dw" class="quarto-xref"><span>Seção 18.5.3.2</span></a>) e observando o gráfico quantil-quantil (Q-Q) dos resíduos padronizados.</li>
<li><strong>Homogeneidade de Variância dos erros/resíduos</strong>: os erros devem ter média zero e desvio padrão constante ao longo das observações. Similar ao teste de Levene, mas aplicado aos resíduos da regressão. Pode ser testado usando o Teste de Breusch-Pagan (veja a <a href="18-regressao.html#sec-BP" class="quarto-xref"><span>Seção 18.5.3.1</span></a>).</li>
<li><strong>Ausência de Multicolinearidade</strong>: multicolinearidade é a ocorrência de alta correlação entre duas ou mais variáveis independentes e pode levar a resultados distorcidos. Em geral, a multicolinearidade pode fazer com que os intervalos de confiança se ampliem, ou até mudar o sinal de influência das variáveis independentes (de positivo para negativo, por exemplo). Portanto, as inferências estatísticas de uma regressão com multicolinearidade não são confiáveis. Pode ser testado usando o Fator de Inflação de Variância (<em>Variance Inflation Factor</em> – VIF, veja a <a href="#sec-vif" class="quarto-xref"><span>Seção 24.6.7.3</span></a>).</li>
</ol>
</section>
<section id="dados-para-o-exemplo" class="level2" data-number="24.5">
<h2 data-number="24.5" class="anchored" data-anchor-id="dados-para-o-exemplo"><span class="header-section-number">24.5</span> Dados para o exemplo</h2>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tragédia do Titanic
</div>
</div>
<div class="callout-body-container callout-body">
<p>O RMS Titanic (<a href="#fig-titanic" class="quarto-xref">Figura&nbsp;<span>24.2</span></a>), considerado o navio inafundável de sua época, sofreu um trágico destino em sua viagem inaugural com destino a Nova Iorque. Construído com o intuito de ser o maior e mais luxuoso transatlântico, o Titanic colidiu com um iceberg na noite de 14 de abril de 1912, no Oceano Atlântico Norte, afundando rapidamente e causando a morte de inúmeras pessoas.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-titanic" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-titanic-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="https://imgur.com/54il14d.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:50.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-titanic-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;24.2: Titanic parado em Queenstown, 11 de abril.de 1912
</figcaption>
</figure>
</div>
</div>
</div>
<p>O Titanic partiu em sua primeira e única viagem com 1 316 passageiros a bordo: 325 na primeira classe, 285 na segunda e 706 na terceira. Deles, 922 embarcaram em Southampton, 274 em Cherbourg-Octeville na França e 120 em Queenstown na Irlanda. Além desses passageiros, havia 908 tripulantes, totalizando m 2224 pessoas. O número total de mortos mais aceito é 1514, quase 70% dos que embarcaram na viagem <span class="citation" data-cites="wiki:xxx">(<a href="referencias.html#ref-wiki:xxx" role="doc-biblioref">6</a>)</span>.</p>
</div>
</div>
<p>Os dados de 1309 passageiros estão em um arquivo denominado <code>dadosTitanic.xlsx</code>, obtido no pacote <code>titanic</code>, modificado estruturalmente e traduzido, sem alterar os dados, para chegar a este arquivo que pode ser baixado <a href="https://github.com/petronioliveira/Arquivos/blob/main/dadosTitanic.xlsx">aqui</a>. Possui 1309 observações e 12 variáveis:</p>
<p>• <strong>id</strong> <span class="math inline">\(\to\)</span> identificação do passageiro<br>
• <strong>sobreviveu</strong> <span class="math inline">\(\to\)</span> 0 = não; 1 = sim<br>
• <strong>classe</strong> <span class="math inline">\(\to\)</span> classe do passageiro (categórica): 1 = 1ª classe; 2 = 2ª classe e 3 = 3ª classe (qualitativa)<br>
• <strong>nome</strong> <span class="math inline">\(\to\)</span> nome do passageiro (nominal)<br>
• <strong>sexo</strong> <span class="math inline">\(\to\)</span> masc = masculino; fem = feminino (binária)<br>
• <strong>idade</strong> <span class="math inline">\(\to\)</span> idade em anos (numérica contínua)<br>
• <strong>irco</strong> <span class="math inline">\(\to\)</span> número de irmãos/cônjuges a bordo (numérica discreta)<br>
• <strong>pafi</strong> <span class="math inline">\(\to\)</span> número de pais/filhos a bordo (numérica discreta)<br>
• <strong>ticket</strong> <span class="math inline">\(\to\)</span> número do bilhete de embarque (nominal)<br>
• <strong>tarifa</strong> <span class="math inline">\(\to\)</span> valor pago pela passagem em dólares (numérica contínua)<br>
• <strong>cabine</strong> <span class="math inline">\(\to\)</span> número de identificação da cabine (nominal)<br>
• <strong>porto_embarque</strong> <span class="math inline">\(\to\)</span> porto de embarque: C = Cherbourg, Q = Queenstown, S = Southampton</p>
<section id="leitura-dos-dados" class="level3" data-number="24.5.1">
<h3 data-number="24.5.1" class="anchored" data-anchor-id="leitura-dos-dados"><span class="header-section-number">24.5.1</span> Leitura dos dados</h3>
<p>Após fazer o download do banco de dados em seu diretório <a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>, carregue-o no <em>RStudio</em>, usando a função <code>read_excel()</code> do pacote <code>readxl</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>dadosTitanic <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">"dados/dadosTitanic.xlsx"</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="explorando-e-preparando-os-dados" class="level3" data-number="24.5.2">
<h3 data-number="24.5.2" class="anchored" data-anchor-id="explorando-e-preparando-os-dados"><span class="header-section-number">24.5.2</span> Explorando e preparando os dados</h3>
<p>Dê uma olhada nas variáveis do banco de dados. Para essa ação, pode-se usar a função <code>str()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(dadosTitanic)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>tibble [1,309 × 12] (S3: tbl_df/tbl/data.frame)
 $ id            : num [1:1309] 1 2 3 4 5 6 7 8 9 10 ...
 $ sobreviveu    : num [1:1309] 0 1 1 1 0 0 0 0 1 1 ...
 $ classe        : num [1:1309] 3 1 3 1 3 3 1 3 3 2 ...
 $ nome          : chr [1:1309] "Braund, Mr. Owen Harris" "Cumings, Mrs. John Bradley (Florence Briggs Thayer)" "Heikkinen, Miss. Laina" "Futrelle, Mrs. Jacques Heath (Lily May Peel)" ...
 $ sexo          : chr [1:1309] "masc" "fem" "fem" "fem" ...
 $ idade         : num [1:1309] 22 38 26 35 35 NA 54 2 27 14 ...
 $ irco          : num [1:1309] 1 1 0 1 0 0 0 3 0 1 ...
 $ pafi          : num [1:1309] 0 0 0 0 0 0 0 1 2 0 ...
 $ ticket        : chr [1:1309] "A/5 21171" "PC 17599" "STON/O2. 3101282" "113803" ...
 $ tarifa        : num [1:1309] 7.25 71.28 7.92 53.1 8.05 ...
 $ cabine        : chr [1:1309] NA "C85" NA "C123" ...
 $ porto_embarque: chr [1:1309] "S" "C" "S" "S" ...</code></pre>
</div>
</div>
<p>Observa-se que se tem um <em>tibble</em> com 1309 linhas (casos = passageiros) e 12 colunas (variáveis). Algumas dessas variáveis não terão utilidade para a análise de regressão logística: por exemplo, a coluna índice (<code>id</code>), o nome do passageiro, o número do ticket de embarque, a tarifa, o número da cabine e o porto de embarque. Elas serão removidas do banco de dados, usando a função <code>select()</code> do pacote <code>dplyr</code> (veja a <a href="05-manipulandoDados.html#sec-dadosMater" class="quarto-xref"><span>Seção 5.6</span></a>):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>dadosTitanic <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">select</span>(dadosTitanic, </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>                              <span class="sc">-</span><span class="fu">c</span>(id, nome, ticket, tarifa, cabine, porto_embarque))</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="verificando-e-tratando-os-dados-omissos" class="level3" data-number="24.5.3">
<h3 data-number="24.5.3" class="anchored" data-anchor-id="verificando-e-tratando-os-dados-omissos"><span class="header-section-number">24.5.3</span> Verificando e tratando os dados omissos</h3>
<p>Para verificar os NAs no banco de dados, pode-se usar o comando que soma os dados faltantes em cada coluna do banco de dados:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colSums</span>(<span class="fu">is.na</span>(dadosTitanic))</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>sobreviveu     classe       sexo      idade       irco       pafi 
         0          0          0        263          0          0 </code></pre>
</div>
</div>
<p>A coluna da variável <code>idade</code> contém 263 valores faltantes, ou seja, 20% estão ausentes. A melhor forma de tratar dados faltantes depende de diversos fatores, como <span class="citation" data-cites="Prabhakaran_2016">(<a href="referencias.html#ref-Prabhakaran_2016" role="doc-biblioref">7</a>)</span> :</p>
<ul>
<li><em>Mecanismo de geração dos dados faltantes</em>: Por que os dados estão faltando? É aleatório, relacionado a outras variáveis ou a alguma característica da população?<br>
</li>
<li><em>Quantidade de dados faltantes</em>: 263 valores faltantes representam uma proporção considerável dos dados (20%).<br>
</li>
<li><em>Impacto na análise</em>: Como a presença de dados faltantes pode afetar os resultados da sua análise?</li>
</ul>
<p>O que fazer?</p>
<ol type="1">
<li><strong>Exclusão de casos</strong>:</li>
</ol>
<!-- -->
<ol type="a">
<li><em>Listwise deletion</em>: Remover todas as observações com algum dado faltante. Não recomendado neste caso, pois você perderia uma quantidade significativa de dados.</li>
<li><em>Pairwise deletion</em>: Utilizar todas as observações disponíveis para cada análise. Pode gerar resultados inconsistentes.</li>
</ol>
<!-- -->
<ol start="2" type="1">
<li><strong>Imputação</strong>:</li>
</ol>
<!-- -->
<ol type="a">
<li><em>Imputação por média, mediana ou moda</em>: Substituir os valores faltantes pela média, mediana ou moda da variável. Simples, mas pode subestimar a variância.<br>
</li>
<li><em>Imputação por regressão</em>: Utilizar um modelo de regressão para prever os valores faltantes com base em outras variáveis. Mais preciso, mas pode ser enviesado se o modelo não for adequado.<br>
</li>
<li><em>Imputação múltipla</em>: Criar múltiplos conjuntos de dados, cada um com diferentes valores imputados, e combinar os resultados das análises. Método mais robusto e permite estimar a incerteza.<br>
</li>
<li><em>Imputação por K-Nearest Neighbors</em>: Substituir os valores faltantes pela média dos <em>k</em> vizinhos mais próximos. Útil para dados numéricos e pode capturar padrões locais.</li>
</ol>
<p>Considerando a quantidade de dados faltantes e a natureza da variável <code>idade</code>, a imputação múltipla é uma excelente opção. Ela permite lidar com a incerteza associada aos valores imputados e fornece uma estimativa mais precisa dos parâmetros do modelo. Para isso, será usada a função <code>mice()</code> do pacote <code>mice</code> (<em>Multivariate Imputation by Chained Equations</em>) <span class="citation" data-cites="van2011mice">(<a href="referencias.html#ref-van2011mice" role="doc-biblioref">8</a>)</span> para fazer a imputação múltipla. O argumento <code>m = 5</code> se refere ao número de múltiplas imputações (cinco é o padrão); <code>method = “pmm”</code> é o método de imputação, onde se usa a correspondência da média preditiva (predictive mean matching – dados numéricos) como método de imputação. O método <code>pmm</code> garante que os valores imputados sejam próximos de valores reais do conjunto de dados, mantendo a coerência estatística. A função <code>mice()</code> produz várias cópias completas de <em>dataframe</em>, cada uma com diferentes imputações dos dados ausentes. Essa transformação será atribuída a um objeto de nome <code>dados</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>dados <span class="ot">&lt;-</span> mice<span class="sc">::</span><span class="fu">mice</span>(dadosTitanic, <span class="at">m=</span><span class="dv">5</span>, <span class="at">method=</span><span class="st">"pmm"</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 iter imp variable
  1   1  idade
  1   2  idade
  1   3  idade
  1   4  idade
  1   5  idade
  2   1  idade
  2   2  idade
  2   3  idade
  2   4  idade
  2   5  idade
  3   1  idade
  3   2  idade
  3   3  idade
  3   4  idade
  3   5  idade
  4   1  idade
  4   2  idade
  4   3  idade
  4   4  idade
  4   5  idade
  5   1  idade
  5   2  idade
  5   3  idade
  5   4  idade
  5   5  idade</code></pre>
</div>
</div>
<p>A seguir, cria-se um novo dataframe com os dados imputados, usando a função <code>complete()</code>, também do pacote <code>mice</code>. Essa função retorna um ou vários desses conjuntos de dados, sendo que o padrão é o primeiro. Este novo conjunto de dados será atribuído ao objeto <code>dados_completos</code>. O comando escolhe a primeira imputação:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>dados_completos <span class="ot">&lt;-</span> mice<span class="sc">::</span><span class="fu">complete</span>(dados, <span class="dv">1</span>) </span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="analizando-os-dados_completos" class="level4" data-number="24.5.3.1">
<h4 data-number="24.5.3.1" class="anchored" data-anchor-id="analizando-os-dados_completos"><span class="header-section-number">24.5.3.1</span> Analizando os <code>dados_completos</code></h4>
<p>Novamente, se usará as funções <code>colSums(is.na())</code> e <code>str()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colSums</span>(<span class="fu">is.na</span>(dados_completos))</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>sobreviveu     classe       sexo      idade       irco       pafi 
         0          0          0          0          0          0 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(dados_completos)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   1309 obs. of  6 variables:
 $ sobreviveu: num  0 1 1 1 0 0 0 0 1 1 ...
 $ classe    : num  3 1 3 1 3 3 1 3 3 2 ...
 $ sexo      : chr  "masc" "fem" "fem" "fem" ...
 $ idade     : num  22 38 26 35 35 24 54 2 27 14 ...
 $ irco      : num  1 1 0 1 0 0 0 3 0 1 ...
 $ pafi      : num  0 0 0 0 0 0 0 1 2 0 ...</code></pre>
</div>
</div>
<p>Agora, existem 1309 observações e 7 variáveis. Os dados faltantes não estão mais presentes, foram substituídos.</p>
</section>
</section>
<section id="outras-transformações-necessárias" class="level3" data-number="24.5.4">
<h3 data-number="24.5.4" class="anchored" data-anchor-id="outras-transformações-necessárias"><span class="header-section-number">24.5.4</span> Outras transformações necessárias</h3>
<p>Ainda há necessidade de outras transformações, pois verifica-se que existem variáveis classificadas como numéricas (<code>classe</code>, <code>sexo</code> e a variável desfecho <code>sobreviveu</code>), mas que são fatores. Esta modificação será realizada, usando a função <code>mutate()</code> do pacote <code>dplyr</code>(veja a <a href="05-manipulandoDados.html#sec-dadosMater" class="quarto-xref"><span>Seção 5.6</span></a>):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>dados_completos <span class="ot">&lt;-</span> dados_completos <span class="sc">%&gt;%</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sexo =</span> <span class="fu">factor</span>(sexo)) <span class="sc">%&gt;%</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">classe =</span> <span class="fu">factor</span>(classe)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sobreviveu =</span> <span class="fu">factor</span>(sobreviveu))</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(dados_completos)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   1309 obs. of  6 variables:
 $ sobreviveu: Factor w/ 2 levels "0","1": 1 2 2 2 1 1 1 1 2 2 ...
 $ classe    : Factor w/ 3 levels "1","2","3": 3 1 3 1 3 3 1 3 3 2 ...
 $ sexo      : Factor w/ 2 levels "fem","masc": 2 1 1 1 2 2 2 2 1 1 ...
 $ idade     : num  22 38 26 35 35 24 54 2 27 14 ...
 $ irco      : num  1 1 0 1 0 0 0 3 0 1 ...
 $ pafi      : num  0 0 0 0 0 0 0 1 2 0 ...</code></pre>
</div>
</div>
<p>Finalmente, os dados estão prontos para se iniciar a análise de regressão logística <a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>.</p>
</section>
</section>
<section id="construção-do-modelo-de-regressão-logística" class="level2" data-number="24.6">
<h2 data-number="24.6" class="anchored" data-anchor-id="construção-do-modelo-de-regressão-logística"><span class="header-section-number">24.6</span> Construção do Modelo de Regressão Logística</h2>
<section id="divisão-dos-dados-em-treino-e-teste" class="level3" data-number="24.6.1">
<h3 data-number="24.6.1" class="anchored" data-anchor-id="divisão-dos-dados-em-treino-e-teste"><span class="header-section-number">24.6.1</span> Divisão dos dados em Treino e Teste</h3>
<p>A divisão dos dados em conjuntos de <em>treino</em> e <em>teste</em> é uma prática frequente em aprendizado de regressão logística. Serve para avaliar a performance de um modelo de forma imparcial precisa. O conjunto de Treino é a parte dos dados que o modelo utiliza para aprender as relações entre as variáveis independentes e a variável dependente. O modelo analisa esses dados para encontrar os melhores coeficientes que descrevem a relação entre as variáveis. O conjunto de Teste é a parte dos dados que o modelo não analisou durante o treinamento. Ele é utilizado para avaliar a capacidade do modelo de fazer previsões em novos dados. Ao comparar as previsões do modelo com os valores reais no conjunto de teste, podemos medir a sua precisão e generalização. Essa técnica é utilizada para evitar o excesso de ajuste dos dados (<em>overfitting</em>) <span class="citation" data-cites="subramanian2013over">(<a href="referencias.html#ref-subramanian2013over" role="doc-biblioref">9</a>)</span>, estimar a acurácia do modelo e comparação de modelos. A divisão mais comum é 70% para treinamento e 30% para teste, mas essa proporção pode variar dependendo do tamanho do conjunto de dados e da complexidade do problema.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Definindo a semente para reprodutibilidade</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Embaralhando os dados</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>dados_completos <span class="ot">&lt;-</span> dados_completos <span class="sc">%&gt;%</span> <span class="fu">sample_frac</span>(<span class="at">size =</span> <span class="dv">1</span>)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Definindo o ponto de corte para treino</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>split_index <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fl">0.7</span> <span class="sc">*</span> <span class="fu">nrow</span>(dados_completos))</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Dividindo os dados</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>dadosTreino <span class="ot">&lt;-</span> dados_completos <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span>split_index)</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>dadosTeste <span class="ot">&lt;-</span> dados_completos <span class="sc">%&gt;%</span> <span class="fu">slice</span>((split_index <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span><span class="fu">n</span>())</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualizando o tamanho das amostras</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(dadosTreino)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 916   6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(dadosTeste)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 393   6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Explorando a estrutura dos dadosTreino</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span> (dadosTreino)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   916 obs. of  6 variables:
 $ sobreviveu: Factor w/ 2 levels "0","1": 2 1 1 1 2 1 2 2 2 1 ...
 $ classe    : Factor w/ 3 levels "1","2","3": 3 1 2 3 1 1 2 2 3 1 ...
 $ sexo      : Factor w/ 2 levels "fem","masc": 2 2 2 2 1 2 1 1 1 2 ...
 $ idade     : num  44 47 30 40.5 44 45 0.92 24 22 38 ...
 $ irco      : num  0 0 0 0 0 0 1 1 2 0 ...
 $ pafi      : num  0 0 0 0 0 0 2 1 0 0 ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(dadosTeste)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   393 obs. of  6 variables:
 $ sobreviveu: Factor w/ 2 levels "0","1": 1 2 1 2 2 1 1 2 1 1 ...
 $ classe    : Factor w/ 3 levels "1","2","3": 1 3 3 3 1 2 3 1 3 3 ...
 $ sexo      : Factor w/ 2 levels "fem","masc": 2 1 2 2 1 2 1 1 2 1 ...
 $ idade     : num  30 18 7 25 60 30 9 22 51 28 ...
 $ irco      : num  1 0 4 0 1 1 3 0 0 0 ...
 $ pafi      : num  2 0 1 0 0 1 1 2 0 0 ...</code></pre>
</div>
</div>
<p>A função <code>sample_frac()</code> do pacote <code>dplyr</code> tem a função de embaralhar os dados para garantir a aleatoriedade; o argumento <code>size =1</code> significa a fração de linhas selecionadas (0 e 1), sendo 1 (u)m equivalente a 100% das linhas. A função <code>slice()</code>, também do pacote <code>dplyr</code>, primeiro seleciona as primeiras 70% observações para treino e as últimas 30% para teste. Por último, a função <code>str()</code>, visualiza os <code>dadosTreino</code> que serão utilizados na construção do modelo de regressão logística.</p>
</section>
<section id="sec-modreglog" class="level3" data-number="24.6.2">
<h3 data-number="24.6.2" class="anchored" data-anchor-id="sec-modreglog"><span class="header-section-number">24.6.2</span> Modelo de Regressão Logística</h3>
<p>Inicialmente, serão usados os <code>dadosTreino</code> para criar o modelo de regressão logística.</p>
<p>No modelo, a variável resposta ou desfecho é representada por <code>sobreviveu</code>; todas as outras variáveis são variáveis explicativas.</p>
<p>A função nativa <code>glm()</code> – <strong>g</strong>eneralized <strong>l</strong>inear <strong>m</strong>odel - é usada* para aplicar uma regressão logística no <em>R</em>. Sua funcionalidade é idêntica à função <code>lm()</code> da regressão linear. Necessita alguns argumentos:</p>
<ul>
<li><p><strong>formula</strong> <span class="math inline">\(\to\)</span> objeto da classe <em>formula</em>. Um preditor típico tem o formato <code>resposta \~ preditor</code> em que <code>resposta</code>, na regressão logística binária, é uma variável dicotômica e o <code>preditor</code> pode ser uma série de variáveis numéricas ou categóricas;</p></li>
<li><p><strong>family</strong> <span class="math inline">\(\to\)</span> uma descrição da distribuição de erro e função de <em>link</em> a ser usada no modelo <code>glm</code>, pode ser uma <em>string</em> que nomeia uma função de <em>family</em>. O padrão é <code>family = gaussian()</code>. No caso da regressão logística binária, <code>family = binomial()</code> ou <code>family = binomial (link =”logit”)</code>. Para outras informações, use <code>help(glm)</code> ou <code>help(family)</code>;</p></li>
<li><p><strong>data</strong> <span class="math inline">\(\to\)</span> banco de dados.</p></li>
</ul>
<p>Dentro dos parênteses da função <code>glm()</code>, são fornecidas informações essenciais sobre o modelo. À esquerda do til <code>(~)</code>, encontra-se a variável dependente, que deve ser codificada como 0 e 1 para que a função a interprete corretamente como binária. Após o til, são listadas as variáveis preditoras. Quando se utiliza um ponto (<code>~.</code>), isso indica a inclusão de todas as variáveis preditoras disponíveis. Já o uso do asterisco (<code>*</code>) entre duas variáveis preditoras especifica que, além dos efeitos principais, também deve ser considerado um termo de interação entre elas. No exemplo apresentado, essa análise, inicialmente, não será solicitada. Por fim, após a vírgula, define-se que a distribuição utilizada é a binomial. Como a função <code>glm</code> usa <code>logit</code> como link padrão para uma variável de desfecho binomial, não há necessidade de especificá-lo explicitamente no modelo.</p>
<p>O modelo inicial de regressão logística do tipo entrada forçada (<code>enter</code>), método padrão de conduzir uma regressão, que consiste em simplesmente colocar todos os preditores no modelo de regressão em um bloco e estimar parâmetros para cada um <span class="citation" data-cites="field2012logit">(<a href="referencias.html#ref-field2012logit" role="doc-biblioref">10</a>)</span>. O dataframe <code>dadosTreino.xlsx</code> será usado com todos os preditores dentro da função. O objeto criado será denominado de <code>modelo1</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>modelo1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(sobreviveu <span class="sc">~</span>., </span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> dadosTreino, </span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>))</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(modelo1)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = sobreviveu ~ ., family = binomial(link = "logit"), 
    data = dadosTreino)

Coefficients:
             Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  4.132611   0.422656   9.778  &lt; 2e-16 ***
classe2     -1.174431   0.277973  -4.225 2.39e-05 ***
classe3     -2.200140   0.266194  -8.265  &lt; 2e-16 ***
sexomasc    -3.550041   0.220317 -16.113  &lt; 2e-16 ***
idade       -0.032159   0.007728  -4.162 3.16e-05 ***
irco        -0.417165   0.114575  -3.641 0.000272 ***
pafi        -0.091018   0.116204  -0.783 0.433475    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 1210.4  on 915  degrees of freedom
Residual deviance:  715.0  on 909  degrees of freedom
AIC: 729

Number of Fisher Scoring iterations: 5</code></pre>
</div>
</div>
<section id="interpretação-dos-coeficientes" class="level4" data-number="24.6.2.1">
<h4 data-number="24.6.2.1" class="anchored" data-anchor-id="interpretação-dos-coeficientes"><span class="header-section-number">24.6.2.1</span> Interpretação dos Coeficientes</h4>
<p>Em uma regressão logística, a resposta que está sendo modelada é o <code>log(odds)</code> ou <code>logit</code> de que o desfecho é igual a 1. Os coeficientes de regressão fornecem a mudança no <code>log(odds)</code> no desfecho para a mudança de uma unidade na variável preditora, mantendo todas as outras variáveis preditivas constantes <span class="citation" data-cites="hosmer2013applied">(<a href="referencias.html#ref-hosmer2013applied" role="doc-biblioref">11</a>)</span>.</p>
<p>Na saída da função <code>summary()</code>, são produzidos os coeficientes da regressão na coluna <code>Estimate</code>, associados ao respectivos desvio padrão dos resíduos (<code>Std. Error</code>), o valor <code>z</code> (estatística de Wald) e os valores do <em>p</em> (<code>Pr(&gt;|t|</code>). Importante destacar que a hipótese nula dos coeficientes da regressão é de que “os coeficientes são nulos/zeros”. Então, os valores <em>P</em> devem ser interpretados como a probabilidade de se observar valores de coeficientes tão extremos dado que a hipótese nula é verdadeira. Estes coeficientes estão modelando a probabilidade do evento desfecho (<code>sobreviveu</code>) ocorrer com base nas variáveis explicativas: <code>sexo</code>, <code>idade</code>, <code>classe</code> do passageiro, número de irmãos/conjuges a bordo (<code>irco</code>) e número de pais/filhos a bordo (<code>pafi</code>) . Os coeficientes da regressão representam o impacto de cada variável explicativa na probabilidade de sobrevivência.</p>
<p>Nas <em>variáveis contínuas</em> , para cada aumento de uma unidade na <code>idade</code>, por exemplo, o <span class="math inline">\(log(odds)\)</span> de sobreviver <code>1 = sim</code> (versus <code>0 = não</code>) diminui, pois o coeficiente é negativo, em -0.0321593.</p>
<p>Para <em>variáveis categóricas</em>, o desempenho de cada categoria é avaliado em relação a uma categoria de base. A categoria de base para a variável <code>sexo</code> é o sexo feminino (primeira categoria que aparece quando se observa os níveis) e para a classe do passageiro é a 1ª classe.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(dadosTreino<span class="sc">$</span>sexo)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "fem"  "masc"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(dadosTreino<span class="sc">$</span>classe)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "1" "2" "3"</code></pre>
</div>
</div>
<p>Resumindo:</p>
<ul>
<li><strong>(Intercept)</strong>: Representa o <code>log(odds)</code> de sobreviver para um indivíduo com todas as variáveis explicativas iguais a zero (ou a sua categoria de referência). No contexto do Titanic, seria um indivíduo do sexo feminino, com idade zero e da 1ª classe. Não tem interpretação prática direta, nesse caso, pois não há passageiros com idade zero. Serve como ponto de partida para comparar os outros coeficientes.<br>
</li>
<li><strong>classe2</strong>: O coeficiente negativo indica que os passageiros da segunda classe tinham menor probabilidade de sobreviver comparados aos da primeira classe (a categoria de referência).<br>
</li>
<li><strong>classe3</strong>: O coeficiente negativo) indica que os passageiros da terceira classe tinham muito menor probabilidade de sobreviver comparados aos da primeira classe.</li>
<li><strong>sexomasc</strong>: O coeficiente negativo indica que ser do sexo masculino diminui significativamente a probabilidade de sobreviver, comparado a ser do sexo feminino (a categoria de referência). Ou seja, os homens tinham menos chances de sobreviver.<br>
</li>
<li><strong>idade</strong>: O coeficiente negativo indica que cada aumento de um ano na idade diminui ligeiramente a probabilidade de sobreviver. Isso sugere que as crianças tinham mais chances de sobreviver do que os adultos.<br>
</li>
<li><strong>irco</strong> : Ter mais irmãos ou cônjuges a bordo reduziu a chance de sobrevivência.</li>
<li><strong>pafi</strong>: O número de pais ou filhos a bordo não teve um efeito estatisticamente significativo na sobrevivência (valor <em>p</em> alto).</li>
</ul>
<p><u>Outras métricas da saída do sumário do modelo</u></p>
<ul>
<li><strong>Significância estatística</strong>: o R, para facilitar, informa com asteriscos quais variáveis possuem coeficientes estatisticamente significativos: * para <em>p</em> &lt; 0,05, ** para <em>p</em> &lt; 0,01, e *** para <em>p</em> &lt; 0,001.<br>
</li>
<li><strong>Deviance residual</strong>: Indica o ajuste do modelo; quanto menor, melhor.<br>
</li>
<li><strong>AIC (Critério de Informação de Akaike)</strong> <a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>: Ajuda a comparar modelos; quanto menor, melhor o ajuste e a simplicidade.</li>
</ul>
</section>
<section id="avaliação-do-impacto-com-a-função-anova" class="level4" data-number="24.6.2.2">
<h4 data-number="24.6.2.2" class="anchored" data-anchor-id="avaliação-do-impacto-com-a-função-anova"><span class="header-section-number">24.6.2.2</span> Avaliação do impacto com a função anova()</h4>
<p>Além de interpretar os coeficientes, mostrados na saída do sumário do modelo gerado pela função <code>glm()</code>, pode-se usar a função <code>anova()</code> para observar o impacto da adição de cada variável no modelo:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(modelo1, <span class="at">test=</span><span class="st">'Chisq'</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table

Model: binomial, link: logit

Response: sobreviveu

Terms added sequentially (first to last)

       Df Deviance Resid. Df Resid. Dev  Pr(&gt;Chi)    
NULL                     915    1210.44              
classe  2    63.38       913    1147.06 1.728e-14 ***
sexo    1   401.14       912     745.92 &lt; 2.2e-16 ***
idade   1    10.82       911     735.10  0.001004 ** 
irco    1    19.48       910     715.62 1.017e-05 ***
pafi    1     0.62       909     715.00  0.431231    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p><u>Principais pontos</u></p>
<ul>
<li><strong>NULL Deviance</strong>: Representa o desvio do modelo sem preditores (modelo apenas com o intercepto).</li>
<li><strong>Residual Deviance</strong>: Indica o desvio do modelo conforme as variáveis são adicionadas. Um menor valor de deviance indica um melhor ajuste.</li>
<li><strong>Pr(&gt;Chi)</strong>: Valor <em>p</em> do teste qui-quadrado para cada variável, verificando se sua inclusão melhora significativamente o modelo.</li>
</ul>
<p><u>Interpretação das variáveis</u></p>
<ul>
<li><strong>classe</strong>: A inclusão da classe do passageiro reduz significativamente o desvio (<em>deviance</em>), indicando que a classe é um preditor importante.</li>
<li><strong>sexo</strong>: O sexo é a variável que mais reduz o desvio, confirmando que ser mulher aumentava a chance de sobrevivência.</li>
<li><strong>idade</strong>: A idade tem um efeito significativo na sobrevivência, mas menor que classe e sexo</li>
<li><strong>irco</strong>: Número de irmãos/cônjuges tem um impacto relevante.</li>
<li><strong>pafi</strong>: O número de pais/filhos a bordo não melhora significativamente o modelo (<em>p</em> &gt; 0.05), sugerindo que essa variável não tem grande impacto na sobrevivência.</li>
</ul>
<p><u>Conclusão</u></p>
<p>O modelo sugere que <code>classe</code>, <code>sexo</code>, <code>idade</code> e <code>irco</code> (número de irmãos/cônjuges) são fatores relevantes para prever a sobrevivência. Por outro lado, número de pais/filhos não tem um impacto significativo. Isso pode indicar que ter viajado com crianças não afetou tanto a probabilidade de sobrevivência.</p>
</section>
<section id="uso-do-odds-ratio-or-na-interpretação-dos-coeficientes" class="level4" data-number="24.6.2.3">
<h4 data-number="24.6.2.3" class="anchored" data-anchor-id="uso-do-odds-ratio-or-na-interpretação-dos-coeficientes"><span class="header-section-number">24.6.2.3</span> Uso do Odds Ratio (OR) na interpretação dos coeficientes</h4>
<p>Numericamente, os coeficientes de regressão logística não são facilmente interpretáveis em escala bruta, pois estão representados como <code>log (odds)</code> ou <code>logit</code> . Para tornar mais simples, pode-se inverter a transformação logística exponenciando os coeficientes (<span class="math inline">\(e^x\)</span>). Isso faz com que os coeficientes se transformem em razões de chance (<em>odds ratio</em>), ficando mais intuitivos facilitando a interpretação. Isso é realizado pela função <code>exp()</code> e pela função <code>confint()</code>, que retorna os intervalos de confiança de 95%:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>odds_ratio1 <span class="ot">&lt;-</span> <span class="fu">round</span> (<span class="fu">exp</span>(<span class="fu">cbind</span>(<span class="at">OR =</span> <span class="fu">coef</span>(modelo1), <span class="fu">confint</span>(modelo1))), <span class="dv">3</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Waiting for profiling to be done...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(odds_ratio1)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                OR  2.5 %  97.5 %
(Intercept) 62.340 27.810 146.041
classe2      0.309  0.178   0.530
classe3      0.111  0.065   0.185
sexomasc     0.029  0.018   0.044
idade        0.968  0.954   0.983
irco         0.659  0.520   0.815
pafi         0.913  0.724   1.144</code></pre>
</div>
</div>
<p>Observando, novamente, a variável <code>idade</code>, vê-se que à medida que ela aumenta, reduz a chance de sobrevivência no naufrágio do Titanic. A <em>OR</em> nos informa que a cada aumento de uma unidade na <code>idade</code>, há uma diminuição na chance de sobrevivência (<code>sobreviveu = 1</code>) de <span class="math inline">\(1 – OR \times 100\)</span>%, ou seja, uma diminuição de 3.2%.<br>
Para o sexo masculino, há uma diminuição (coeficiente negativo) na chance de sobrevivência. O fato de ser homem reduz em 97.1% a chance de sobreviver.<br>
Para a 3ª classe, comparada à 1ª classe, há uma diminuição de 88.9% na chance de sobrevivência. Da mesma forma a 2ª classe, comparada à 1ª classe, tem uma diminuição de 69.1%% na chance de sobrevivência <a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a>.</p>
</section>
</section>
<section id="visualização-da-regressão-logística" class="level3" data-number="24.6.3">
<h3 data-number="24.6.3" class="anchored" data-anchor-id="visualização-da-regressão-logística"><span class="header-section-number">24.6.3</span> Visualização da regressão logística</h3>
<p>Uma maneira interessante de visualizar a regressão logística, pode ser feita usando a função <code>plot_model()</code> do pacote <code>sjPlot</code> <span class="citation" data-cites="ludecke2018sjplot">(<a href="referencias.html#ref-ludecke2018sjplot" role="doc-biblioref">12</a>)</span>. Essa função, como padrão, produz um gráfico de floresta (<em>forest plot</em>), onde é possível visualizar as variáveis no eixo vertical e o tamanho do efeito (OR), os coeficientes, no eixo horizontal (<a href="#fig-forest" class="quarto-xref">Figura&nbsp;<span>24.3</span></a>). Além disso, coeficientes positivos são representados com a cor azul e negativos em vermelho; e os intervalos de confiança 95% como uma linha ao redor do valor médio do coeficiente (ponto). Ao se especificar o tipo como <code>std</code> em <code>plot_model()</code>, o gráfico de floresta produzido utiliza os valores padronizados em desvios padrões.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>forest_raw <span class="ot">&lt;-</span> <span class="fu">plot_model</span>(modelo1)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>forest_std <span class="ot">&lt;-</span> <span class="fu">plot_model</span>(modelo1, <span class="at">type =</span> <span class="st">"std"</span>)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="fu">wrap_plots</span>(forest_raw, forest_std, <span class="at">nrow =</span> <span class="dv">2</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-forest" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-forest-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="24-reglogbin_files/figure-html/fig-forest-1.png" class="quarto-figure quarto-figure-center figure-img" style="width:80.0%;height:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-forest-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;24.3: Gráfico de Floresta dos Coeficientes de uma Regressão Logística em formato Odds Ratio
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="remoção-de-variáveis-não-significativas" class="level3" data-number="24.6.4">
<h3 data-number="24.6.4" class="anchored" data-anchor-id="remoção-de-variáveis-não-significativas"><span class="header-section-number">24.6.4</span> Remoção de variáveis não significativas</h3>
<p>A variável <code>pafi</code> mostrou-se não significativa no ajuste do <code>modelo1</code> e será removida da análise:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>modelo2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(sobreviveu <span class="sc">~</span> classe <span class="sc">+</span> sexo <span class="sc">+</span> idade <span class="sc">+</span> irco, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">'logit'</span>), <span class="at">data=</span>dadosTreino)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(modelo2)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = sobreviveu ~ classe + sexo + idade + irco, family = binomial(link = "logit"), 
    data = dadosTreino)

Coefficients:
             Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  4.058365   0.410689   9.882  &lt; 2e-16 ***
classe2     -1.166736   0.277821  -4.200 2.67e-05 ***
classe3     -2.187957   0.265584  -8.238  &lt; 2e-16 ***
sexomasc    -3.513748   0.214324 -16.395  &lt; 2e-16 ***
idade       -0.031576   0.007681  -4.111 3.94e-05 ***
irco        -0.441232   0.111044  -3.973 7.08e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 1210.44  on 915  degrees of freedom
Residual deviance:  715.62  on 910  degrees of freedom
AIC: 727.62

Number of Fisher Scoring iterations: 5</code></pre>
</div>
</div>
<p>Da mesma forma que com o <code>modelo1</code>, pode-se calcular, para tornar a interpretação mais intutiva, as <em>OR</em>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>odds.ratio2 <span class="ot">=</span> <span class="fu">exp</span>(<span class="fu">cbind</span>(<span class="at">OddsRatio =</span> <span class="fu">coef</span>(modelo2),<span class="fu">confint</span>(modelo2)))</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Waiting for profiling to be done...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(odds.ratio2)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              OddsRatio       2.5 %       97.5 %
(Intercept) 57.87958418 26.42265323 132.40635345
classe2      0.31138175  0.17935940   0.53372018
classe3      0.11214561  0.06592310   0.18701304
sexomasc     0.02978508  0.01932015   0.04481385
idade        0.96891685  0.95424718   0.98345433
irco         0.64324358  0.51093171   0.79039502</code></pre>
</div>
</div>
<p>Quando se compara os dois modelos para ver se houve uma melhora no ajuste, é interessante observar os AICs.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>aic <span class="ot">&lt;-</span> <span class="fu">AIC</span>(modelo1, modelo2)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>aic</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        df      AIC
modelo1  7 729.0010
modelo2  6 727.6205</code></pre>
</div>
</div>
<p>O <code>modelo1</code> tem uma AIC (729) discretamente maior que a do <code>modelo2</code> (727.62). Isto indica que o ajuste do <code>modelo2</code> é um pouco melhor (teve menos informação perdida no ajuste), entretanto, esta ligeira melhora não modifica a interpretação.A função <code>anova()</code>, que a diferença entre os modelos não é significativa (<em>p</em> &gt; 0.05):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(modelo1, modelo2, <span class="at">test =</span> <span class="st">"Chisq"</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table

Model 1: sobreviveu ~ classe + sexo + idade + irco + pafi
Model 2: sobreviveu ~ classe + sexo + idade + irco
  Resid. Df Resid. Dev Df Deviance Pr(&gt;Chi)
1       909     715.00                     
2       910     715.62 -1 -0.61951   0.4312</code></pre>
</div>
</div>
<p>Os dois modelo têm a mesma interpretação, mas o <code>modelo2</code> ajusta melhor os dados.</p>
</section>
<section id="modelo-de-regreção-e-interação" class="level3" data-number="24.6.5">
<h3 data-number="24.6.5" class="anchored" data-anchor-id="modelo-de-regreção-e-interação"><span class="header-section-number">24.6.5</span> Modelo de regreção e interação</h3>
<p>A interação entre variáveis pode ser crucial em modelos de regressão logística, pois pode revelar padrões que não são evidentes ao analisar cada variável separadamente. Usar interações pode tornar o modelo mais informativo, mas também mais complexo. Por isso, é sempre bom verificar métricas como AIC ou testes estatísticos para ver se a inclusão da interação realmente melhora a previsão.</p>
<p>Será construído um gráfico (<a href="#fig-interacao" class="quarto-xref">Figura&nbsp;<span>24.4</span></a>)), usando o pacote <code>ggeffects</code> e sua função <code>ggpredict()</code> <span class="citation" data-cites="ludecke2018ggeffects">(<a href="referencias.html#ref-ludecke2018ggeffects" role="doc-biblioref">13</a>)</span>. Este calcula os efeitos marginais a partir de modelos estatísticos e retorna o resultado como estruturas de dados organizadas. Essas estruturas de dados estão prontas para serem usadas com o pacote <code>ggplot2</code>. Os efeitos marginais podem ser calculados para muitos modelos diferentes, incluindo termos de interação. Junto será criado o modelo de interação (<code>modelo3</code>)</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>titanic_df <span class="ot">&lt;-</span> dadosTreino <span class="sc">%&gt;%</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span> pafi) <span class="sc">%&gt;%</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">classe =</span> <span class="fu">factor</span>(classe, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>), </span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"1ª Classe"</span>, <span class="st">"2ª Classe"</span>, <span class="st">"3ª Classe"</span>))) </span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>titanic_df <span class="ot">&lt;-</span> dadosTreino <span class="sc">%&gt;%</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span> pafi) <span class="sc">%&gt;%</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">classe =</span> <span class="fu">factor</span>(classe, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>), </span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>                         <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"1ª Classe"</span>, <span class="st">"2ª Classe"</span>, <span class="st">"3ª Classe"</span>))) </span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>modelo3 <span class="ot">&lt;-</span> <span class="fu">glm</span>(sobreviveu <span class="sc">~</span> sexo <span class="sc">*</span> classe <span class="sc">+</span> idade <span class="sc">+</span> irco, <span class="at">data =</span> titanic_df, <span class="at">family =</span> <span class="st">"binomial"</span>)</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(modelo3)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = sobreviveu ~ sexo * classe + idade + irco, family = "binomial", 
    data = titanic_df)

Coefficients:
                          Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)               5.034458   0.699711   7.195 6.24e-13 ***
sexomasc                 -4.455551   0.627851  -7.097 1.28e-12 ***
classe2ª Classe          -0.769215   0.789410  -0.974 0.329850    
classe3ª Classe          -3.437080   0.637079  -5.395 6.85e-08 ***
idade                    -0.036039   0.008232  -4.378 1.20e-05 ***
irco                     -0.425728   0.112655  -3.779 0.000157 ***
sexomasc:classe2ª Classe -0.920840   0.866889  -1.062 0.288129    
sexomasc:classe3ª Classe  1.754004   0.674646   2.600 0.009325 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 1210.44  on 915  degrees of freedom
Residual deviance:  690.23  on 908  degrees of freedom
AIC: 706.23

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>pred_effects <span class="ot">&lt;-</span> <span class="fu">ggpredict</span>(modelo3, <span class="at">terms =</span> <span class="fu">c</span>(<span class="st">"classe"</span>, <span class="st">"sexo"</span>))</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pred_effects, <span class="at">show_data =</span> <span class="cn">FALSE</span>, <span class="at">connect_lines =</span> T) <span class="sc">+</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Classe do Passageiro"</span>,</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Probabilidade Predita de Sobrevivência"</span>,</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Interação entre Sexo e Classe na Sobrevivência do Titanic"</span>, </span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"Sexo"</span>) <span class="sc">+</span></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"right"</span>) <span class="sc">+</span></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Ajustar limites do eixo Y para probabilidades (0 a 1)</span></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.1</span>),</span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>                     <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">add =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.05</span>)))</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-interacao" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-interacao-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="24-reglogbin_files/figure-html/fig-interacao-1.png" class="quarto-figure quarto-figure-center figure-img" style="width:80.0%;height:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-interacao-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;24.4: Gráfico de linha da interação sexo:classe
</figcaption>
</figure>
</div>
</div>
</div>
<p>O gráfico da <a href="#fig-interacao" class="quarto-xref">Figura&nbsp;<span>24.4</span></a> sugere uma interação entre <code>classe</code> e <code>sexo</code> na taxa de sobrevivência.</p>
<section id="interpretação-dos-coeficientes-gerados-no-modelo-com-interação" class="level4" data-number="24.6.5.1">
<h4 data-number="24.6.5.1" class="anchored" data-anchor-id="interpretação-dos-coeficientes-gerados-no-modelo-com-interação"><span class="header-section-number">24.6.5.1</span> Interpretação dos coeficientes gerados no modelo com interação</h4>
<p>Interpretar os coeficientes do modelo de interação em conjunto com o gráfico da <a href="#fig-interacao" class="quarto-xref">Figura&nbsp;<span>24.4</span></a> é fundamental. Os coeficentes são em escala <strong>logit</strong> e, para melhor interpretá-lo, há necessidade de exponenciá-los:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>odds_ratios <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="fu">cbind</span>(<span class="at">OddsRatio =</span> <span class="fu">coef</span>(modelo3), <span class="fu">confint</span>(modelo3)))</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Waiting for profiling to be done...</code></pre>
</div>
</div>
<p>O modelo com interação (<code>modelo3</code>) apresentou uma ajuste um pouco melhor, comparado com modelo sem interação (<code>modelo2</code>). Para a comparação, pode-se usar o AIC de ambos os modelos:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>aic <span class="ot">&lt;-</span> <span class="fu">AIC</span>(modelo2, modelo3)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>aic</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        df      AIC
modelo2  6 727.6205
modelo3  8 706.2294</code></pre>
</div>
</div>
<p>A saída mostra que existe uma diferença de 21.39 pontos. Isso é uma forte evidência que o modelo com a interação melhora o ajuste.<br>
O coeficiente de interação positivo como 1.7540036 não significa que homens da 3ª classe têm alta probabilidade de sobreviver. Significa que o efeito negativo de ser homem na 3ª classe é menos grave (ou a relação da classe com a sobrevivência é diferente para homens) do que seria previsto apenas pelos efeitos principais <code>sexomasc</code> e 3ª Classe somados linearmente. É uma correção para a relação aditiva simples.<br>
O gráfico mostra claramente que homens da 3ª classe têm uma probabilidade predita de sobrevivência bem baixa, que é a mais baixa de todas as categorias.</p>
<p>Desta forma, a interpretação é semelhante a que foi mostrada com o modelo sem interação:</p>
<ul>
<li>Ser mulher é um fator de sobrevivência extremamente forte.<br>
</li>
<li>Ser da 1ª classe é um fator de sobrevivência positivo.<br>
</li>
<li>Idade avançada e ter mais irmãos/cônjuges são fatores negativos para a sobrevivência.<br>
</li>
<li>Existe uma interação significativa onde a penalidade de ser homem (em termos de chances de sobrevivência) é diferente entre as classes, sendo muito mais forte nas classes superiores e menos acentuada (mas ainda presente) na 3ª classe (onde as chances já são globalmente baixas para todos, mas a queda de chances para mulheres da 3ª classe é mais drástica que para homens entre 2ª e 3ª).</li>
</ul>
<p>Portanto, deve-se manter o modelo com a interação (<code>modelo3</code>). Ele é mais preciso e oferece uma compreensão mais detalhada das complexas relações entre sexo, classe e sobrevivência (ajustado por <code>idade</code> e <code>irco</code>).</p>
<p>Para finalizar, será mostrada, na <a href="#fig-taxas" class="quarto-xref">Figura&nbsp;<span>24.5</span></a>, as taxas reais de sobrevivência, para comparar com a <a href="#fig-interacao" class="quarto-xref">Figura&nbsp;<span>24.4</span></a>, indicando que os homens da 3ª classe tiveram uma baixa taxa de sobrevivência, mesmo com o modelo de interação tenha mostrado um coeficiente positivo. Isto apenas mostra que atenuou o efeito.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Converter a variável "sobreviveu" para numérica, se necessário</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dadosTreino, </span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> classe, </span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> <span class="fu">factor</span>(sobreviveu))) <span class="sc">+</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">"fill"</span>) <span class="sc">+</span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> sexo) <span class="sc">+</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Proporção de sobrevivência por sexo e classe"</span>,</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Classe do passageiro"</span>, </span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Proporção"</span>,</span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Sobrevivência"</span>) <span class="sc">+</span></span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-taxas" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-taxas-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="24-reglogbin_files/figure-html/fig-taxas-1.png" class="quarto-figure quarto-figure-center figure-img" style="width:60.0%;height:60.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-taxas-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;24.5: Proporção de sobrevivência por sexo e classe
</figcaption>
</figure>
</div>
</div>
</div>
<p>Para comparar os modelos, estatisticamente, pode-se usar a função <code>anova()</code> do pacote <code>car</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>anova <span class="ot">&lt;-</span> <span class="fu">anova</span>(modelo2, modelo3, <span class="at">test =</span> <span class="st">"Chisq"</span>)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>anova</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table

Model 1: sobreviveu ~ classe + sexo + idade + irco
Model 2: sobreviveu ~ sexo * classe + idade + irco
  Resid. Df Resid. Dev Df Deviance  Pr(&gt;Chi)    
1       910     715.62                          
2       908     690.23  2   25.391 3.065e-06 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>A ANOVA mostra um valor <em>p</em> muito baixo, indicando uma diferença estatisricamente signficativa entre os modelos.</p>
</section>
</section>
<section id="sec-compararoc" class="level3" data-number="24.6.6">
<h3 data-number="24.6.6" class="anchored" data-anchor-id="sec-compararoc"><span class="header-section-number">24.6.6</span> Curva ROC para comparar os modelos</h3>
<p>A curva ROC é um gráfico permite explicar o desempenho do modelo avaliando a taxa de verdadeiros positivos (sensibilidade) versus a taxa de falsos positivos (<span class="math inline">\(1 - especificidade\)</span>). A AUC (Área sob a Curva ROC) indica a qualidade do modelo (veja também a <a href="21-testesDiag.html#sec-rocurve" class="quarto-xref"><span>Seção 21.6</span></a>):</p>
<ul>
<li><span class="math inline">\(AUC \approx 0.5\)</span> <span class="math inline">\(\to\)</span> O modelo não tem poder preditivo (equivalente ao puro acaso).<br>
</li>
<li><span class="math inline">\(AUC \gt 0.7\)</span> <span class="math inline">\(\to\)</span> Modelo razoável.<br>
</li>
<li><span class="math inline">\(AUC \gt 0.8\)</span> <span class="math inline">\(\to\)</span> Modelo muito bom.</li>
<li><span class="math inline">\(AUC \gt 0.9\)</span> <span class="math inline">\(\to\)</span> Excelebte desempenho.</li>
</ul>
<section id="predição-da-variável-desfecho-nos-modelos" class="level4" data-number="24.6.6.1">
<h4 data-number="24.6.6.1" class="anchored" data-anchor-id="predição-da-variável-desfecho-nos-modelos"><span class="header-section-number">24.6.6.1</span> Predição da variável desfecho nos modelos</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>prob_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(modelo2, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>prob_pred_int <span class="ot">&lt;-</span> <span class="fu">predict</span>(modelo3, <span class="at">type =</span> <span class="st">"response"</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="crição-de-um-objeto-roc" class="level4" data-number="24.6.6.2">
<h4 data-number="24.6.6.2" class="anchored" data-anchor-id="crição-de-um-objeto-roc"><span class="header-section-number">24.6.6.2</span> Crição de um objeto ROC</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>roc2<span class="ot">&lt;-</span> <span class="fu">roc</span>(<span class="at">response =</span> dadosTreino<span class="sc">$</span>sobreviveu, <span class="at">predictor =</span> prob_pred) </span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>roc3 <span class="ot">&lt;-</span> <span class="fu">roc</span>(<span class="at">response =</span> dadosTreino<span class="sc">$</span>sobreviveu, <span class="at">predictor =</span> prob_pred_int)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="plotar-a-curva-roc" class="level4" data-number="24.6.6.3">
<h4 data-number="24.6.6.3" class="anchored" data-anchor-id="plotar-a-curva-roc"><span class="header-section-number">24.6.6.3</span> Plotar a curva ROC</h4>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(roc2, </span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Curva ROC"</span>, </span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">print.auc =</span> <span class="cn">TRUE</span>, </span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">legacy.axes=</span><span class="cn">TRUE</span>,</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">print.auc.y =</span> <span class="fl">0.2</span>,</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab=</span><span class="st">"Sensibilidade"</span>,</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">"1 - Especificidade"</span>)</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(roc3, </span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">""</span>,</span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>     <span class="at">col=</span><span class="st">"tomato"</span>,</span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>     <span class="at">print.auc =</span> <span class="cn">TRUE</span>, </span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a>     <span class="at">legacy.axes=</span><span class="cn">TRUE</span>,</span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a>     <span class="at">print.auc.y =</span> <span class="fl">0.1</span>,</span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a>     <span class="at">add =</span><span class="cn">TRUE</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-comparemod" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-comparemod-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="24-reglogbin_files/figure-html/fig-comparemod-1.png" class="quarto-figure quarto-figure-center figure-img" style="width:60.0%;height:60.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-comparemod-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;24.6: Comparação das curvas ROC(modelo sem interação = preto; modelo com interação vermelho)
</figcaption>
</figure>
</div>
</div>
</div>
<p>As curvas ROC (<a href="#fig-comparemod" class="quarto-xref">Figura&nbsp;<span>24.6</span></a>) são muito semelhantes, com AUCs muito próximos.</p>
</section>
</section>
<section id="avaliação-do-modelo-de-regressão-logística" class="level3" data-number="24.6.7">
<h3 data-number="24.6.7" class="anchored" data-anchor-id="avaliação-do-modelo-de-regressão-logística"><span class="header-section-number">24.6.7</span> Avaliação do Modelo de Regressão Logística</h3>
<section id="matriz-de-confusão" class="level4" data-number="24.6.7.1">
<h4 data-number="24.6.7.1" class="anchored" data-anchor-id="matriz-de-confusão"><span class="header-section-number">24.6.7.1</span> Matriz de Confusão</h4>
<p>Primeiro foi feito o treinamento com o conjunto de dados dadosTreino. Agora, comparam-se as previsões (<code>pred_class</code>) com os valores reais (<code>dadosTeste$sobreviveu</code>). Para isso será necessário a função <code>confusionMatrix()</code> do pacote <code>caret</code>.</p>
<p><u>Fazendo previsões (probabilidades)</u></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>dadosTeste <span class="ot">&lt;-</span> dadosTeste <span class="sc">%&gt;%</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span> pafi) <span class="sc">%&gt;%</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">classe =</span> <span class="fu">factor</span>(classe, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>), </span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"1ª Classe"</span>, <span class="st">"2ª Classe"</span>, <span class="st">"3ª Classe"</span>))) </span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">234</span>)</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>pred_prob <span class="ot">&lt;-</span> <span class="fu">predict</span>(modelo3, <span class="at">newdata =</span> dadosTeste, <span class="at">type =</span> <span class="st">"response"</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A seguir, converte-se as probabilidades em classes (fatores):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>pred_class <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(pred_prob <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>pred_class <span class="ot">&lt;-</span> <span class="fu">factor</span>(pred_class, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><u>Criando a matriz de confusão</u></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>conf_matrix <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(pred_class, </span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>                               dadosTeste<span class="sc">$</span>sobreviveu, </span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>                               <span class="at">positive =</span><span class="st">"1"</span>)</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(conf_matrix)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction   0   1
         0 235  26
         1  17 115
                                          
               Accuracy : 0.8906          
                 95% CI : (0.8555, 0.9197)
    No Information Rate : 0.6412          
    P-Value [Acc &gt; NIR] : &lt;2e-16          
                                          
                  Kappa : 0.7588          
                                          
 Mcnemar's Test P-Value : 0.2225          
                                          
            Sensitivity : 0.8156          
            Specificity : 0.9325          
         Pos Pred Value : 0.8712          
         Neg Pred Value : 0.9004          
             Prevalence : 0.3588          
         Detection Rate : 0.2926          
   Detection Prevalence : 0.3359          
      Balanced Accuracy : 0.8741          
                                          
       'Positive' Class : 1               
                                          </code></pre>
</div>
</div>
<p>A tabela de contingência do início da matriz de confusão, mostra a comparação dos dados preditos e os dados reais (reference) e o significado de cada célula, onde <em>Classe 0</em> representa negativo e <em>Classe 1</em>, positivo.</p>
<p>A <strong>Acurácia</strong> (89.1%) é a proporção de previsões corretas. O modelo tem uma alta acurácia, isso indica um bom desempenho geral. Um modelo é considerado razoavelmente bom se a precisão do modelo for superior a 70%.<br>
A <strong>Sensibilidade (Recall)</strong> é a proporção de verdadeiros positivos (VP) identificados corretamente. O modelo o modelo identifica corretamete 81.6% dos verdadeiros positivos.<br>
A <strong>Especificidade</strong> é a proporção de verdadeiros negativos(VN). O modelo reconhece 93.3% dos verdadeiros negativos.<br>
O <strong>Valor P</strong> (<em>McNemar’s Test</em>) testa se há viés significativo na classificação dos erros. O valor alto (<em>P</em> = 0.222) sugere que os erros entre classes não são estatisticamente diferentes.<br>
O <strong>Kappa</strong> mede concordância ajustada para a distribuição dos dados. Um valor próximo de 1 indica boa concordância entre previsões e valores reais.<br>
O <strong>escore F1</strong> (não listado diretamente) representa o equilíbrio entre precisão e recall. Pode ser obtido pela equação:</p>
<p><span class="math display">\[
F1 = 2 \times \frac{VPN \times sensibilidade}{VPN + sensibilidade}
\]</span><br>
Ou consultando <code>conf_matrix$byClass[7]</code> (84.2%).</p>
<p>A <strong>Precisão (VPP)</strong> é a proporção de previsões positivas que estavam corretas, também denomonada de valor preditivo positivo (VPP). A precisão do modelo é igual 87.1, é considerada um valor alto.</p>
</section>
<section id="uso-da-curva-roc-para-avaliar-o-modelo" class="level4" data-number="24.6.7.2">
<h4 data-number="24.6.7.2" class="anchored" data-anchor-id="uso-da-curva-roc-para-avaliar-o-modelo"><span class="header-section-number">24.6.7.2</span> Uso da curva ROC para avaliar o modelo</h4>
<p>Avaliar um modelo de Regressão Logística no R, usando a curva ROC/AUC também é bem direto (veja <a href="#sec-compararoc" class="quarto-xref"><span>Seção 24.6.6</span></a> e <a href="21-testesDiag.html#sec-rocurve" class="quarto-xref"><span>Seção 21.6</span></a>). É uma abordagem bastante poderosa que permite visualizar os grupos no mesmo gráfico.</p>
<p><u>Obtenção das probabilidades de predição</u></p>
<p>Para se obter uma curva ROC, há necessidade das probabilidades previstas pelo modelo para a classe positiva (no exemplo, o nível 1 da variável <code>sobreviveu</code>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Probabilidades de predição no conjunto de teste</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="co"># O argumento 'type = "response"' garante que serão obtidas as probabilidades</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>prob_pred_teste <span class="ot">&lt;-</span> <span class="fu">predict</span>(modelo3, <span class="at">newdata =</span> dadosTeste, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Probabilidades de predição no conjunto de treino</span></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>prob_pred_treino <span class="ot">&lt;-</span> <span class="fu">predict</span>(modelo3,<span class="at">type =</span> <span class="st">"response"</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><u>Criação de objetos ROC</u></p>
<p>A seguir, serão criados os objetos ROC necessários para a construção das curvas ROC e calcular a área sob a curva (AUC):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>roc_obj_treino <span class="ot">&lt;-</span> <span class="fu">roc</span>(<span class="at">response =</span> dadosTreino<span class="sc">$</span>sobreviveu, <span class="at">predictor =</span> prob_pred_treino) </span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>roc_obj_teste <span class="ot">&lt;-</span> <span class="fu">roc</span>(<span class="at">response =</span> dadosTeste<span class="sc">$</span>sobreviveu, <span class="at">predictor =</span> prob_pred_teste) </span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>auc_valor_treino <span class="ot">&lt;-</span> <span class="fu">auc</span>(roc_obj_treino)</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>auc_valor_teste <span class="ot">&lt;-</span> <span class="fu">auc</span>(roc_obj_teste)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><u>Visualização da curva ROC</u></p>
<p>Com as informações obtidas, pode-se visualizar a curva ROC. Para criar um gráfico mais atraente, será usado, agora, o pacote <code>ggplot2</code>.<br>
inicialmente, serão criados dataframes com os dados para serem usados na função <code>ggplot()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Uma coluna chamada Model é adicionada para identificar qual curva pertence a qual modelo</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a><span class="co"># # Dataframe dos dados treino</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>dados_roc_treino <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">TFP =</span> <span class="dv">1</span> <span class="sc">-</span> roc_obj_treino<span class="sc">$</span>specificities,</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">TVP =</span> roc_obj_treino<span class="sc">$</span>sensitivities,</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">Model =</span> <span class="st">"Treino"</span>)</span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Dataframe dos dados teste</span></span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>dados_roc_teste <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">TFP =</span> <span class="dv">1</span> <span class="sc">-</span> roc_obj_teste<span class="sc">$</span>specificities,</span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">TVP =</span> roc_obj_teste<span class="sc">$</span>sensitivities,</span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">Model =</span> <span class="st">"Teste"</span>)</span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a>dados_roc_combinados <span class="ot">&lt;-</span> <span class="fu">rbind</span>(dados_roc_treino, dados_roc_teste)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Usando estes dois dataframes, obtemos a <a href="#fig-compareroc" class="quarto-xref">Figura&nbsp;<span>24.7</span></a></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dados_roc_combinados, </span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> TFP, <span class="at">y =</span> TVP, <span class="at">color =</span> Model)) <span class="sc">+</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"navy"</span>, <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Comparação de Curvas ROC"</span>,</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Taxa de Falsos Positivos (TFP)"</span>,</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Taxa de Verdadeiros Positivos (TVP)"</span>,</span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"Dados"</span>) <span class="sc">+</span> <span class="co"># Legenda para as cores</span></span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fl">0.6</span>, <span class="at">y =</span> <span class="fl">0.2</span>, <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">"AUC Teste ="</span>, <span class="fu">round</span>(auc_valor_teste, <span class="dv">2</span>)),</span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">"tomato"</span>, <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fl">0.6</span>, <span class="at">y =</span> <span class="fl">0.1</span>, <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">"AUC Treino ="</span>, <span class="fu">round</span>(auc_valor_treino, <span class="dv">2</span>)),</span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">"steelblue"</span>, <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Teste"</span> <span class="ot">=</span> <span class="st">"tomato"</span>,</span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"Treino"</span> <span class="ot">=</span> <span class="st">"steelblue"</span>)) <span class="sc">+</span></span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb68-16"><a href="#cb68-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-compareroc" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-compareroc-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="24-reglogbin_files/figure-html/fig-compareroc-1.png" class="quarto-figure quarto-figure-center figure-img" style="width:60.0%;height:60.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-compareroc-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;24.7: Desempenho do modelo treino e do modelo teste
</figcaption>
</figure>
</div>
</div>
</div>
<p>A <strong>Curva ROC</strong> mostra o quão bem seu modelo distingue entre as classes positiva e negativa em diferentes limites de classificação. Uma curva que se aproxima do canto superior esquerdo indica um modelo com bom poder de discriminação.</p>
<p>A <strong>AUC (Area Under the Curve)</strong> é um resumo numérico desse desempenho. Um valor de AUC de 1 significa um modelo perfeito, enquanto 0.5 indica um modelo que se comporta aleatoriamente (como jogar uma moeda para classificar). Quanto maior a AUC, melhor o desempenho geral do seu modelo em separar as classes. Em geral, uma AUC acima de 0.7 é considerada razoável, acima de 0.8 é boa e acima de 0.9 é excelente.</p>
<p>A AUC Teste = 0.91 é considerada <strong>excelente</strong>. Isso significa que o modelo tem uma capacidade muito alta de distinguir entre as classes positiva e negativa no conjunto de dados não visto (teste). Uma AUC Treino = 0.9 também é um desempenho muito forte. A diferença entre as duas é mínima (0.02). Isso é um sinal extremamente positivo. Significa que o modelo não está sofrendo de:</p>
<ul>
<li><strong>Overfitting</strong> (sobreajuste): Se houvesse <em>overfitting</em>, a AUC de treino seria significativamente mais alta que a AUC de teste, indicando que o modelo “memorizou” os dados de treino e não generaliza bem para dados novos.<br>
</li>
<li><strong>Underfitting</strong> (subajuste): Se houvesse <em>underfitting</em>, ambas as AUCs seriam baixas, indicando que o modelo não aprendeu os padrões nos dados.</li>
</ul>
<p>Concluindo o modelo de regressão logística apresentou um excelente desempenho e está generalizando muito bem para novos dados. A performance consistente entre treino e teste é um indicativo de um modelo robusto e confiável para a tarefa de classificação.</p>
</section>
<section id="sec-vif" class="level4" data-number="24.6.7.3">
<h4 data-number="24.6.7.3" class="anchored" data-anchor-id="sec-vif"><span class="header-section-number">24.6.7.3</span> Outras avaliações do modelo</h4>
<p><u>Linearidade e Colinearidade</u></p>
<p>Esta suposição pode ser testada de diversas maneiras. O pacote <code>performance</code> (moderno e abrangente), usando a função <code>check_model()</code> faz várias verificações que inclui a linearidade de forma visual (<a href="#fig-linearidade" class="quarto-xref">Figura&nbsp;<span>24.8</span></a>) e <a href="#fig-linearidade2" class="quarto-xref">Figura&nbsp;<span>24.9</span></a>), para preditores contínuos através de resíduos parciais. Serão avaliados os dois modelos (<code>modelo2</code> e <code>modelo3</code>)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">check_model</span>(modelo2, <span class="at">residual_type =</span> <span class="st">"normal"</span>))</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-linearidade" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-linearidade-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="https://imgur.com/t4WqHJA.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-linearidade-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;24.8: Avaliação do modelo com foco na linearidade
</figcaption>
</figure>
</div>
</div>
</div>
<p>O <code>modelo3</code> (com interação sexo:classe) que em outras testagens ele teve um melhor ajuste, será avaliado:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">check_model</span>(modelo3, <span class="at">residual_type =</span> <span class="st">"normal"</span>))</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-linearidade2" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-linearidade2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="https://i.imgur.com/hH8aPw7.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-linearidade2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;24.9: Avaliação do modelo com interação com foco na linearidade
</figcaption>
</figure>
</div>
</div>
</div>
<p>Os gráficos gerados incluem diversas verificações fundamentais que devem ser observadas comparativamente nas <a href="#fig-linearidade" class="quarto-xref">Figura&nbsp;<span>24.8</span></a> e <a href="#fig-linearidade2" class="quarto-xref">Figura&nbsp;<span>24.9</span></a>.</p>
<ul>
<li><p><strong>Verificação preditiva posterior</strong> (<em>Posterior Predictive Check</em>) – Compara os dados observados com os preditos pelo modelo. Os intervalos do modelo devem incluir os pontos observados. Comparando os dois modelos, os pontos observados os parecem ter um alinhamento dos intervalos preditivos semelhantes.</p></li>
<li><p><strong>Resíduos agrupados</strong> (<em>Binned Residuals</em>) – Avalia se há padrões nos resíduos. Pontos vermelhos indicam desvios que podem sugerir problemas de ajuste. Aqui, o modelo de interação tem uma maior quantidade de pontos fora do intervalo de erro.</p></li>
<li><p><strong>Observações Influentes</strong> (<em>Influential Observations</em>) – Identifica pontos com alta influência no modelo, o que pode indicar necessidade de ajustes ou remoção de <em>outliers</em>. Ambos os modelos não parecem ter pontos pontos influentes. A inclusão da interação não impactou muito quais observações têm maior peso sobre o modelo.</p></li>
<li><p><strong>Colinearidade</strong> – Exibe o VIF (Fator de Inflação da Variância) das variáveis preditoras. Valores altos (acima de 5) podem indicar problemas de multicolinearidade. Na comparação dos dois modelos, este é um ponto importante, pois com a introdução da interação, os VIFs ficaram elevados. Pode significar que as variáveis interagem de forma redundante, prejudicando a interpretação dos coeficientes. O VIF pode ser também obtido para cada variável, usando a função <code>vif()</code> do pacote <code>car</code>:</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>vif_valores <span class="ot">&lt;-</span> car<span class="sc">::</span><span class="fu">vif</span>(modelo2)</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(vif_valores)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           GVIF Df GVIF^(1/(2*Df))
classe 1.412679  2        1.090212
sexo   1.227434  1        1.107896
idade  1.321484  1        1.149558
irco   1.150439  1        1.072585</code></pre>
</div>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>vif_valores2 <span class="ot">&lt;-</span> car<span class="sc">::</span><span class="fu">vif</span>(modelo3)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>there are higher-order terms (interactions) in this model
consider setting type = 'predictor'; see ?vif</code></pre>
</div>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(vif_valores2)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                 GVIF Df GVIF^(1/(2*Df))
sexo         9.784418  1        3.128005
classe      29.369362  2        2.327950
idade        1.361342  1        1.166766
irco         1.145677  1        1.070363
sexo:classe 38.152833  2        2.485316</code></pre>
</div>
</div>
<ul>
<li><strong>Normalidade dos Resíduos</strong> (<em>Normality of Residuals</em>) – Usa um gráfico Q-Q para verificar se os resíduos seguem uma distribuição normal. Desvios sistemáticos podem sinalizar problemas. Ambos, como era de esperar, parecem não ter uma distribuição normal. Entretanto, ao contrário da regressão linear, a regressão logística não assume a normalidade dos resíduos. Os resíduos de um modelo de regressão logística não se distribuem normalmente, pois a variável resposta é binária (0 ou 1) e o modelo prediz probabilidades.</li>
</ul>
<p>Concluindo, com esses resultados, parece que a interação <code>sexo:classe</code> não agregou muito ao modelo. Ela aumentou a colinearidade e fez os resíduos se tornarem menos confiáveis, sem impacto positivo claro nas previsões.</p>
<p><u>Razão de Verossimilhança</u></p>
<p>Em estatística, a verossimilhança (<strong>Likelihood</strong>) de um modelo é uma medida da probabilidade de observar os dados amostrais que temos, dada uma certa configuração dos parâmetros do modelo. Em outras palavras, ela nos diz quão “provável” é que o modelo, com seus coeficientes estimados, tenha gerado os dados que observamos.</p>
<p>No contexto da regressão logística, os parâmetros do modelo (os coeficientes <span class="math inline">\(\beta\)</span>) são estimados usando o método de <strong>máxima verossimilhança</strong> (veja também <a href="#sec-logisticfunction" class="quarto-xref"><span>Seção 24.3</span></a>). Esse método busca encontrar os valores dos coeficientes que maximizam a probabilidade de que os eventos observados (por exemplo, “sucesso” ou “fracasso” da variável dependente) tenham ocorrido.</p>
<p>A <strong>razão de verossimilhança (-2LL)</strong>, ou mais precisamente, <strong>-2 vezes o logaritmo da verossimilhança</strong>, é uma medida de desajuste do modelo. É uma transformação do valor da verossimilhança que é mais conveniente para cálculos e interpretação.</p>
<p>Matematicamente, ela é expressa como:<span class="math display">\[-2LL=-2 \times ln(L)\]</span> Onde:</p>
<ul>
<li>L é a verossimilhança do modelo</li>
<li>ln é o logaritmo natural</li>
</ul>
<p>Quanto <strong>menor</strong> o valor de -2LL, <strong>melhor</strong> é o ajuste do modelo aos dados. Isso ocorre porque um modelo com um bom ajuste tem uma verossimilhança (L) maior, e como -2LL envolve o logaritmo negativo da verossimilhança, um L maior resulta em um -2LL menor.</p>
<p>A importância do -2LL reside principalmente em sua utilização para realizar o <strong>Teste da Razão de Verossimilhança (Likelihood Ratio Test)</strong>. Este teste compara a qualidade do ajuste de dois modelos:</p>
<ol type="1">
<li><strong>Modelo Nulo (ou Modelo Base)</strong>: Um modelo mais simples, geralmente contendo apenas a constante (intercepto), sem as variáveis preditoras de interesse.</li>
<li><strong>Modelo Proposto</strong>: O modelo completo que se está testando, que inclui as variáveis preditoras.</li>
</ol>
<p>O teste da razão de verossimilhança calcula a diferença entre o -2LL do modelo nulo e o -2LL do modelo proposto:</p>
<p><span class="math display">\[G = (-2LL _{Modelo \ Nulo}) - (-2LL_{Modelo \ Proposto})\]</span> Essa estatística G segue uma distribuição qui-quadrado (<span class="math inline">\(\chi^2\)</span>) com graus de liberdade iguais à diferença no número de parâmetros entre os dois modelos.Um valor G grande e estatisticamente significativo (com um p-valor baixo), indica que o modelo proposto se ajusta significativamente melhor aos dados do que o modelo nulo (sem as variáveis preditoras). Isso sugere que as variáveis independentes no modelo contribuem para explicar a variável dependente.<br>
O -2LL do modelo nulo (<code>Null deviance</code>) e do modelo proposto (<code>Residual deviance</code>) podem ser verificados através de:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>modelo2<span class="sc">$</span>null.deviance</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1210.441</code></pre>
</div>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>modelo2<span class="sc">$</span>deviance</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 715.6205</code></pre>
</div>
</div>
<p>O cálculo da estatística G (Teste da Razão de Verossimilhança) pode ser obtido, como visto pela diferença entre deviance do modelo nulo e do modelo ajustado:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>estatistica_G <span class="ot">&lt;-</span> modelo2<span class="sc">$</span>null.deviance <span class="sc">-</span> modelo2<span class="sc">$</span>deviance </span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(estatistica_G)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 494.8204</code></pre>
</div>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Graus de liberdade para o teste G</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>df_G <span class="ot">&lt;-</span> modelo2<span class="sc">$</span>df.null <span class="sc">-</span> modelo2<span class="sc">$</span>df.residual</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(df_G)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Teste de significância </span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>valor_p <span class="ot">&lt;-</span> <span class="fu">format</span>(<span class="dv">1</span> <span class="sc">-</span> <span class="fu">pchisq</span>(estatistica_G, </span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>                             <span class="at">df =</span> df_G), </span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">sientific =</span> <span class="cn">TRUE</span>)</span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(valor_p)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "0"</code></pre>
</div>
</div>
<p>O valor <em>P</em> é extremamente baixo, isso é interpretado como uma diferença altamente significativa entre os modelos. No contexto de teste de verossimilhança, isso sugere que o modelo mais complexo se ajusta significativamente melhor do que o modelo nulo.</p>
<p><u>Estatística <span class="math inline">\(R^2\)</span></u></p>
<p><strong>R ao quadrado</strong> é uma métrica útil para a avaliação da regressão linear simples e múltipla, mas não tem o mesmo significado na regressão logística.<br>
Os estatísticos criaram análogos do <span class="math inline">\(R^2\)</span> para regressão logística referidas, coletivamente, como <strong>pseudo R ao quadrado</strong>. Este não tem a mesma interpretação, na medida em que não é simplesmente a proporção da variância explicada pelo modelo.<br>
Existem muitas maneiras diferentes de calcular um <span class="math inline">\(R^2\)</span> para regressão logística e nenhum consenso sobre qual é a melhor. Os dois métodos mais frequentemente relatados em softwares estatísticos são um proposto por McFadden <span class="citation" data-cites="mcfadden1974conditional">(<a href="referencias.html#ref-mcfadden1974conditional" role="doc-biblioref">14</a>)</span> e outro por Cox-Snell <span class="citation" data-cites="CoxSnell1989analysis">(<a href="referencias.html#ref-CoxSnell1989analysis" role="doc-biblioref">15</a>)</span>. Também é bastante relatado o de Nagelkerke <span class="citation" data-cites="nagelkerke1991note">(<a href="referencias.html#ref-nagelkerke1991note" role="doc-biblioref">16</a>)</span>. Os valores mais altos indicam um melhor ajuste do modelo.</p>
<p>O <span class="math inline">\(R^2\)</span> de McFadden é uma versão, baseada no <em>log-likelihood</em> para o modelo somente com o intercepto e o modelo estimado completo. O <span class="math inline">\(R^2\)</span> de Cox e Snell é baseado no l<em>og-likelihood</em> para o modelo em comparação com o <em>log-likelihood</em> para um modelo basal. No entanto, com resultados categóricos, tem um valor máximo teórico inferior a 1, mesmo para um modelo “perfeito”.<br>
O <span class="math inline">\(R^2\)</span> de Nagelkerke é uma versão ajustada do <span class="math inline">\(R^2\)</span> de Cox e Snell que ajusta a escala da estatística para cobrir todo o intervalo de 0 a 1.<br>
Pode-se obter os vários valores de <span class="math inline">\(R^2\)</span>, usando a função <code>PseudoR2()</code> do pacote <code>DescTools</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DescTools)</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="fu">PseudoR2</span>(modelo2, <span class="at">which =</span><span class="fu">c</span>(<span class="st">"Nagelkerke"</span>, <span class="st">"McFadden"</span>, <span class="st">"CoxSnell"</span>))</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Nagelkerke   McFadden   CoxSnell 
 0.5692011  0.4087935  0.4173665 </code></pre>
</div>
</div>
<p>Como se verifica, na Saída do código, todos os valores de <span class="math inline">\(R^2\)</span> diferem ligeiramente, mas podem ser usados como medidas de tamanho de efeito para o modelo. Então, basicamente, o pseudo R quadrado pode ser interpretado como <span class="math inline">\(R^2\)</span>, mas não se espera que seja tão grande. Uma regra prática, bastante útil é que o pseudo R quadrado de McFadden variando de 0,2 a 0,4 indica um ajuste muito bom do modelo <span class="citation" data-cites="mcfadden2021quantitative">(<a href="referencias.html#ref-mcfadden2021quantitative" role="doc-biblioref">17</a>)</span>.</p>
<p><u>Pesquisa de valores atípicos e pontos de alavancagem</u></p>
<p>Um <em>outlier</em> é uma observação que não é bem prevista pelo modelo de regressão ajustado (ou seja, tem um grande resíduo positivo ou negativo). Uma observação com um alto valor de alavancagem possui uma combinação incomum de valores preditores. Ou seja, é um <em>outlier</em> no espaço do preditor.<br>
Uma observação influente é uma observação que tem um impacto desproporcional na determinação dos parâmetros do modelo. As observações influentes são identificadas usando uma estatística chamada <em>distância de Cook</em> ou <em>D de Cook</em>.</p>
<p>A identificação dos <em>outliers</em> é feita essencialmente através dos resíduos padronizados <span class="citation" data-cites="bobbitt2020residuals">(<a href="referencias.html#ref-bobbitt2020residuals" role="doc-biblioref">18</a>)</span>, com a função <code>rstandard()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>residuos_p <span class="ot">&lt;-</span> <span class="fu">rstandard</span>(modelo2)</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(residuos_p)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
-2.68164 -0.53537 -0.36506 -0.05421  0.52679  2.66549 </code></pre>
</div>
</div>
<p>Em uma amostra normalmente distribuída, ao redor de 95% dos valores estão entre –1,96 e +1,96, 99% deve estar entre –2,58 e +2,58 e quase todos (99,9%) devem situar-se entre –3,09 e +3,09. Portanto, resíduos padronizados com um valor absoluto maior que 3 são motivo de preocupação porque em uma amostra média é improvável que aconteça um valor tão alto por acaso <span class="citation" data-cites="field2012outliers">(<a href="referencias.html#ref-field2012outliers" role="doc-biblioref">19</a>)</span>. Na Saída da função <code>rstandard()</code>, observa-se que os valores estão dentro de –3 e +3.</p>
<p>Essa avaliação pode ser acompanhada de um gráfico diagnóstico, usando a função <code>plot()</code> para o modelo <code>modelo2</code>(para maiores detalhes veja as <a href="18-regressao.html#sec-graphdiag" class="quarto-xref"><span>Seção 18.5.1</span></a> e <a href="18-regressao.html#sec-BP" class="quarto-xref"><span>Seção 18.5.3.1</span></a>).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span> (modelo2, <span class="at">which =</span> <span class="dv">5</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-graph5" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center" data-fig-pos="H">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-graph5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="24-reglogbin_files/figure-html/fig-graph5-1.png" class="quarto-figure quarto-figure-center figure-img" style="width:60.0%;height:60.0%" data-fig-pos="H">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-graph5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;24.10: Gráfico diagnóstico dos resíduos e pontos de alavancagem.
</figcaption>
</figure>
</div>
</div>
</div>
<p>São produzidos vários gráficos com a função <code>plot()</code>, mas o foco é o gráfico 5 (<a href="#fig-graph5" class="quarto-xref">Figura&nbsp;<span>24.10</span></a>) que confirma os achados de não existirem valores atípicos que comprometam o ajuste do modelo. A <a href="#fig-linearidade" class="quarto-xref">Figura&nbsp;<span>24.8</span></a> exibe um gráfico igual, sem mostrar as distância s de Cook.</p>
<p>Para a análise dos pontos influentes, pode-se verificar os pontos de alavancagem (<code>leverage</code>) com a função <code>hatvalues()</code> do pacote <code>stats</code>, incluído no R base.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>hat <span class="ot">&lt;-</span> <span class="fu">hatvalues</span>(modelo2)</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span> (hat)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
0.001938 0.002805 0.006013 0.006550 0.007643 0.079204 </code></pre>
</div>
</div>
<p>Os valores de alavancagem podem estar entre 0 (indicando que o caso não tem qualquer influência) e 1 (indicando que o caso tem grande influência). Se nenhum caso exercer influência indevida sobre o modelo, se espera que todos os valores de alavancagem estivessem próximos do valor médio. Alguns autores <span class="citation" data-cites="hoaglin1978hat">(<a href="referencias.html#ref-hoaglin1978hat" role="doc-biblioref">20</a>)</span>, recomendam investigar casos com valores superiores a duas vezes a média (0.0131004) como ponto de corte para identificar casos com influência indevida. Alguns valores (<span class="math inline">\(\sim\)</span> 5%) estão acima de duas vezes a média, o que se pode considerar pouco. Principalmente, porque o maior valor está bem longe do valor igual a 1 (0.0792037). É interessante fazer a análise, observando junto a <em>distância de Cook</em> para ver se um ponto é um <em>outlier</em> significativo.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>cook <span class="ot">&lt;-</span> <span class="fu">cooks.distance</span>(modelo2)</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span> (cook)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Min.   1st Qu.    Median      Mean   3rd Qu.      Max. 
1.585e-06 3.793e-05 1.762e-04 1.068e-03 6.004e-04 3.114e-02 </code></pre>
</div>
</div>
<p>Se a distância de Cook é <span class="math inline">\(\lt\)</span> 1, não há necessidade real de excluir esses valores, uma vez que não tem um grande efeito na análise de regressão <span class="citation" data-cites="stevens1984outliers">(<a href="referencias.html#ref-stevens1984outliers" role="doc-biblioref">21</a>)</span>. Na <a href="#fig-graph5" class="quarto-xref">Figura&nbsp;<span>24.10</span></a>), verifica-se que os casos mais distantes não alcançam a distância de Cook.</p>


<!-- -->

<div id="refs" class="references csl-bib-body" role="list" style="display: none">
<div id="ref-cox1958regression" class="csl-entry" role="listitem">
<div class="csl-left-margin">1. </div><div class="csl-right-inline">Cox DR. The regression analysis of binary sequences. Journal of the Royal Statistical Society Series B: Statistical Methodology. 1958;20(2):215–32. </div>
</div>
<div id="ref-peat2014adjusted" class="csl-entry" role="listitem">
<div class="csl-left-margin">2. </div><div class="csl-right-inline">Peat J, Barton B. Adjusted odds ratios. Em: Medical statistics : a guide to SPSS, data analysis, and critical appraisal. New York, NY: John Wiley &amp; Sons; 2014. p. 298–308. </div>
</div>
<div id="ref-hair2009analise" class="csl-entry" role="listitem">
<div class="csl-left-margin">3. </div><div class="csl-right-inline">Hair JF, Black WC, Babin BJ, Anderson RE, Tatham RL. Regressão logística: Regressão com uma variável dependente binária. Em: Análise Multivariada de Dados. 6a Edição. bookman; 2009. p. 283–302. </div>
</div>
<div id="ref-verzani2014reglog" class="csl-entry" role="listitem">
<div class="csl-left-margin">4. </div><div class="csl-right-inline">Verzani J. Extensions to linear model. Em: Using R for Introductory Statistics. Second Edition. Chapman &amp; Hall/CRC; 2014. p. 440–8. </div>
</div>
<div id="ref-stoltzfus2011logistic" class="csl-entry" role="listitem">
<div class="csl-left-margin">5. </div><div class="csl-right-inline">Stoltzfus JC. Logistic regression: a brief primer. Academic emergency medicine. 2011;18(10):1099–104. </div>
</div>
<div id="ref-wiki:xxx" class="csl-entry" role="listitem">
<div class="csl-left-margin">6. </div><div class="csl-right-inline">Wikipédia. RMS Titanic — Wikipédia<span>,</span> a enciclopédia livre [Internet]. 2025. Disponível em: <a href="https://pt.wikipedia.org/w/index.php?title=RMS_Titanic&amp;oldid=69869298">https://pt.wikipedia.org/w/index.php?title=RMS_Titanic&amp;oldid=69869298</a></div>
</div>
<div id="ref-Prabhakaran_2016" class="csl-entry" role="listitem">
<div class="csl-left-margin">7. </div><div class="csl-right-inline">Prabhakaran S. Missing Value Treatment [Internet]. datascienceplus. 2016. Disponível em: <a href="https://datascienceplus.com/missing-value-treatment/">https://datascienceplus.com/missing-value-treatment/</a></div>
</div>
<div id="ref-van2011mice" class="csl-entry" role="listitem">
<div class="csl-left-margin">8. </div><div class="csl-right-inline">Van Buuren S, Groothuis-Oudshoorn K. mice: Multivariate imputation by chained equations in R. Journal of statistical software. 2011;45:1–67. </div>
</div>
<div id="ref-subramanian2013over" class="csl-entry" role="listitem">
<div class="csl-left-margin">9. </div><div class="csl-right-inline">Subramanian J, Simon R. Overfitting in prediction models–is it a problem only in high dimensions? Contemporary clinical trials. 2013;36(2):636–41. </div>
</div>
<div id="ref-field2012logit" class="csl-entry" role="listitem">
<div class="csl-left-margin">10. </div><div class="csl-right-inline">Field A, Miles J, Field Z. Logistic regression. Em: Discovering statistics using R. Sage Publications, Ltd; 2012. p. 320. </div>
</div>
<div id="ref-hosmer2013applied" class="csl-entry" role="listitem">
<div class="csl-left-margin">11. </div><div class="csl-right-inline">Hosmer Jr DW, Lemeshow S, Sturdivant RX. Interpretation of Fitted Logistic Regression Model. Em: Applied logistic regression. Third Edition. John Wiley &amp; Sons; 2013. p. 49–64. </div>
</div>
<div id="ref-ludecke2018sjplot" class="csl-entry" role="listitem">
<div class="csl-left-margin">12. </div><div class="csl-right-inline">Lüdecke D. sjPlot: Data Visualization for Statistics in Social Science [Internet]. 2024. Disponível em: <a href="https://CRAN.R-project.org/package=sjPlot">https://CRAN.R-project.org/package=sjPlot</a></div>
</div>
<div id="ref-ludecke2018ggeffects" class="csl-entry" role="listitem">
<div class="csl-left-margin">13. </div><div class="csl-right-inline">Lüdecke D. <a href="https://doi.org/10.21105/joss.00772">ggeffects: Tidy Data Frames of Marginal Effects from Regression Models.</a> Journal of Open Source Software. 2018;3(26):772. </div>
</div>
<div id="ref-mcfadden1974conditional" class="csl-entry" role="listitem">
<div class="csl-left-margin">14. </div><div class="csl-right-inline">McFadden D. Conditional Logit Analysis of Qualitative Choice Behavior. Em: Zarembka P, editor. Frontiers in econometrics. Academic Press; 1974. p. 105-142-142. </div>
</div>
<div id="ref-CoxSnell1989analysis" class="csl-entry" role="listitem">
<div class="csl-left-margin">15. </div><div class="csl-right-inline">Cox DR, Snell EJ. Analysis of Binary Data. Second Edition. Chapman; Hall/CRC; 1989. </div>
</div>
<div id="ref-nagelkerke1991note" class="csl-entry" role="listitem">
<div class="csl-left-margin">16. </div><div class="csl-right-inline">Nagelkerke NJ et al. A note on a general definition of the coefficient of determination. Biometrika. 1991;78(3):691–2. </div>
</div>
<div id="ref-mcfadden2021quantitative" class="csl-entry" role="listitem">
<div class="csl-left-margin">17. </div><div class="csl-right-inline">McFadden D. Quantitative methods for analysing travel behaviour of individuals: some recent developments. Em: Behavioural travel modelling. Routledge; 2021. p. 279–318. </div>
</div>
<div id="ref-bobbitt2020residuals" class="csl-entry" role="listitem">
<div class="csl-left-margin">18. </div><div class="csl-right-inline">Bobbitt Z. How to Calculate Standardized Residuals in R [Internet]. Statology. 2020. Disponível em: <a href="https://www.statology.org/standardized-residuals-in-r/">https://www.statology.org/standardized-residuals-in-r/</a></div>
</div>
<div id="ref-field2012outliers" class="csl-entry" role="listitem">
<div class="csl-left-margin">19. </div><div class="csl-right-inline">Field A, Miles J, Field Z. Outliers and influential cases. Em: Discovering statistics using R. Sage Publications, Ltd; 2012. p. 288–92. </div>
</div>
<div id="ref-hoaglin1978hat" class="csl-entry" role="listitem">
<div class="csl-left-margin">20. </div><div class="csl-right-inline">Hoaglin DC, Welsch RE. The hat matrix in regression and ANOVA. The American Statistician. 1978;32(1):17–22. </div>
</div>
<div id="ref-stevens1984outliers" class="csl-entry" role="listitem">
<div class="csl-left-margin">21. </div><div class="csl-right-inline">Stevens JP. Outliers and influential data points in regression analysis. Psychological bulletin. 1984;95(2):334. </div>
</div>
</div>
</section>
</section>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>Lembre-se que o diretório mostrado no comando é o do autor, você deverá usar o do seu computador<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Todo esse processo foi realizado com objetivo didático, para revisar a realização de manipulação de dados no R<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>É fundamentado na <em>teoria da informação</em>, teoria matemática da informação que estuda a quantificação, armazenamento e comunicação da informação. Quando um modelo estatístico é usado para representar um determinado processo, a representação nunca será exata, ou seja, o modelo nunca será perfeito e certamente algumas informações serão perdidas. O AIC estima a quantidade relativa de informação perdida por um determinado modelo: quanto menos informações um modelo perde, maior a qualidade desse modelo e menor a pontuação AIC.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>Veja mais detalhes sobre <em>Odds Ratio</em> na <a href="22-medidasOcorrencia.html#sec-or" class="quarto-xref"><span>Seção 22.3.1</span></a>.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copiada");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copiada");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./23-sobrevida.html" class="pagination-link" aria-label="Análise de Sobrevida">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Análise de Sobrevida</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./glossario.html" class="pagination-link" aria-label="Glossário">
        <span class="nav-page-text">Glossário</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Código fonte</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb96" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># Regressão Logística Binária</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a><span class="fu">## Pacotes necessários neste capítulo</span></span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb96-10"><a href="#cb96-10" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(caret, </span>
<span id="cb96-11"><a href="#cb96-11" aria-hidden="true" tabindex="-1"></a>               dplyr,</span>
<span id="cb96-12"><a href="#cb96-12" aria-hidden="true" tabindex="-1"></a>               flextable,</span>
<span id="cb96-13"><a href="#cb96-13" aria-hidden="true" tabindex="-1"></a>               ggeffects,</span>
<span id="cb96-14"><a href="#cb96-14" aria-hidden="true" tabindex="-1"></a>               ggplot2,</span>
<span id="cb96-15"><a href="#cb96-15" aria-hidden="true" tabindex="-1"></a>               knitr,</span>
<span id="cb96-16"><a href="#cb96-16" aria-hidden="true" tabindex="-1"></a>               mice,</span>
<span id="cb96-17"><a href="#cb96-17" aria-hidden="true" tabindex="-1"></a>               patchwork,</span>
<span id="cb96-18"><a href="#cb96-18" aria-hidden="true" tabindex="-1"></a>               performance,</span>
<span id="cb96-19"><a href="#cb96-19" aria-hidden="true" tabindex="-1"></a>               pROC,</span>
<span id="cb96-20"><a href="#cb96-20" aria-hidden="true" tabindex="-1"></a>               readxl,</span>
<span id="cb96-21"><a href="#cb96-21" aria-hidden="true" tabindex="-1"></a>               sjPlot)</span>
<span id="cb96-22"><a href="#cb96-22" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-23"><a href="#cb96-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-24"><a href="#cb96-24" aria-hidden="true" tabindex="-1"></a><span class="fu">## Introduçao</span></span>
<span id="cb96-25"><a href="#cb96-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-26"><a href="#cb96-26" aria-hidden="true" tabindex="-1"></a>A **regressão logística** (também conhecida como *regressão logit* ou *modelo logit*) foi desenvolvida, em 1958, como um a extensão do modelo linear pelo estatístico britânico David Cox (1924-2022) @cox1958regression. Pertence a uma família, denominada *Modelo Linear Generalizado* (GLM) e é um modelo de regressão em que o desfecho *Y* é categórico.</span>
<span id="cb96-27"><a href="#cb96-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-28"><a href="#cb96-28" aria-hidden="true" tabindex="-1"></a>A regressão logística permite estimar a probabilidade de uma resposta categórica com base em uma ou mais variáveis preditoras (*X*). Possibilita informar se a presença de um preditor aumenta (ou diminui) a probabilidade de um determinado desfecho em uma porcentagem específica. No caso em que *Y* é binário - ou seja, assume apenas dois valores, `0` e `1`, que representam desfechos como aprovação/reprovação, sim/não, vivo/morto ou saudável/doente, tem-se a **regressão logística binária**.</span>
<span id="cb96-29"><a href="#cb96-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-30"><a href="#cb96-30" aria-hidden="true" tabindex="-1"></a>Na regressão logística binária, as variáveis que afetam a probabilidade do resultado são medidas como *Odds Ratio*, que são chamadas de **Odds Ratios ajustadas** @peat2014adjusted.</span>
<span id="cb96-31"><a href="#cb96-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-32"><a href="#cb96-32" aria-hidden="true" tabindex="-1"></a>Na regressão linear, os valores das variáveis desfecho são preditos a partir de uma ou mais variáveis explicativas. Na regressão logística, uma vez que o desfecho é binário, a probabilidade de o desfecho ocorrer é calculada com base nos valores das variáveis explicativas. A regressão logística é semelhante à regressão linear na medida em que uma equação de regressão pode ser usada para prever a probabilidade de ocorrência de um desfecho. No entanto, a equação de regressão logística é expressa em termos logarítmicos (ou logits) e, portanto, os coeficientes de regressão devem ser convertidos para serem interpretados.</span>
<span id="cb96-33"><a href="#cb96-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-34"><a href="#cb96-34" aria-hidden="true" tabindex="-1"></a>Embora as variáveis explicativas ou preditores no modelo possam ser variáveis contínuas ou categóricas, a regressão logística é mais adequada para medir os efeitos das exposições ou variáveis explicativas que são variáveis binárias. Variáveis contínuas podem ser incluídas, mas a regressão logística produzirá uma estimativa de risco para cada unidade de medida. Assim, a suposição de que o efeito de risco é linear sobre cada unidade da variável deve ser atendida e a relação não deve ser curva ou ter um ponto de corte sobre o qual o efeito ocorre. Além disso, as interações entre variáveis explicativas podem ser incluídas <span class="co">[</span><span class="ot">@peat2014adjusted</span><span class="co">]</span>. Os casos em que a variável dependente tem mais de duas categorias de resultados podem ser analisados com *regressão logística multinomial*, não mostrada neste livro.</span>
<span id="cb96-35"><a href="#cb96-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-36"><a href="#cb96-36" aria-hidden="true" tabindex="-1"></a><span class="fu">## Função Logistica {#sec-logisticfunction}</span></span>
<span id="cb96-37"><a href="#cb96-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-38"><a href="#cb96-38" aria-hidden="true" tabindex="-1"></a>Na regressão logística, para a estimação dos coeficientes (coeficientes $\beta$) das variáveis independentes, utiliza-se o modelo logit @hair2009analise:</span>
<span id="cb96-39"><a href="#cb96-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-40"><a href="#cb96-40" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb96-41"><a href="#cb96-41" aria-hidden="true" tabindex="-1"></a>logit_{i} = ln(\frac{p}{1-p})=b_{0} + b_{1}x_{1} +...+ b_{n}x_{n}</span>
<span id="cb96-42"><a href="#cb96-42" aria-hidden="true" tabindex="-1"></a>$$ ou</span>
<span id="cb96-43"><a href="#cb96-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-44"><a href="#cb96-44" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb96-45"><a href="#cb96-45" aria-hidden="true" tabindex="-1"></a>logit_{i} = ln(\frac{p}{1-p})=e^{b_{0} + b_{1}x_{1} +...+ b_{n}x_{n}}</span>
<span id="cb96-46"><a href="#cb96-46" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb96-47"><a href="#cb96-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-48"><a href="#cb96-48" aria-hidden="true" tabindex="-1"></a>onde *p* é a probabilidade de desfecho.</span>
<span id="cb96-49"><a href="#cb96-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-50"><a href="#cb96-50" aria-hidden="true" tabindex="-1"></a>A **função logística** transforma valores entre $-\infty$ a $+\infty$ em valores entre 0 e 1, de modo que os números que especificam as probabilidades estarão entre 0 e 1. Esse termo logarítmico é chamado de $log_{OR}$ (razão de chances logarítmica) ou *logit*. As chances (*odds*) associadas a alguma probabilidade são $p/(1-p)$, o que é evidente se for entendido que um evento com chances *a* para *b* significa que em $a+b$ tentativas independentes e identicamente distribuídas, espera-se um sucesso. Portanto, a probabilidade de sucesso deve ser $a/(a+b)$.</span>
<span id="cb96-51"><a href="#cb96-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-52"><a href="#cb96-52" aria-hidden="true" tabindex="-1"></a>Invertendo, se a probabilidade de sucesso é $a/(a+b)$, então a razão se torna $<span class="co">[</span><span class="ot">a/(a+b)</span><span class="co">]</span>/<span class="co">[</span><span class="ot">1-a/(a+b)</span><span class="co">]</span>$ ou $a/b$, que é a razão de chances ou *odds ratio*.</span>
<span id="cb96-53"><a href="#cb96-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-54"><a href="#cb96-54" aria-hidden="true" tabindex="-1"></a>Para concluir o modelo, é necesário especificar a distribuição do desfecho $Y_{i}$. Ela é binomial com probabilidade de sucesso *p*, de modo que nenhum parâmetro extra, como um desvio padrão, é necessário @verzani2014reglog.</span>
<span id="cb96-55"><a href="#cb96-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-56"><a href="#cb96-56" aria-hidden="true" tabindex="-1"></a>A regressão logística frequentemente utiliza a curva logística (@fig-curvalog) para assim representar a relação entre a variável dependente e as independentes. Os valores previstos, portanto permanecem entre 0 e 1, sendo definidos pelos coeficientes estimados.</span>
<span id="cb96-57"><a href="#cb96-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-60"><a href="#cb96-60" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb96-61"><a href="#cb96-61" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-curvalog</span></span>
<span id="cb96-62"><a href="#cb96-62" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb96-63"><a href="#cb96-63" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.align: "center"</span></span>
<span id="cb96-64"><a href="#cb96-64" aria-hidden="true" tabindex="-1"></a><span class="co">#| out.width: "50%"</span></span>
<span id="cb96-65"><a href="#cb96-65" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb96-66"><a href="#cb96-66" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb96-67"><a href="#cb96-67" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Curva de Regressão Logística Geral"</span></span>
<span id="cb96-68"><a href="#cb96-68" aria-hidden="true" tabindex="-1"></a> knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">"https://imgur.com/mBRglgO.png"</span>)</span>
<span id="cb96-69"><a href="#cb96-69" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-70"><a href="#cb96-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-71"><a href="#cb96-71" aria-hidden="true" tabindex="-1"></a>A estimação dos coeficientes na regressão logística, diferentemente da regressão múltipla que utiliza o método dos mínimos quadrados, é realizada através da **máxima verossimilhança**. Este método busca encontrar as estimativas mais prováveis dos coeficientes e maximizar a probabilidade de ocorrência de um evento. A qualidade do ajuste do modelo é avaliada pelo “pseudo” $R^2$ e pela análise da precisão preditiva (matriz de confusão).</span>
<span id="cb96-72"><a href="#cb96-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-73"><a href="#cb96-73" aria-hidden="true" tabindex="-1"></a>O valor da verossimilhança (*likelihood*) é semelhante ao procedimento das somas dos quadrados na regressão múltipla, estimando o quão bem o método de máxima verossimilhança se ajusta ao modelo. O ajuste da estimação do modelo é dado pelo valor de -2 vezes o logaritmo da verossimilhança (-2LL), sendo que, quanto menor este valor, melhor o modelo @stoltzfus2011logistic.</span>
<span id="cb96-74"><a href="#cb96-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-75"><a href="#cb96-75" aria-hidden="true" tabindex="-1"></a><span class="fu">## Pressupostos da regressão logística</span></span>
<span id="cb96-76"><a href="#cb96-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-77"><a href="#cb96-77" aria-hidden="true" tabindex="-1"></a>Para garantir que a regressão seja adequada, para melhorar a precisão do modelo, assumimos quatro pressupostos principais:</span>
<span id="cb96-78"><a href="#cb96-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-79"><a href="#cb96-79" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>**Independência dos dados**: o valor de uma observação não influencia ou afeta o valor de outras observações. Este é o pressuposto básico.</span>
<span id="cb96-80"><a href="#cb96-80" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>**Linearidade dos dados**: a relação entre as variáveis independentes e a curva logística da variável dependente é considerada linear (quanto mais/menos de uma, mais/menos de outra). A linearidade dos dados pode ser verificada graficamente observando a dispersão dos resíduos com os valores previstos pela regressão.</span>
<span id="cb96-81"><a href="#cb96-81" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>**Independência dos erros/resíduos**: os erros (resíduos) não devem possuir correlação. Este pressuposto pode ser testado pelo teste de Durbin-Watson (veja a @sec-dw) e observando o gráfico quantil-quantil (Q-Q) dos resíduos padronizados.</span>
<span id="cb96-82"><a href="#cb96-82" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>**Homogeneidade de Variância dos erros/resíduos**: os erros devem ter média zero e desvio padrão constante ao longo das observações. Similar ao teste de Levene, mas aplicado aos resíduos da regressão. Pode ser testado usando o Teste de Breusch-Pagan (veja a @sec-BP).</span>
<span id="cb96-83"><a href="#cb96-83" aria-hidden="true" tabindex="-1"></a><span class="ss">5.  </span>**Ausência de Multicolinearidade**: multicolinearidade é a ocorrência de alta correlação entre duas ou mais variáveis independentes e pode levar a resultados distorcidos. Em geral, a multicolinearidade pode fazer com que os intervalos de confiança se ampliem, ou até mudar o sinal de influência das variáveis independentes (de positivo para negativo, por exemplo). Portanto, as inferências estatísticas de uma regressão com multicolinearidade não são confiáveis. Pode ser testado usando o Fator de Inflação de Variância (*Variance Inflation Factor* – VIF, veja a @sec-vif).</span>
<span id="cb96-84"><a href="#cb96-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-85"><a href="#cb96-85" aria-hidden="true" tabindex="-1"></a><span class="fu">## Dados para o exemplo</span></span>
<span id="cb96-86"><a href="#cb96-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-87"><a href="#cb96-87" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb96-88"><a href="#cb96-88" aria-hidden="true" tabindex="-1"></a><span class="fu">## Tragédia do Titanic</span></span>
<span id="cb96-89"><a href="#cb96-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-90"><a href="#cb96-90" aria-hidden="true" tabindex="-1"></a>O RMS Titanic (@fig-titanic), considerado o navio inafundável de sua época, sofreu um trágico destino em sua viagem inaugural com destino a Nova Iorque. Construído com o intuito de ser o maior e mais luxuoso transatlântico, o Titanic colidiu com um iceberg na noite de 14 de abril de 1912, no Oceano Atlântico Norte, afundando rapidamente e causando a morte de inúmeras pessoas.</span>
<span id="cb96-91"><a href="#cb96-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-94"><a href="#cb96-94" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb96-95"><a href="#cb96-95" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb96-96"><a href="#cb96-96" aria-hidden="true" tabindex="-1"></a><span class="co">#| out.width: "50%"</span></span>
<span id="cb96-97"><a href="#cb96-97" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-titanic</span></span>
<span id="cb96-98"><a href="#cb96-98" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.align: 'center'</span></span>
<span id="cb96-99"><a href="#cb96-99" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Titanic parado em Queenstown, 11 de abril.de 1912"</span></span>
<span id="cb96-100"><a href="#cb96-100" aria-hidden="true" tabindex="-1"></a> knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">"https://imgur.com/54il14d.png"</span>)</span>
<span id="cb96-101"><a href="#cb96-101" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-102"><a href="#cb96-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-103"><a href="#cb96-103" aria-hidden="true" tabindex="-1"></a>O Titanic partiu em sua primeira e única viagem com 1 316 passageiros a bordo: 325 na primeira classe, 285 na segunda e 706 na terceira. Deles, 922 embarcaram em Southampton, 274 em Cherbourg-Octeville na França e 120 em Queenstown na Irlanda. Além desses passageiros, havia 908 tripulantes, totalizando m 2224 pessoas. O número total de mortos mais aceito é 1514, quase 70% dos que embarcaram na viagem <span class="co">[</span><span class="ot">@wiki:xxx</span><span class="co">]</span>.</span>
<span id="cb96-104"><a href="#cb96-104" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb96-105"><a href="#cb96-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-106"><a href="#cb96-106" aria-hidden="true" tabindex="-1"></a>Os dados de 1309 passageiros estão em um arquivo denominado <span class="in">`dadosTitanic.xlsx`</span>, obtido no pacote <span class="in">`titanic`</span>, modificado estruturalmente e traduzido, sem alterar os dados, para chegar a este arquivo que pode ser baixado <span class="co">[</span><span class="ot">aqui</span><span class="co">](https://github.com/petronioliveira/Arquivos/blob/main/dadosTitanic.xlsx)</span>. Possui 1309 observações e 12 variáveis:</span>
<span id="cb96-107"><a href="#cb96-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-108"><a href="#cb96-108" aria-hidden="true" tabindex="-1"></a>• **id** $\to$ identificação do passageiro\</span>
<span id="cb96-109"><a href="#cb96-109" aria-hidden="true" tabindex="-1"></a>• **sobreviveu** $\to$ 0 = não; 1 = sim\</span>
<span id="cb96-110"><a href="#cb96-110" aria-hidden="true" tabindex="-1"></a>• **classe** $\to$ classe do passageiro (categórica): 1 = 1ª classe; 2 = 2ª classe e 3 = 3ª classe (qualitativa)\</span>
<span id="cb96-111"><a href="#cb96-111" aria-hidden="true" tabindex="-1"></a>• **nome** $\to$ nome do passageiro (nominal)\</span>
<span id="cb96-112"><a href="#cb96-112" aria-hidden="true" tabindex="-1"></a>• **sexo** $\to$ masc = masculino; fem = feminino (binária)\</span>
<span id="cb96-113"><a href="#cb96-113" aria-hidden="true" tabindex="-1"></a>• **idade** $\to$ idade em anos (numérica contínua)\</span>
<span id="cb96-114"><a href="#cb96-114" aria-hidden="true" tabindex="-1"></a>• **irco** $\to$ número de irmãos/cônjuges a bordo (numérica discreta)\</span>
<span id="cb96-115"><a href="#cb96-115" aria-hidden="true" tabindex="-1"></a>• **pafi** $\to$ número de pais/filhos a bordo (numérica discreta)\</span>
<span id="cb96-116"><a href="#cb96-116" aria-hidden="true" tabindex="-1"></a>• **ticket** $\to$ número do bilhete de embarque (nominal)\</span>
<span id="cb96-117"><a href="#cb96-117" aria-hidden="true" tabindex="-1"></a>• **tarifa** $\to$ valor pago pela passagem em dólares (numérica contínua)\</span>
<span id="cb96-118"><a href="#cb96-118" aria-hidden="true" tabindex="-1"></a>• **cabine** $\to$ número de identificação da cabine (nominal)\</span>
<span id="cb96-119"><a href="#cb96-119" aria-hidden="true" tabindex="-1"></a>• **porto_embarque** $\to$ porto de embarque: C = Cherbourg, Q = Queenstown, S = Southampton</span>
<span id="cb96-120"><a href="#cb96-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-121"><a href="#cb96-121" aria-hidden="true" tabindex="-1"></a><span class="fu">### Leitura dos dados</span></span>
<span id="cb96-122"><a href="#cb96-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-123"><a href="#cb96-123" aria-hidden="true" tabindex="-1"></a>Após fazer o download do banco de dados em seu diretório <span class="ot">[^24-reglogbin-1]</span>, carregue-o no *RStudio*, usando a função <span class="in">`read_excel()`</span> do pacote <span class="in">`readxl`</span>:</span>
<span id="cb96-124"><a href="#cb96-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-125"><a href="#cb96-125" aria-hidden="true" tabindex="-1"></a><span class="ot">[^24-reglogbin-1]: </span>Lembre-se que o diretório mostrado no comando é o do autor, você deverá usar o do seu computador</span>
<span id="cb96-126"><a href="#cb96-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-129"><a href="#cb96-129" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb96-130"><a href="#cb96-130" aria-hidden="true" tabindex="-1"></a>dadosTitanic <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">"dados/dadosTitanic.xlsx"</span>)</span>
<span id="cb96-131"><a href="#cb96-131" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-132"><a href="#cb96-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-133"><a href="#cb96-133" aria-hidden="true" tabindex="-1"></a><span class="fu">### Explorando e preparando os dados</span></span>
<span id="cb96-134"><a href="#cb96-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-135"><a href="#cb96-135" aria-hidden="true" tabindex="-1"></a>Dê uma olhada nas variáveis do banco de dados. Para essa ação, pode-se usar a função <span class="in">`str()`</span>:</span>
<span id="cb96-136"><a href="#cb96-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-139"><a href="#cb96-139" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb96-140"><a href="#cb96-140" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(dadosTitanic)</span>
<span id="cb96-141"><a href="#cb96-141" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-142"><a href="#cb96-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-143"><a href="#cb96-143" aria-hidden="true" tabindex="-1"></a>Observa-se que se tem um *tibble* com 1309 linhas (casos = passageiros) e 12 colunas (variáveis). Algumas dessas variáveis não terão utilidade para a análise de regressão logística: por exemplo, a coluna índice (<span class="in">`id`</span>), o nome do passageiro, o número do ticket de embarque, a tarifa, o número da cabine e o porto de embarque. Elas serão removidas do banco de dados, usando a função <span class="in">`select()`</span> do pacote <span class="in">`dplyr`</span> (veja a @sec-dadosMater):</span>
<span id="cb96-144"><a href="#cb96-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-147"><a href="#cb96-147" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb96-148"><a href="#cb96-148" aria-hidden="true" tabindex="-1"></a>dadosTitanic <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">select</span>(dadosTitanic, </span>
<span id="cb96-149"><a href="#cb96-149" aria-hidden="true" tabindex="-1"></a>                              <span class="sc">-</span><span class="fu">c</span>(id, nome, ticket, tarifa, cabine, porto_embarque))</span>
<span id="cb96-150"><a href="#cb96-150" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-151"><a href="#cb96-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-152"><a href="#cb96-152" aria-hidden="true" tabindex="-1"></a><span class="fu">### Verificando e tratando os dados omissos</span></span>
<span id="cb96-153"><a href="#cb96-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-154"><a href="#cb96-154" aria-hidden="true" tabindex="-1"></a>Para verificar os NAs no banco de dados, pode-se usar o comando que soma os dados faltantes em cada coluna do banco de dados:</span>
<span id="cb96-155"><a href="#cb96-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-158"><a href="#cb96-158" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb96-159"><a href="#cb96-159" aria-hidden="true" tabindex="-1"></a><span class="fu">colSums</span>(<span class="fu">is.na</span>(dadosTitanic))</span>
<span id="cb96-160"><a href="#cb96-160" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-161"><a href="#cb96-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-162"><a href="#cb96-162" aria-hidden="true" tabindex="-1"></a>A coluna da variável <span class="in">`idade`</span> contém 263 valores faltantes, ou seja, 20% estão ausentes. A melhor forma de tratar dados faltantes depende de diversos fatores, como @Prabhakaran_2016 :</span>
<span id="cb96-163"><a href="#cb96-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-164"><a href="#cb96-164" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>*Mecanismo de geração dos dados faltantes*: Por que os dados estão faltando? É aleatório, relacionado a outras variáveis ou a alguma característica da população?\</span>
<span id="cb96-165"><a href="#cb96-165" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>*Quantidade de dados faltantes*: 263 valores faltantes representam uma proporção considerável dos dados (20%).\</span>
<span id="cb96-166"><a href="#cb96-166" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>*Impacto na análise*: Como a presença de dados faltantes pode afetar os resultados da sua análise?</span>
<span id="cb96-167"><a href="#cb96-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-168"><a href="#cb96-168" aria-hidden="true" tabindex="-1"></a>O que fazer?</span>
<span id="cb96-169"><a href="#cb96-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-170"><a href="#cb96-170" aria-hidden="true" tabindex="-1"></a>1)  **Exclusão de casos**:</span>
<span id="cb96-171"><a href="#cb96-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-172"><a href="#cb96-172" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- --&gt;</span></span>
<span id="cb96-173"><a href="#cb96-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-174"><a href="#cb96-174" aria-hidden="true" tabindex="-1"></a>a.  *Listwise deletion*: Remover todas as observações com algum dado faltante. Não recomendado neste caso, pois você perderia uma quantidade significativa de dados.</span>
<span id="cb96-175"><a href="#cb96-175" aria-hidden="true" tabindex="-1"></a>b.  *Pairwise deletion*: Utilizar todas as observações disponíveis para cada análise. Pode gerar resultados inconsistentes.</span>
<span id="cb96-176"><a href="#cb96-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-177"><a href="#cb96-177" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- --&gt;</span></span>
<span id="cb96-178"><a href="#cb96-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-179"><a href="#cb96-179" aria-hidden="true" tabindex="-1"></a>2)  **Imputação**:</span>
<span id="cb96-180"><a href="#cb96-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-181"><a href="#cb96-181" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- --&gt;</span></span>
<span id="cb96-182"><a href="#cb96-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-183"><a href="#cb96-183" aria-hidden="true" tabindex="-1"></a>a.  *Imputação por média, mediana ou moda*: Substituir os valores faltantes pela média, mediana ou moda da variável. Simples, mas pode subestimar a variância.\</span>
<span id="cb96-184"><a href="#cb96-184" aria-hidden="true" tabindex="-1"></a>b.  *Imputação por regressão*: Utilizar um modelo de regressão para prever os valores faltantes com base em outras variáveis. Mais preciso, mas pode ser enviesado se o modelo não for adequado.\</span>
<span id="cb96-185"><a href="#cb96-185" aria-hidden="true" tabindex="-1"></a>c.  *Imputação múltipla*: Criar múltiplos conjuntos de dados, cada um com diferentes valores imputados, e combinar os resultados das análises. Método mais robusto e permite estimar a incerteza.\</span>
<span id="cb96-186"><a href="#cb96-186" aria-hidden="true" tabindex="-1"></a>d.  *Imputação por K-Nearest Neighbors*: Substituir os valores faltantes pela média dos *k* vizinhos mais próximos. Útil para dados numéricos e pode capturar padrões locais.</span>
<span id="cb96-187"><a href="#cb96-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-188"><a href="#cb96-188" aria-hidden="true" tabindex="-1"></a>Considerando a quantidade de dados faltantes e a natureza da variável <span class="in">`idade`</span>, a imputação múltipla é uma excelente opção. Ela permite lidar com a incerteza associada aos valores imputados e fornece uma estimativa mais precisa dos parâmetros do modelo. Para isso, será usada a função <span class="in">`mice()`</span> do pacote <span class="in">`mice`</span> (*Multivariate Imputation by Chained Equations*) @van2011mice para fazer a imputação múltipla. O argumento `m = 5` se refere ao número de múltiplas imputações (cinco é o padrão); `method = “pmm”` é o método de imputação, onde se usa a correspondência da média preditiva (predictive mean matching – dados numéricos) como método de imputação. O método `pmm` garante que os valores imputados sejam próximos de valores reais do conjunto de dados, mantendo a coerência estatística. A função `mice()` produz várias cópias completas de *dataframe*, cada uma com diferentes imputações dos dados ausentes. Essa transformação será atribuída a um objeto de nome <span class="in">`dados`</span>.</span>
<span id="cb96-189"><a href="#cb96-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-192"><a href="#cb96-192" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb96-193"><a href="#cb96-193" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: mice</span></span>
<span id="cb96-194"><a href="#cb96-194" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb96-195"><a href="#cb96-195" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb96-196"><a href="#cb96-196" aria-hidden="true" tabindex="-1"></a>dados <span class="ot">&lt;-</span> mice<span class="sc">::</span><span class="fu">mice</span>(dadosTitanic, <span class="at">m=</span><span class="dv">5</span>, <span class="at">method=</span><span class="st">"pmm"</span>)</span>
<span id="cb96-197"><a href="#cb96-197" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-198"><a href="#cb96-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-199"><a href="#cb96-199" aria-hidden="true" tabindex="-1"></a>A seguir, cria-se um novo dataframe com os dados imputados, usando a função <span class="in">`complete()`</span>, também do pacote <span class="in">`mice`</span>. Essa função retorna um ou vários desses conjuntos de dados, sendo que o padrão é o primeiro. Este novo conjunto de dados será atribuído ao objeto <span class="in">`dados_completos`</span>. O comando escolhe a primeira imputação:</span>
<span id="cb96-200"><a href="#cb96-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-203"><a href="#cb96-203" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb96-204"><a href="#cb96-204" aria-hidden="true" tabindex="-1"></a>dados_completos <span class="ot">&lt;-</span> mice<span class="sc">::</span><span class="fu">complete</span>(dados, <span class="dv">1</span>) </span>
<span id="cb96-205"><a href="#cb96-205" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-206"><a href="#cb96-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-207"><a href="#cb96-207" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Analizando os `dados_completos`</span></span>
<span id="cb96-208"><a href="#cb96-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-209"><a href="#cb96-209" aria-hidden="true" tabindex="-1"></a>Novamente, se usará as funções <span class="in">`colSums(is.na())`</span> e <span class="in">`str()`</span>:</span>
<span id="cb96-210"><a href="#cb96-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-213"><a href="#cb96-213" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb96-214"><a href="#cb96-214" aria-hidden="true" tabindex="-1"></a><span class="fu">colSums</span>(<span class="fu">is.na</span>(dados_completos))</span>
<span id="cb96-215"><a href="#cb96-215" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(dados_completos)</span>
<span id="cb96-216"><a href="#cb96-216" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-217"><a href="#cb96-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-218"><a href="#cb96-218" aria-hidden="true" tabindex="-1"></a>Agora, existem 1309 observações e 7 variáveis. Os dados faltantes não estão mais presentes, foram substituídos.</span>
<span id="cb96-219"><a href="#cb96-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-220"><a href="#cb96-220" aria-hidden="true" tabindex="-1"></a><span class="fu">### Outras transformações necessárias</span></span>
<span id="cb96-221"><a href="#cb96-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-222"><a href="#cb96-222" aria-hidden="true" tabindex="-1"></a>Ainda há necessidade de outras transformações, pois verifica-se que existem variáveis classificadas como numéricas (<span class="in">`classe`</span>, <span class="in">`sexo`</span> e a variável desfecho <span class="in">`sobreviveu`</span>), mas que são fatores. Esta modificação será realizada, usando a função <span class="in">`mutate()`</span> do pacote <span class="in">`dplyr`</span>(veja a @sec-dadosMater):</span>
<span id="cb96-223"><a href="#cb96-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-226"><a href="#cb96-226" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb96-227"><a href="#cb96-227" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb96-228"><a href="#cb96-228" aria-hidden="true" tabindex="-1"></a>dados_completos <span class="ot">&lt;-</span> dados_completos <span class="sc">%&gt;%</span></span>
<span id="cb96-229"><a href="#cb96-229" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sexo =</span> <span class="fu">factor</span>(sexo)) <span class="sc">%&gt;%</span></span>
<span id="cb96-230"><a href="#cb96-230" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">classe =</span> <span class="fu">factor</span>(classe)) <span class="sc">%&gt;%</span> </span>
<span id="cb96-231"><a href="#cb96-231" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sobreviveu =</span> <span class="fu">factor</span>(sobreviveu))</span>
<span id="cb96-232"><a href="#cb96-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-233"><a href="#cb96-233" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(dados_completos)</span>
<span id="cb96-234"><a href="#cb96-234" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-235"><a href="#cb96-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-236"><a href="#cb96-236" aria-hidden="true" tabindex="-1"></a>Finalmente, os dados estão prontos para se iniciar a análise de regressão logística <span class="ot">[^24-reglogbin-2]</span>.</span>
<span id="cb96-237"><a href="#cb96-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-238"><a href="#cb96-238" aria-hidden="true" tabindex="-1"></a><span class="ot">[^24-reglogbin-2]: </span>Todo esse processo foi realizado com objetivo didático, para revisar a realização de manipulação de dados no R</span>
<span id="cb96-239"><a href="#cb96-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-240"><a href="#cb96-240" aria-hidden="true" tabindex="-1"></a><span class="fu">## Construção do Modelo de Regressão Logística</span></span>
<span id="cb96-241"><a href="#cb96-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-242"><a href="#cb96-242" aria-hidden="true" tabindex="-1"></a><span class="fu">### Divisão dos dados em Treino e Teste</span></span>
<span id="cb96-243"><a href="#cb96-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-244"><a href="#cb96-244" aria-hidden="true" tabindex="-1"></a>A divisão dos dados em conjuntos de *treino* e *teste* é uma prática frequente em aprendizado de regressão logística. Serve para avaliar a performance de um modelo de forma imparcial precisa. O conjunto de Treino é a parte dos dados que o modelo utiliza para aprender as relações entre as variáveis independentes e a variável dependente. O modelo analisa esses dados para encontrar os melhores coeficientes que descrevem a relação entre as variáveis. O conjunto de Teste é a parte dos dados que o modelo não analisou durante o treinamento. Ele é utilizado para avaliar a capacidade do modelo de fazer previsões em novos dados. Ao comparar as previsões do modelo com os valores reais no conjunto de teste, podemos medir a sua precisão e generalização. Essa técnica é utilizada para evitar o excesso de ajuste dos dados (*overfitting*) @subramanian2013over, estimar a acurácia do modelo e comparação de modelos. A divisão mais comum é 70% para treinamento e 30% para teste, mas essa proporção pode variar dependendo do tamanho do conjunto de dados e da complexidade do problema.</span>
<span id="cb96-245"><a href="#cb96-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-248"><a href="#cb96-248" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb96-249"><a href="#cb96-249" aria-hidden="true" tabindex="-1"></a><span class="co"># Definindo a semente para reprodutibilidade</span></span>
<span id="cb96-250"><a href="#cb96-250" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb96-251"><a href="#cb96-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-252"><a href="#cb96-252" aria-hidden="true" tabindex="-1"></a><span class="co"># Embaralhando os dados</span></span>
<span id="cb96-253"><a href="#cb96-253" aria-hidden="true" tabindex="-1"></a>dados_completos <span class="ot">&lt;-</span> dados_completos <span class="sc">%&gt;%</span> <span class="fu">sample_frac</span>(<span class="at">size =</span> <span class="dv">1</span>)</span>
<span id="cb96-254"><a href="#cb96-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-255"><a href="#cb96-255" aria-hidden="true" tabindex="-1"></a><span class="co"># Definindo o ponto de corte para treino</span></span>
<span id="cb96-256"><a href="#cb96-256" aria-hidden="true" tabindex="-1"></a>split_index <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fl">0.7</span> <span class="sc">*</span> <span class="fu">nrow</span>(dados_completos))</span>
<span id="cb96-257"><a href="#cb96-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-258"><a href="#cb96-258" aria-hidden="true" tabindex="-1"></a><span class="co"># Dividindo os dados</span></span>
<span id="cb96-259"><a href="#cb96-259" aria-hidden="true" tabindex="-1"></a>dadosTreino <span class="ot">&lt;-</span> dados_completos <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span>split_index)</span>
<span id="cb96-260"><a href="#cb96-260" aria-hidden="true" tabindex="-1"></a>dadosTeste <span class="ot">&lt;-</span> dados_completos <span class="sc">%&gt;%</span> <span class="fu">slice</span>((split_index <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span><span class="fu">n</span>())</span>
<span id="cb96-261"><a href="#cb96-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-262"><a href="#cb96-262" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualizando o tamanho das amostras</span></span>
<span id="cb96-263"><a href="#cb96-263" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(dadosTreino)</span>
<span id="cb96-264"><a href="#cb96-264" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(dadosTeste)</span>
<span id="cb96-265"><a href="#cb96-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-266"><a href="#cb96-266" aria-hidden="true" tabindex="-1"></a><span class="co"># Explorando a estrutura dos dadosTreino</span></span>
<span id="cb96-267"><a href="#cb96-267" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span> (dadosTreino)</span>
<span id="cb96-268"><a href="#cb96-268" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(dadosTeste)</span>
<span id="cb96-269"><a href="#cb96-269" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-270"><a href="#cb96-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-271"><a href="#cb96-271" aria-hidden="true" tabindex="-1"></a>A função <span class="in">`sample_frac()`</span> do pacote <span class="in">`dplyr`</span> tem a função de embaralhar os dados para garantir a aleatoriedade; o argumento <span class="in">`size =1`</span> significa a fração de linhas selecionadas (0 e 1), sendo 1 (u)m equivalente a 100% das linhas. A função <span class="in">`slice()`</span>, também do pacote <span class="in">`dplyr`</span>, primeiro seleciona as primeiras 70% observações para treino e as últimas 30% para teste. Por último, a função <span class="in">`str()`</span>, visualiza os <span class="in">`dadosTreino`</span> que serão utilizados na construção do modelo de regressão logística.</span>
<span id="cb96-272"><a href="#cb96-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-273"><a href="#cb96-273" aria-hidden="true" tabindex="-1"></a><span class="fu">### Modelo de Regressão Logística {#sec-modreglog}</span></span>
<span id="cb96-274"><a href="#cb96-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-275"><a href="#cb96-275" aria-hidden="true" tabindex="-1"></a>Inicialmente, serão usados os <span class="in">`dadosTreino`</span> para criar o modelo de regressão logística.</span>
<span id="cb96-276"><a href="#cb96-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-277"><a href="#cb96-277" aria-hidden="true" tabindex="-1"></a>No modelo, a variável resposta ou desfecho é representada por <span class="in">`sobreviveu`</span>; todas as outras variáveis são variáveis explicativas.</span>
<span id="cb96-278"><a href="#cb96-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-279"><a href="#cb96-279" aria-hidden="true" tabindex="-1"></a>A função nativa <span class="in">`glm()`</span> – **g**eneralized **l**inear **m**odel - é usada<span class="sc">\*</span> para aplicar uma regressão logística no *R*. Sua funcionalidade é idêntica à função <span class="in">`lm()`</span> da regressão linear. Necessita alguns argumentos:</span>
<span id="cb96-280"><a href="#cb96-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-281"><a href="#cb96-281" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**formula** $\to$ objeto da classe *formula*. Um preditor típico tem o formato <span class="in">`resposta \~ preditor`</span> em que <span class="in">`resposta`</span>, na regressão logística binária, é uma variável dicotômica e o <span class="in">`preditor`</span> pode ser uma série de variáveis numéricas ou categóricas;</span>
<span id="cb96-282"><a href="#cb96-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-283"><a href="#cb96-283" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**family** $\to$ uma descrição da distribuição de erro e função de *link* a ser usada no modelo `glm`, pode ser uma *string* que nomeia uma função de *family*. O padrão é <span class="in">`family = gaussian()`</span>. No caso da regressão logística binária, <span class="in">`family = binomial()`</span> ou <span class="in">`family = binomial (link =”logit”)`</span>. Para outras informações, use <span class="in">`help(glm)`</span> ou <span class="in">`help(family)`</span>;</span>
<span id="cb96-284"><a href="#cb96-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-285"><a href="#cb96-285" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**data** $\to$ banco de dados.</span>
<span id="cb96-286"><a href="#cb96-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-287"><a href="#cb96-287" aria-hidden="true" tabindex="-1"></a>Dentro dos parênteses da função <span class="in">`glm()`</span>, são fornecidas informações essenciais sobre o modelo. À esquerda do til <span class="in">`(~)`</span>, encontra-se a variável dependente, que deve ser codificada como 0 e 1 para que a função a interprete corretamente como binária. Após o til, são listadas as variáveis preditoras. Quando se utiliza um ponto (<span class="in">`~.`</span>), isso indica a inclusão de todas as variáveis preditoras disponíveis. Já o uso do asterisco (<span class="in">`*`</span>) entre duas variáveis preditoras especifica que, além dos efeitos principais, também deve ser considerado um termo de interação entre elas. No exemplo apresentado, essa análise, inicialmente, não será solicitada. Por fim, após a vírgula, define-se que a distribuição utilizada é a binomial. Como a função <span class="in">`glm`</span> usa <span class="in">`logit`</span> como link padrão para uma variável de desfecho binomial, não há necessidade de especificá-lo explicitamente no modelo.</span>
<span id="cb96-288"><a href="#cb96-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-289"><a href="#cb96-289" aria-hidden="true" tabindex="-1"></a>O modelo inicial de regressão logística do tipo entrada forçada (<span class="in">`enter`</span>), método padrão de conduzir uma regressão, que consiste em simplesmente colocar todos os preditores no modelo de regressão em um bloco e estimar parâmetros para cada um @field2012logit. O dataframe <span class="in">`dadosTreino.xlsx`</span> será usado com todos os preditores dentro da função. O objeto criado será denominado de <span class="in">`modelo1`</span>.</span>
<span id="cb96-290"><a href="#cb96-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-293"><a href="#cb96-293" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb96-294"><a href="#cb96-294" aria-hidden="true" tabindex="-1"></a>modelo1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(sobreviveu <span class="sc">~</span>., </span>
<span id="cb96-295"><a href="#cb96-295" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> dadosTreino, </span>
<span id="cb96-296"><a href="#cb96-296" aria-hidden="true" tabindex="-1"></a>               <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>))</span>
<span id="cb96-297"><a href="#cb96-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-298"><a href="#cb96-298" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(modelo1)</span>
<span id="cb96-299"><a href="#cb96-299" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-300"><a href="#cb96-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-301"><a href="#cb96-301" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Interpretação dos Coeficientes</span></span>
<span id="cb96-302"><a href="#cb96-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-303"><a href="#cb96-303" aria-hidden="true" tabindex="-1"></a>Em uma regressão logística, a resposta que está sendo modelada é o <span class="in">`log(odds)`</span> ou <span class="in">`logit`</span> de que o desfecho é igual a 1. Os coeficientes de regressão fornecem a mudança no <span class="in">`log(odds)`</span> no desfecho para a mudança de uma unidade na variável preditora, mantendo todas as outras variáveis preditivas constantes @hosmer2013applied.</span>
<span id="cb96-304"><a href="#cb96-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-305"><a href="#cb96-305" aria-hidden="true" tabindex="-1"></a>Na saída da função <span class="in">`summary()`</span>, são produzidos os coeficientes da regressão na coluna <span class="in">`Estimate`</span>, associados ao respectivos desvio padrão dos resíduos (<span class="in">`Std. Error`</span>), o valor <span class="in">`z`</span> (estatística de Wald) e os valores do *p* (`Pr(&gt;|t|`). Importante destacar que a hipótese nula dos coeficientes da regressão é de que “os coeficientes são nulos/zeros”. Então, os valores *P* devem ser interpretados como a probabilidade de se observar valores de coeficientes tão extremos dado que a hipótese nula é verdadeira. Estes coeficientes estão modelando a probabilidade do evento desfecho (<span class="in">`sobreviveu`</span>) ocorrer com base nas variáveis explicativas: <span class="in">`sexo`</span>, <span class="in">`idade`</span>, <span class="in">`classe`</span> do passageiro, número de irmãos/conjuges a bordo (<span class="in">`irco`</span>) e número de pais/filhos a bordo (<span class="in">`pafi`</span>) . Os coeficientes da regressão representam o impacto de cada variável explicativa na probabilidade de sobrevivência.</span>
<span id="cb96-306"><a href="#cb96-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-307"><a href="#cb96-307" aria-hidden="true" tabindex="-1"></a>Nas *variáveis contínuas* , para cada aumento de uma unidade na <span class="in">`idade`</span>, por exemplo, o $log(odds)$ de sobreviver <span class="in">`1 = sim`</span> (versus <span class="in">`0 = não`</span>) diminui, pois o coeficiente é negativo, em <span class="in">`r modelo1$coefficients[5]`</span>.</span>
<span id="cb96-308"><a href="#cb96-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-309"><a href="#cb96-309" aria-hidden="true" tabindex="-1"></a>Para *variáveis categóricas*, o desempenho de cada categoria é avaliado em relação a uma categoria de base. A categoria de base para a variável <span class="in">`sexo`</span> é o sexo feminino (primeira categoria que aparece quando se observa os níveis) e para a classe do passageiro é a 1ª classe.</span>
<span id="cb96-310"><a href="#cb96-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-313"><a href="#cb96-313" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb96-314"><a href="#cb96-314" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(dadosTreino<span class="sc">$</span>sexo)</span>
<span id="cb96-315"><a href="#cb96-315" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(dadosTreino<span class="sc">$</span>classe)</span>
<span id="cb96-316"><a href="#cb96-316" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-317"><a href="#cb96-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-318"><a href="#cb96-318" aria-hidden="true" tabindex="-1"></a>Resumindo:</span>
<span id="cb96-319"><a href="#cb96-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-320"><a href="#cb96-320" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**(Intercept)**: Representa o <span class="in">`log(odds)`</span> de sobreviver para um indivíduo com todas as variáveis explicativas iguais a zero (ou a sua categoria de referência). No contexto do Titanic, seria um indivíduo do sexo feminino, com idade zero e da 1ª classe. Não tem interpretação prática direta, nesse caso, pois não há passageiros com idade zero. Serve como ponto de partida para comparar os outros coeficientes.\</span>
<span id="cb96-321"><a href="#cb96-321" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**classe2**: O coeficiente negativo indica que os passageiros da segunda classe tinham menor probabilidade de sobreviver comparados aos da primeira classe (a categoria de referência).\</span>
<span id="cb96-322"><a href="#cb96-322" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**classe3**: O coeficiente negativo) indica que os passageiros da terceira classe tinham muito menor probabilidade de sobreviver comparados aos da primeira classe.</span>
<span id="cb96-323"><a href="#cb96-323" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**sexomasc**: O coeficiente negativo indica que ser do sexo masculino diminui significativamente a probabilidade de sobreviver, comparado a ser do sexo feminino (a categoria de referência). Ou seja, os homens tinham menos chances de sobreviver.\</span>
<span id="cb96-324"><a href="#cb96-324" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**idade**: O coeficiente negativo indica que cada aumento de um ano na idade diminui ligeiramente a probabilidade de sobreviver. Isso sugere que as crianças tinham mais chances de sobreviver do que os adultos.\</span>
<span id="cb96-325"><a href="#cb96-325" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**irco** : Ter mais irmãos ou cônjuges a bordo reduziu a chance de sobrevivência.</span>
<span id="cb96-326"><a href="#cb96-326" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**pafi**: O número de pais ou filhos a bordo não teve um efeito estatisticamente significativo na sobrevivência (valor *p* alto).</span>
<span id="cb96-327"><a href="#cb96-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-328"><a href="#cb96-328" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">Outras métricas da saída do sumário do modelo</span><span class="co">]</span>{.underline}</span>
<span id="cb96-329"><a href="#cb96-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-330"><a href="#cb96-330" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Significância estatística**: o R, para facilitar, informa com asteriscos quais variáveis possuem coeficientes estatisticamente significativos: <span class="sc">\*</span> para *p* \&lt; 0,05, \*\* para *p* \&lt; 0,01, e \*\*\* para *p* <span class="sc">\&lt;</span> 0,001.\</span>
<span id="cb96-331"><a href="#cb96-331" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Deviance residual**: Indica o ajuste do modelo; quanto menor, melhor.\</span>
<span id="cb96-332"><a href="#cb96-332" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**AIC (Critério de Informação de Akaike)** <span class="ot">[^24-reglogbin-3]</span>: Ajuda a comparar modelos; quanto menor, melhor o ajuste e a simplicidade.</span>
<span id="cb96-333"><a href="#cb96-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-334"><a href="#cb96-334" aria-hidden="true" tabindex="-1"></a><span class="ot">[^24-reglogbin-3]: </span>É fundamentado na *teoria da informação*, teoria matemática da informação que estuda a quantificação, armazenamento e comunicação da informação. Quando um modelo estatístico é usado para representar um determinado processo, a representação nunca será exata, ou seja, o modelo nunca será perfeito e certamente algumas informações serão perdidas. O AIC estima a quantidade relativa de informação perdida por um determinado modelo: quanto menos informações um modelo perde, maior a qualidade desse modelo e menor a pontuação AIC.</span>
<span id="cb96-335"><a href="#cb96-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-336"><a href="#cb96-336" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Avaliação do impacto com a função anova()</span></span>
<span id="cb96-337"><a href="#cb96-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-338"><a href="#cb96-338" aria-hidden="true" tabindex="-1"></a>Além de interpretar os coeficientes, mostrados na saída do sumário do modelo gerado pela função <span class="in">`glm()`</span>, pode-se usar a função <span class="in">`anova()`</span> para observar o impacto da adição de cada variável no modelo:</span>
<span id="cb96-339"><a href="#cb96-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-342"><a href="#cb96-342" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb96-343"><a href="#cb96-343" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(modelo1, <span class="at">test=</span><span class="st">'Chisq'</span>)</span>
<span id="cb96-344"><a href="#cb96-344" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-345"><a href="#cb96-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-346"><a href="#cb96-346" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">Principais pontos</span><span class="co">]</span>{.underline}</span>
<span id="cb96-347"><a href="#cb96-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-348"><a href="#cb96-348" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**NULL Deviance**: Representa o desvio do modelo sem preditores (modelo apenas com o intercepto).</span>
<span id="cb96-349"><a href="#cb96-349" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Residual Deviance**: Indica o desvio do modelo conforme as variáveis são adicionadas. Um menor valor de deviance indica um melhor ajuste.</span>
<span id="cb96-350"><a href="#cb96-350" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Pr(\&gt;Chi)**: Valor *p* do teste qui-quadrado para cada variável, verificando se sua inclusão melhora significativamente o modelo.</span>
<span id="cb96-351"><a href="#cb96-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-352"><a href="#cb96-352" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">Interpretação das variáveis</span><span class="co">]</span>{.underline}</span>
<span id="cb96-353"><a href="#cb96-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-354"><a href="#cb96-354" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**classe**: A inclusão da classe do passageiro reduz significativamente o desvio (*deviance*), indicando que a classe é um preditor importante.</span>
<span id="cb96-355"><a href="#cb96-355" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**sexo**: O sexo é a variável que mais reduz o desvio, confirmando que ser mulher aumentava a chance de sobrevivência.</span>
<span id="cb96-356"><a href="#cb96-356" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**idade**: A idade tem um efeito significativo na sobrevivência, mas menor que classe e sexo</span>
<span id="cb96-357"><a href="#cb96-357" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**irco**: Número de irmãos/cônjuges tem um impacto relevante.</span>
<span id="cb96-358"><a href="#cb96-358" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**pafi**: O número de pais/filhos a bordo não melhora significativamente o modelo (*p* <span class="sc">\&gt;</span> 0.05), sugerindo que essa variável não tem grande impacto na sobrevivência.</span>
<span id="cb96-359"><a href="#cb96-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-360"><a href="#cb96-360" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">Conclusão</span><span class="co">]</span>{.underline}</span>
<span id="cb96-361"><a href="#cb96-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-362"><a href="#cb96-362" aria-hidden="true" tabindex="-1"></a>O modelo sugere que <span class="in">`classe`</span>, <span class="in">`sexo`</span>, <span class="in">`idade`</span> e <span class="in">`irco`</span> (número de irmãos/cônjuges) são fatores relevantes para prever a sobrevivência. Por outro lado, número de pais/filhos não tem um impacto significativo. Isso pode indicar que ter viajado com crianças não afetou tanto a probabilidade de sobrevivência.</span>
<span id="cb96-363"><a href="#cb96-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-364"><a href="#cb96-364" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Uso do Odds Ratio (OR) na interpretação dos coeficientes</span></span>
<span id="cb96-365"><a href="#cb96-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-366"><a href="#cb96-366" aria-hidden="true" tabindex="-1"></a>Numericamente, os coeficientes de regressão logística não são facilmente interpretáveis em escala bruta, pois estão representados como <span class="in">`log (odds)`</span> ou <span class="in">`logit`</span> . Para tornar mais simples, pode-se inverter a transformação logística exponenciando os coeficientes ($e^x$). Isso faz com que os coeficientes se transformem em razões de chance (*odds ratio*), ficando mais intuitivos facilitando a interpretação. Isso é realizado pela função <span class="in">`exp()`</span> e pela função <span class="in">`confint()`</span>, que retorna os intervalos de confiança de 95%:</span>
<span id="cb96-367"><a href="#cb96-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-370"><a href="#cb96-370" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb96-371"><a href="#cb96-371" aria-hidden="true" tabindex="-1"></a>odds_ratio1 <span class="ot">&lt;-</span> <span class="fu">round</span> (<span class="fu">exp</span>(<span class="fu">cbind</span>(<span class="at">OR =</span> <span class="fu">coef</span>(modelo1), <span class="fu">confint</span>(modelo1))), <span class="dv">3</span>)</span>
<span id="cb96-372"><a href="#cb96-372" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(odds_ratio1)</span>
<span id="cb96-373"><a href="#cb96-373" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-374"><a href="#cb96-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-375"><a href="#cb96-375" aria-hidden="true" tabindex="-1"></a>Observando, novamente, a variável <span class="in">`idade`</span>, vê-se que à medida que ela aumenta, reduz a chance de sobrevivência no naufrágio do Titanic. A *OR* nos informa que a cada aumento de uma unidade na <span class="in">`idade`</span>, há uma diminuição na chance de sobrevivência (<span class="in">`sobreviveu = 1`</span>) de $1 – OR \times 100$%, ou seja, uma diminuição de <span class="in">`r (1 - odds_ratio1[5, 1]) * 100`</span>%.\</span>
<span id="cb96-376"><a href="#cb96-376" aria-hidden="true" tabindex="-1"></a>Para o sexo masculino, há uma diminuição (coeficiente negativo) na chance de sobrevivência. O fato de ser homem reduz em <span class="in">`r (1 - odds_ratio1[4, 1]) * 100`</span>% a chance de sobreviver.\</span>
<span id="cb96-377"><a href="#cb96-377" aria-hidden="true" tabindex="-1"></a>Para a 3ª classe, comparada à 1ª classe, há uma diminuição de <span class="in">`r (1 - odds_ratio1[3, 1]) * 100`</span>% na chance de sobrevivência. Da mesma forma a 2ª classe, comparada à 1ª classe, tem uma diminuição de <span class="in">`r (1 - odds_ratio1[2, 1]) * 100`</span>%% na chance de sobrevivência <span class="ot">[^24-reglogbin-4]</span>.</span>
<span id="cb96-378"><a href="#cb96-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-379"><a href="#cb96-379" aria-hidden="true" tabindex="-1"></a><span class="ot">[^24-reglogbin-4]: </span>Veja mais detalhes sobre *Odds Ratio* na @sec-or.</span>
<span id="cb96-380"><a href="#cb96-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-381"><a href="#cb96-381" aria-hidden="true" tabindex="-1"></a><span class="fu">### Visualização da regressão logística</span></span>
<span id="cb96-382"><a href="#cb96-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-383"><a href="#cb96-383" aria-hidden="true" tabindex="-1"></a>Uma maneira interessante de visualizar a regressão logística, pode ser feita usando a função <span class="in">`plot_model()`</span> do pacote <span class="in">`sjPlot`</span> @ludecke2018sjplot. Essa função, como padrão, produz um gráfico de floresta (*forest plot*), onde é possível visualizar as variáveis no eixo vertical e o tamanho do efeito (OR), os coeficientes, no eixo horizontal (@fig-forest). Além disso, coeficientes positivos são representados com a cor azul e negativos em vermelho; e os intervalos de confiança 95% como uma linha ao redor do valor médio do coeficiente (ponto). Ao se especificar o tipo como <span class="in">`std`</span> em <span class="in">`plot_model()`</span>, o gráfico de floresta produzido utiliza os valores padronizados em desvios padrões.</span>
<span id="cb96-384"><a href="#cb96-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-387"><a href="#cb96-387" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb96-388"><a href="#cb96-388" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-forest</span></span>
<span id="cb96-389"><a href="#cb96-389" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb96-390"><a href="#cb96-390" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.align: "center"</span></span>
<span id="cb96-391"><a href="#cb96-391" aria-hidden="true" tabindex="-1"></a><span class="co">#| out.width: "80%"</span></span>
<span id="cb96-392"><a href="#cb96-392" aria-hidden="true" tabindex="-1"></a><span class="co">#| out.height: "80%"</span></span>
<span id="cb96-393"><a href="#cb96-393" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb96-394"><a href="#cb96-394" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb96-395"><a href="#cb96-395" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Gráfico de Floresta dos Coeficientes de uma Regressão Logística em formato Odds Ratio"</span></span>
<span id="cb96-396"><a href="#cb96-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-397"><a href="#cb96-397" aria-hidden="true" tabindex="-1"></a>forest_raw <span class="ot">&lt;-</span> <span class="fu">plot_model</span>(modelo1)</span>
<span id="cb96-398"><a href="#cb96-398" aria-hidden="true" tabindex="-1"></a>forest_std <span class="ot">&lt;-</span> <span class="fu">plot_model</span>(modelo1, <span class="at">type =</span> <span class="st">"std"</span>)</span>
<span id="cb96-399"><a href="#cb96-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-400"><a href="#cb96-400" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb96-401"><a href="#cb96-401" aria-hidden="true" tabindex="-1"></a><span class="fu">wrap_plots</span>(forest_raw, forest_std, <span class="at">nrow =</span> <span class="dv">2</span>)</span>
<span id="cb96-402"><a href="#cb96-402" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-403"><a href="#cb96-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-404"><a href="#cb96-404" aria-hidden="true" tabindex="-1"></a><span class="fu">### Remoção de variáveis não significativas</span></span>
<span id="cb96-405"><a href="#cb96-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-406"><a href="#cb96-406" aria-hidden="true" tabindex="-1"></a>A variável <span class="in">`pafi`</span> mostrou-se não significativa no ajuste do <span class="in">`modelo1`</span> e será removida da análise:</span>
<span id="cb96-407"><a href="#cb96-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-410"><a href="#cb96-410" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb96-411"><a href="#cb96-411" aria-hidden="true" tabindex="-1"></a>modelo2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(sobreviveu <span class="sc">~</span> classe <span class="sc">+</span> sexo <span class="sc">+</span> idade <span class="sc">+</span> irco, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">'logit'</span>), <span class="at">data=</span>dadosTreino)</span>
<span id="cb96-412"><a href="#cb96-412" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(modelo2)</span>
<span id="cb96-413"><a href="#cb96-413" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-414"><a href="#cb96-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-415"><a href="#cb96-415" aria-hidden="true" tabindex="-1"></a>Da mesma forma que com o <span class="in">`modelo1`</span>, pode-se calcular, para tornar a interpretação mais intutiva, as *OR*:</span>
<span id="cb96-416"><a href="#cb96-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-419"><a href="#cb96-419" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb96-420"><a href="#cb96-420" aria-hidden="true" tabindex="-1"></a>odds.ratio2 <span class="ot">=</span> <span class="fu">exp</span>(<span class="fu">cbind</span>(<span class="at">OddsRatio =</span> <span class="fu">coef</span>(modelo2),<span class="fu">confint</span>(modelo2)))</span>
<span id="cb96-421"><a href="#cb96-421" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(odds.ratio2)</span>
<span id="cb96-422"><a href="#cb96-422" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-423"><a href="#cb96-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-424"><a href="#cb96-424" aria-hidden="true" tabindex="-1"></a>Quando se compara os dois modelos para ver se houve uma melhora no ajuste, é interessante observar os AICs.</span>
<span id="cb96-425"><a href="#cb96-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-428"><a href="#cb96-428" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb96-429"><a href="#cb96-429" aria-hidden="true" tabindex="-1"></a>aic <span class="ot">&lt;-</span> <span class="fu">AIC</span>(modelo1, modelo2)</span>
<span id="cb96-430"><a href="#cb96-430" aria-hidden="true" tabindex="-1"></a>aic</span>
<span id="cb96-431"><a href="#cb96-431" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-432"><a href="#cb96-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-433"><a href="#cb96-433" aria-hidden="true" tabindex="-1"></a>O <span class="in">`modelo1`</span> tem uma AIC (<span class="in">`r round(aic[1, 2],2)`</span>) discretamente maior que a do <span class="in">`modelo2`</span> (<span class="in">`r round(aic[2, 2],2)`</span>). Isto indica que o ajuste do <span class="in">`modelo2`</span> é um pouco melhor (teve menos informação perdida no ajuste), entretanto, esta ligeira melhora não modifica a interpretação.A função <span class="in">`anova()`</span>, que a diferença entre os modelos não é significativa (*p* <span class="sc">\&gt;</span> 0.05):</span>
<span id="cb96-434"><a href="#cb96-434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-437"><a href="#cb96-437" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb96-438"><a href="#cb96-438" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(modelo1, modelo2, <span class="at">test =</span> <span class="st">"Chisq"</span>)</span>
<span id="cb96-439"><a href="#cb96-439" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-440"><a href="#cb96-440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-441"><a href="#cb96-441" aria-hidden="true" tabindex="-1"></a>Os dois modelo têm a mesma interpretação, mas o <span class="in">`modelo2`</span> ajusta melhor os dados.</span>
<span id="cb96-442"><a href="#cb96-442" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-443"><a href="#cb96-443" aria-hidden="true" tabindex="-1"></a><span class="fu">### Modelo de regreção e interação</span></span>
<span id="cb96-444"><a href="#cb96-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-445"><a href="#cb96-445" aria-hidden="true" tabindex="-1"></a>A interação entre variáveis pode ser crucial em modelos de regressão logística, pois pode revelar padrões que não são evidentes ao analisar cada variável separadamente. Usar interações pode tornar o modelo mais informativo, mas também mais complexo. Por isso, é sempre bom verificar métricas como AIC ou testes estatísticos para ver se a inclusão da interação realmente melhora a previsão.</span>
<span id="cb96-446"><a href="#cb96-446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-447"><a href="#cb96-447" aria-hidden="true" tabindex="-1"></a>Será construído um gráfico (@fig-interacao)), usando o pacote <span class="in">`ggeffects`</span> e sua função <span class="in">`ggpredict()`</span> @ludecke2018ggeffects. Este calcula os efeitos marginais a partir de modelos estatísticos e retorna o resultado como estruturas de dados organizadas. Essas estruturas de dados estão prontas para serem usadas com o pacote <span class="in">`ggplot2`</span>. Os efeitos marginais podem ser calculados para muitos modelos diferentes, incluindo termos de interação. Junto será criado o modelo de interação (<span class="in">`modelo3`</span>)</span>
<span id="cb96-448"><a href="#cb96-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-451"><a href="#cb96-451" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb96-452"><a href="#cb96-452" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-interacao</span></span>
<span id="cb96-453"><a href="#cb96-453" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb96-454"><a href="#cb96-454" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.align: "center"</span></span>
<span id="cb96-455"><a href="#cb96-455" aria-hidden="true" tabindex="-1"></a><span class="co">#| out.width: "80%"</span></span>
<span id="cb96-456"><a href="#cb96-456" aria-hidden="true" tabindex="-1"></a><span class="co">#| out.height: "80%"</span></span>
<span id="cb96-457"><a href="#cb96-457" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb96-458"><a href="#cb96-458" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb96-459"><a href="#cb96-459" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Gráfico de linha da interação sexo:classe"</span></span>
<span id="cb96-460"><a href="#cb96-460" aria-hidden="true" tabindex="-1"></a>titanic_df <span class="ot">&lt;-</span> dadosTreino <span class="sc">%&gt;%</span></span>
<span id="cb96-461"><a href="#cb96-461" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span> pafi) <span class="sc">%&gt;%</span></span>
<span id="cb96-462"><a href="#cb96-462" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">classe =</span> <span class="fu">factor</span>(classe, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>), </span>
<span id="cb96-463"><a href="#cb96-463" aria-hidden="true" tabindex="-1"></a>                         <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"1ª Classe"</span>, <span class="st">"2ª Classe"</span>, <span class="st">"3ª Classe"</span>))) </span>
<span id="cb96-464"><a href="#cb96-464" aria-hidden="true" tabindex="-1"></a>titanic_df <span class="ot">&lt;-</span> dadosTreino <span class="sc">%&gt;%</span></span>
<span id="cb96-465"><a href="#cb96-465" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span> pafi) <span class="sc">%&gt;%</span></span>
<span id="cb96-466"><a href="#cb96-466" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">classe =</span> <span class="fu">factor</span>(classe, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>), </span>
<span id="cb96-467"><a href="#cb96-467" aria-hidden="true" tabindex="-1"></a>                         <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"1ª Classe"</span>, <span class="st">"2ª Classe"</span>, <span class="st">"3ª Classe"</span>))) </span>
<span id="cb96-468"><a href="#cb96-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-469"><a href="#cb96-469" aria-hidden="true" tabindex="-1"></a>modelo3 <span class="ot">&lt;-</span> <span class="fu">glm</span>(sobreviveu <span class="sc">~</span> sexo <span class="sc">*</span> classe <span class="sc">+</span> idade <span class="sc">+</span> irco, <span class="at">data =</span> titanic_df, <span class="at">family =</span> <span class="st">"binomial"</span>)</span>
<span id="cb96-470"><a href="#cb96-470" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(modelo3)</span>
<span id="cb96-471"><a href="#cb96-471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-472"><a href="#cb96-472" aria-hidden="true" tabindex="-1"></a>pred_effects <span class="ot">&lt;-</span> <span class="fu">ggpredict</span>(modelo3, <span class="at">terms =</span> <span class="fu">c</span>(<span class="st">"classe"</span>, <span class="st">"sexo"</span>))</span>
<span id="cb96-473"><a href="#cb96-473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-474"><a href="#cb96-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-475"><a href="#cb96-475" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pred_effects, <span class="at">show_data =</span> <span class="cn">FALSE</span>, <span class="at">connect_lines =</span> T) <span class="sc">+</span></span>
<span id="cb96-476"><a href="#cb96-476" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Classe do Passageiro"</span>,</span>
<span id="cb96-477"><a href="#cb96-477" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Probabilidade Predita de Sobrevivência"</span>,</span>
<span id="cb96-478"><a href="#cb96-478" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Interação entre Sexo e Classe na Sobrevivência do Titanic"</span>, </span>
<span id="cb96-479"><a href="#cb96-479" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"Sexo"</span>) <span class="sc">+</span></span>
<span id="cb96-480"><a href="#cb96-480" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb96-481"><a href="#cb96-481" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb96-482"><a href="#cb96-482" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"right"</span>) <span class="sc">+</span></span>
<span id="cb96-483"><a href="#cb96-483" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Ajustar limites do eixo Y para probabilidades (0 a 1)</span></span>
<span id="cb96-484"><a href="#cb96-484" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.1</span>),</span>
<span id="cb96-485"><a href="#cb96-485" aria-hidden="true" tabindex="-1"></a>                     <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">add =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.05</span>)))</span>
<span id="cb96-486"><a href="#cb96-486" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-487"><a href="#cb96-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-488"><a href="#cb96-488" aria-hidden="true" tabindex="-1"></a>O gráfico da @fig-interacao sugere uma interação entre <span class="in">`classe`</span> e <span class="in">`sexo`</span> na taxa de sobrevivência.</span>
<span id="cb96-489"><a href="#cb96-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-490"><a href="#cb96-490" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Interpretação dos coeficientes gerados no modelo com interação</span></span>
<span id="cb96-491"><a href="#cb96-491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-492"><a href="#cb96-492" aria-hidden="true" tabindex="-1"></a>Interpretar os coeficientes do modelo de interação em conjunto com o gráfico da @fig-interacao é fundamental. Os coeficentes são em escala **logit** e, para melhor interpretá-lo, há necessidade de exponenciá-los:</span>
<span id="cb96-493"><a href="#cb96-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-496"><a href="#cb96-496" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb96-497"><a href="#cb96-497" aria-hidden="true" tabindex="-1"></a>odds_ratios <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="fu">cbind</span>(<span class="at">OddsRatio =</span> <span class="fu">coef</span>(modelo3), <span class="fu">confint</span>(modelo3)))</span>
<span id="cb96-498"><a href="#cb96-498" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-499"><a href="#cb96-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-500"><a href="#cb96-500" aria-hidden="true" tabindex="-1"></a>O modelo com interação (<span class="in">`modelo3`</span>) apresentou uma ajuste um pouco melhor, comparado com modelo sem interação (<span class="in">`modelo2`</span>). Para a comparação, pode-se usar o AIC de ambos os modelos:</span>
<span id="cb96-501"><a href="#cb96-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-504"><a href="#cb96-504" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb96-505"><a href="#cb96-505" aria-hidden="true" tabindex="-1"></a>aic <span class="ot">&lt;-</span> <span class="fu">AIC</span>(modelo2, modelo3)</span>
<span id="cb96-506"><a href="#cb96-506" aria-hidden="true" tabindex="-1"></a>aic</span>
<span id="cb96-507"><a href="#cb96-507" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-508"><a href="#cb96-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-509"><a href="#cb96-509" aria-hidden="true" tabindex="-1"></a>A saída mostra que existe uma diferença de <span class="in">`r round(aic[1, 2],2) - round(aic[2, 2],2)`</span> pontos. Isso é uma forte evidência que o modelo com a interação melhora o ajuste.\</span>
<span id="cb96-510"><a href="#cb96-510" aria-hidden="true" tabindex="-1"></a>O coeficiente de interação positivo como <span class="in">`r modelo3$coefficients[8]`</span> não significa que homens da 3ª classe têm alta probabilidade de sobreviver. Significa que o efeito negativo de ser homem na 3ª classe é menos grave (ou a relação da classe com a sobrevivência é diferente para homens) do que seria previsto apenas pelos efeitos principais <span class="in">`sexomasc`</span> e 3ª Classe somados linearmente. É uma correção para a relação aditiva simples.\</span>
<span id="cb96-511"><a href="#cb96-511" aria-hidden="true" tabindex="-1"></a>O gráfico mostra claramente que homens da 3ª classe têm uma probabilidade predita de sobrevivência bem baixa, que é a mais baixa de todas as categorias.</span>
<span id="cb96-512"><a href="#cb96-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-513"><a href="#cb96-513" aria-hidden="true" tabindex="-1"></a>Desta forma, a interpretação é semelhante a que foi mostrada com o modelo sem interação:</span>
<span id="cb96-514"><a href="#cb96-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-515"><a href="#cb96-515" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Ser mulher é um fator de sobrevivência extremamente forte.\</span>
<span id="cb96-516"><a href="#cb96-516" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Ser da 1ª classe é um fator de sobrevivência positivo.\</span>
<span id="cb96-517"><a href="#cb96-517" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Idade avançada e ter mais irmãos/cônjuges são fatores negativos para a sobrevivência.\</span>
<span id="cb96-518"><a href="#cb96-518" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Existe uma interação significativa onde a penalidade de ser homem (em termos de chances de sobrevivência) é diferente entre as classes, sendo muito mais forte nas classes superiores e menos acentuada (mas ainda presente) na 3ª classe (onde as chances já são globalmente baixas para todos, mas a queda de chances para mulheres da 3ª classe é mais drástica que para homens entre 2ª e 3ª).</span>
<span id="cb96-519"><a href="#cb96-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-520"><a href="#cb96-520" aria-hidden="true" tabindex="-1"></a>Portanto, deve-se manter o modelo com a interação (<span class="in">`modelo3`</span>). Ele é mais preciso e oferece uma compreensão mais detalhada das complexas relações entre sexo, classe e sobrevivência (ajustado por <span class="in">`idade`</span> e <span class="in">`irco`</span>).</span>
<span id="cb96-521"><a href="#cb96-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-522"><a href="#cb96-522" aria-hidden="true" tabindex="-1"></a>Para finalizar, será mostrada, na @fig-taxas, as taxas reais de sobrevivência, para comparar com a @fig-interacao, indicando que os homens da 3ª classe tiveram uma baixa taxa de sobrevivência, mesmo com o modelo de interação tenha mostrado um coeficiente positivo. Isto apenas mostra que atenuou o efeito.</span>
<span id="cb96-523"><a href="#cb96-523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-526"><a href="#cb96-526" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb96-527"><a href="#cb96-527" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-taxas</span></span>
<span id="cb96-528"><a href="#cb96-528" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb96-529"><a href="#cb96-529" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.align: "center"</span></span>
<span id="cb96-530"><a href="#cb96-530" aria-hidden="true" tabindex="-1"></a><span class="co">#| out.width: "60%"</span></span>
<span id="cb96-531"><a href="#cb96-531" aria-hidden="true" tabindex="-1"></a><span class="co">#| out.height: "60%"</span></span>
<span id="cb96-532"><a href="#cb96-532" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb96-533"><a href="#cb96-533" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb96-534"><a href="#cb96-534" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Proporção de sobrevivência por sexo e classe"</span></span>
<span id="cb96-535"><a href="#cb96-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-536"><a href="#cb96-536" aria-hidden="true" tabindex="-1"></a><span class="co"># Converter a variável "sobreviveu" para numérica, se necessário</span></span>
<span id="cb96-537"><a href="#cb96-537" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dadosTreino, </span>
<span id="cb96-538"><a href="#cb96-538" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> classe, </span>
<span id="cb96-539"><a href="#cb96-539" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> <span class="fu">factor</span>(sobreviveu))) <span class="sc">+</span></span>
<span id="cb96-540"><a href="#cb96-540" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">"fill"</span>) <span class="sc">+</span></span>
<span id="cb96-541"><a href="#cb96-541" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> sexo) <span class="sc">+</span></span>
<span id="cb96-542"><a href="#cb96-542" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Proporção de sobrevivência por sexo e classe"</span>,</span>
<span id="cb96-543"><a href="#cb96-543" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Classe do passageiro"</span>, </span>
<span id="cb96-544"><a href="#cb96-544" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Proporção"</span>,</span>
<span id="cb96-545"><a href="#cb96-545" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Sobrevivência"</span>) <span class="sc">+</span></span>
<span id="cb96-546"><a href="#cb96-546" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb96-547"><a href="#cb96-547" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-548"><a href="#cb96-548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-549"><a href="#cb96-549" aria-hidden="true" tabindex="-1"></a>Para comparar os modelos, estatisticamente, pode-se usar a função <span class="in">`anova()`</span> do pacote <span class="in">`car`</span>:</span>
<span id="cb96-550"><a href="#cb96-550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-553"><a href="#cb96-553" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb96-554"><a href="#cb96-554" aria-hidden="true" tabindex="-1"></a>anova <span class="ot">&lt;-</span> <span class="fu">anova</span>(modelo2, modelo3, <span class="at">test =</span> <span class="st">"Chisq"</span>)</span>
<span id="cb96-555"><a href="#cb96-555" aria-hidden="true" tabindex="-1"></a>anova</span>
<span id="cb96-556"><a href="#cb96-556" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-557"><a href="#cb96-557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-558"><a href="#cb96-558" aria-hidden="true" tabindex="-1"></a>A ANOVA mostra um valor *p* muito baixo, indicando uma diferença estatisricamente signficativa entre os modelos.</span>
<span id="cb96-559"><a href="#cb96-559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-560"><a href="#cb96-560" aria-hidden="true" tabindex="-1"></a><span class="fu">### Curva ROC para comparar os modelos {#sec-compararoc}</span></span>
<span id="cb96-561"><a href="#cb96-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-562"><a href="#cb96-562" aria-hidden="true" tabindex="-1"></a>A curva ROC é um gráfico permite explicar o desempenho do modelo avaliando a taxa de verdadeiros positivos (sensibilidade) versus a taxa de falsos positivos ($1 - especificidade$). A AUC (Área sob a Curva ROC) indica a qualidade do modelo (veja também a @sec-rocurve):</span>
<span id="cb96-563"><a href="#cb96-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-564"><a href="#cb96-564" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$AUC \approx 0.5$ $\to$ O modelo não tem poder preditivo (equivalente ao puro acaso).\</span>
<span id="cb96-565"><a href="#cb96-565" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$AUC \gt 0.7$ $\to$ Modelo razoável.\</span>
<span id="cb96-566"><a href="#cb96-566" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$AUC \gt 0.8$ $\to$ Modelo muito bom.</span>
<span id="cb96-567"><a href="#cb96-567" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$AUC \gt 0.9$ $\to$ Excelebte desempenho.</span>
<span id="cb96-568"><a href="#cb96-568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-569"><a href="#cb96-569" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Predição da variável desfecho nos modelos</span></span>
<span id="cb96-570"><a href="#cb96-570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-573"><a href="#cb96-573" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb96-574"><a href="#cb96-574" aria-hidden="true" tabindex="-1"></a>prob_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(modelo2, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb96-575"><a href="#cb96-575" aria-hidden="true" tabindex="-1"></a>prob_pred_int <span class="ot">&lt;-</span> <span class="fu">predict</span>(modelo3, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb96-576"><a href="#cb96-576" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-577"><a href="#cb96-577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-578"><a href="#cb96-578" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Crição de um objeto ROC</span></span>
<span id="cb96-579"><a href="#cb96-579" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-582"><a href="#cb96-582" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb96-583"><a href="#cb96-583" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb96-584"><a href="#cb96-584" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb96-585"><a href="#cb96-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-586"><a href="#cb96-586" aria-hidden="true" tabindex="-1"></a>roc2<span class="ot">&lt;-</span> <span class="fu">roc</span>(<span class="at">response =</span> dadosTreino<span class="sc">$</span>sobreviveu, <span class="at">predictor =</span> prob_pred) </span>
<span id="cb96-587"><a href="#cb96-587" aria-hidden="true" tabindex="-1"></a>roc3 <span class="ot">&lt;-</span> <span class="fu">roc</span>(<span class="at">response =</span> dadosTreino<span class="sc">$</span>sobreviveu, <span class="at">predictor =</span> prob_pred_int)</span>
<span id="cb96-588"><a href="#cb96-588" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-589"><a href="#cb96-589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-590"><a href="#cb96-590" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Plotar a curva ROC</span></span>
<span id="cb96-591"><a href="#cb96-591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-594"><a href="#cb96-594" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb96-595"><a href="#cb96-595" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-comparemod</span></span>
<span id="cb96-596"><a href="#cb96-596" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb96-597"><a href="#cb96-597" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.align: "center"</span></span>
<span id="cb96-598"><a href="#cb96-598" aria-hidden="true" tabindex="-1"></a><span class="co">#| out.width: "60%"</span></span>
<span id="cb96-599"><a href="#cb96-599" aria-hidden="true" tabindex="-1"></a><span class="co">#| out.height: "60%"</span></span>
<span id="cb96-600"><a href="#cb96-600" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb96-601"><a href="#cb96-601" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb96-602"><a href="#cb96-602" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Comparação das curvas ROC(modelo sem interação = preto; modelo com interação vermelho)"</span></span>
<span id="cb96-603"><a href="#cb96-603" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(roc2, </span>
<span id="cb96-604"><a href="#cb96-604" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Curva ROC"</span>, </span>
<span id="cb96-605"><a href="#cb96-605" aria-hidden="true" tabindex="-1"></a>     <span class="at">print.auc =</span> <span class="cn">TRUE</span>, </span>
<span id="cb96-606"><a href="#cb96-606" aria-hidden="true" tabindex="-1"></a>     <span class="at">legacy.axes=</span><span class="cn">TRUE</span>,</span>
<span id="cb96-607"><a href="#cb96-607" aria-hidden="true" tabindex="-1"></a>     <span class="at">print.auc.y =</span> <span class="fl">0.2</span>,</span>
<span id="cb96-608"><a href="#cb96-608" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab=</span><span class="st">"Sensibilidade"</span>,</span>
<span id="cb96-609"><a href="#cb96-609" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">"1 - Especificidade"</span>)</span>
<span id="cb96-610"><a href="#cb96-610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-611"><a href="#cb96-611" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(roc3, </span>
<span id="cb96-612"><a href="#cb96-612" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">""</span>,</span>
<span id="cb96-613"><a href="#cb96-613" aria-hidden="true" tabindex="-1"></a>     <span class="at">col=</span><span class="st">"tomato"</span>,</span>
<span id="cb96-614"><a href="#cb96-614" aria-hidden="true" tabindex="-1"></a>     <span class="at">print.auc =</span> <span class="cn">TRUE</span>, </span>
<span id="cb96-615"><a href="#cb96-615" aria-hidden="true" tabindex="-1"></a>     <span class="at">legacy.axes=</span><span class="cn">TRUE</span>,</span>
<span id="cb96-616"><a href="#cb96-616" aria-hidden="true" tabindex="-1"></a>     <span class="at">print.auc.y =</span> <span class="fl">0.1</span>,</span>
<span id="cb96-617"><a href="#cb96-617" aria-hidden="true" tabindex="-1"></a>     <span class="at">add =</span><span class="cn">TRUE</span>)</span>
<span id="cb96-618"><a href="#cb96-618" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-619"><a href="#cb96-619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-620"><a href="#cb96-620" aria-hidden="true" tabindex="-1"></a>As curvas ROC (@fig-comparemod) são muito semelhantes, com AUCs muito próximos.</span>
<span id="cb96-621"><a href="#cb96-621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-622"><a href="#cb96-622" aria-hidden="true" tabindex="-1"></a><span class="fu">### Avaliação do Modelo de Regressão Logística</span></span>
<span id="cb96-623"><a href="#cb96-623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-624"><a href="#cb96-624" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Matriz de Confusão</span></span>
<span id="cb96-625"><a href="#cb96-625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-626"><a href="#cb96-626" aria-hidden="true" tabindex="-1"></a>Primeiro foi feito o treinamento com o conjunto de dados dadosTreino. Agora, comparam-se as previsões (<span class="in">`pred_class`</span>) com os valores reais (<span class="in">`dadosTeste$sobreviveu`</span>). Para isso será necessário a função <span class="in">`confusionMatrix()`</span> do pacote <span class="in">`caret`</span>.</span>
<span id="cb96-627"><a href="#cb96-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-628"><a href="#cb96-628" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">Fazendo previsões (probabilidades)</span><span class="co">]</span>{.underline}</span>
<span id="cb96-629"><a href="#cb96-629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-632"><a href="#cb96-632" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb96-633"><a href="#cb96-633" aria-hidden="true" tabindex="-1"></a>dadosTeste <span class="ot">&lt;-</span> dadosTeste <span class="sc">%&gt;%</span></span>
<span id="cb96-634"><a href="#cb96-634" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span> pafi) <span class="sc">%&gt;%</span></span>
<span id="cb96-635"><a href="#cb96-635" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">classe =</span> <span class="fu">factor</span>(classe, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>), </span>
<span id="cb96-636"><a href="#cb96-636" aria-hidden="true" tabindex="-1"></a>                         <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"1ª Classe"</span>, <span class="st">"2ª Classe"</span>, <span class="st">"3ª Classe"</span>))) </span>
<span id="cb96-637"><a href="#cb96-637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-638"><a href="#cb96-638" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">234</span>)</span>
<span id="cb96-639"><a href="#cb96-639" aria-hidden="true" tabindex="-1"></a>pred_prob <span class="ot">&lt;-</span> <span class="fu">predict</span>(modelo3, <span class="at">newdata =</span> dadosTeste, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb96-640"><a href="#cb96-640" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-641"><a href="#cb96-641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-642"><a href="#cb96-642" aria-hidden="true" tabindex="-1"></a>A seguir, converte-se as probabilidades em classes (fatores):</span>
<span id="cb96-643"><a href="#cb96-643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-646"><a href="#cb96-646" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb96-647"><a href="#cb96-647" aria-hidden="true" tabindex="-1"></a>pred_class <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(pred_prob <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb96-648"><a href="#cb96-648" aria-hidden="true" tabindex="-1"></a>pred_class <span class="ot">&lt;-</span> <span class="fu">factor</span>(pred_class, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb96-649"><a href="#cb96-649" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-650"><a href="#cb96-650" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-651"><a href="#cb96-651" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">Criando a matriz de confusão</span><span class="co">]</span>{.underline}</span>
<span id="cb96-652"><a href="#cb96-652" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-653"><a href="#cb96-653" aria-hidden="true" tabindex="-1"></a><span class="in">```{r message=FALSE}</span></span>
<span id="cb96-654"><a href="#cb96-654" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb96-655"><a href="#cb96-655" aria-hidden="true" tabindex="-1"></a>conf_matrix <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(pred_class, </span>
<span id="cb96-656"><a href="#cb96-656" aria-hidden="true" tabindex="-1"></a>                               dadosTeste<span class="sc">$</span>sobreviveu, </span>
<span id="cb96-657"><a href="#cb96-657" aria-hidden="true" tabindex="-1"></a>                               <span class="at">positive =</span><span class="st">"1"</span>)</span>
<span id="cb96-658"><a href="#cb96-658" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(conf_matrix)</span>
<span id="cb96-659"><a href="#cb96-659" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-660"><a href="#cb96-660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-661"><a href="#cb96-661" aria-hidden="true" tabindex="-1"></a>A tabela de contingência do início da matriz de confusão, mostra a comparação dos dados preditos e os dados reais (reference) e o significado de cada célula, onde *Classe 0* representa negativo e *Classe 1*, positivo.</span>
<span id="cb96-662"><a href="#cb96-662" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-663"><a href="#cb96-663" aria-hidden="true" tabindex="-1"></a>A **Acurácia** (<span class="in">`r round(conf_matrix$overall[1],3)*100`</span>%) é a proporção de previsões corretas. O modelo tem uma alta acurácia, isso indica um bom desempenho geral. Um modelo é considerado razoavelmente bom se a precisão do modelo for superior a 70%.\</span>
<span id="cb96-664"><a href="#cb96-664" aria-hidden="true" tabindex="-1"></a>A **Sensibilidade (Recall)** é a proporção de verdadeiros positivos (VP) identificados corretamente. O modelo o modelo identifica corretamete <span class="in">`r round(conf_matrix$byClass[1], 3)*100`</span>% dos verdadeiros positivos.\</span>
<span id="cb96-665"><a href="#cb96-665" aria-hidden="true" tabindex="-1"></a>A **Especificidade** é a proporção de verdadeiros negativos(VN). O modelo reconhece <span class="in">`r round(conf_matrix$byClass[2], 3)*100`</span>% dos verdadeiros negativos.\</span>
<span id="cb96-666"><a href="#cb96-666" aria-hidden="true" tabindex="-1"></a>O **Valor P** (*McNemar’s Test*) testa se há viés significativo na classificação dos erros. O valor alto (*P* = <span class="in">`r round(conf_matrix$overall[7], 3)`</span>) sugere que os erros entre classes não são estatisticamente diferentes.\</span>
<span id="cb96-667"><a href="#cb96-667" aria-hidden="true" tabindex="-1"></a>O **Kappa** mede concordância ajustada para a distribuição dos dados. Um valor próximo de 1 indica boa concordância entre previsões e valores reais.\</span>
<span id="cb96-668"><a href="#cb96-668" aria-hidden="true" tabindex="-1"></a>O **escore F1** (não listado diretamente) representa o equilíbrio entre precisão e recall. Pode ser obtido pela equação:</span>
<span id="cb96-669"><a href="#cb96-669" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-670"><a href="#cb96-670" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb96-671"><a href="#cb96-671" aria-hidden="true" tabindex="-1"></a>F1 = 2 \times \frac{VPN \times sensibilidade}{VPN + sensibilidade}</span>
<span id="cb96-672"><a href="#cb96-672" aria-hidden="true" tabindex="-1"></a>$$\</span>
<span id="cb96-673"><a href="#cb96-673" aria-hidden="true" tabindex="-1"></a>Ou consultando <span class="in">`conf_matrix$byClass[7]`</span> (<span class="in">`r round(conf_matrix$byClass[7], 3)*100`</span>%).</span>
<span id="cb96-674"><a href="#cb96-674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-675"><a href="#cb96-675" aria-hidden="true" tabindex="-1"></a>A **Precisão (VPP)** é a proporção de previsões positivas que estavam corretas, também denomonada de valor preditivo positivo (VPP). A precisão do modelo é igual <span class="in">`r round(conf_matrix$byClass[5], 3)*100`</span>, é considerada um valor alto.</span>
<span id="cb96-676"><a href="#cb96-676" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-677"><a href="#cb96-677" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Uso da curva ROC para avaliar o modelo</span></span>
<span id="cb96-678"><a href="#cb96-678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-679"><a href="#cb96-679" aria-hidden="true" tabindex="-1"></a>Avaliar um modelo de Regressão Logística no R, usando a curva ROC/AUC também é bem direto (veja @sec-compararoc e @sec-rocurve). É uma abordagem bastante poderosa que permite visualizar os grupos no mesmo gráfico.</span>
<span id="cb96-680"><a href="#cb96-680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-681"><a href="#cb96-681" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">Obtenção das probabilidades de predição</span><span class="co">]</span>{.underline}</span>
<span id="cb96-682"><a href="#cb96-682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-683"><a href="#cb96-683" aria-hidden="true" tabindex="-1"></a>Para se obter uma curva ROC, há necessidade das probabilidades previstas pelo modelo para a classe positiva (no exemplo, o nível 1 da variável <span class="in">`sobreviveu`</span>).</span>
<span id="cb96-684"><a href="#cb96-684" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-687"><a href="#cb96-687" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb96-688"><a href="#cb96-688" aria-hidden="true" tabindex="-1"></a><span class="co"># Probabilidades de predição no conjunto de teste</span></span>
<span id="cb96-689"><a href="#cb96-689" aria-hidden="true" tabindex="-1"></a><span class="co"># O argumento 'type = "response"' garante que serão obtidas as probabilidades</span></span>
<span id="cb96-690"><a href="#cb96-690" aria-hidden="true" tabindex="-1"></a>prob_pred_teste <span class="ot">&lt;-</span> <span class="fu">predict</span>(modelo3, <span class="at">newdata =</span> dadosTeste, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb96-691"><a href="#cb96-691" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-692"><a href="#cb96-692" aria-hidden="true" tabindex="-1"></a><span class="co"># Probabilidades de predição no conjunto de treino</span></span>
<span id="cb96-693"><a href="#cb96-693" aria-hidden="true" tabindex="-1"></a>prob_pred_treino <span class="ot">&lt;-</span> <span class="fu">predict</span>(modelo3,<span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb96-694"><a href="#cb96-694" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-695"><a href="#cb96-695" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-696"><a href="#cb96-696" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">Criação de objetos ROC</span><span class="co">]</span>{.underline}</span>
<span id="cb96-697"><a href="#cb96-697" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-698"><a href="#cb96-698" aria-hidden="true" tabindex="-1"></a>A seguir, serão criados os objetos ROC necessários para a construção das curvas ROC e calcular a área sob a curva (AUC):</span>
<span id="cb96-699"><a href="#cb96-699" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-700"><a href="#cb96-700" aria-hidden="true" tabindex="-1"></a><span class="in">```{r message=FALSE, warning=FALSE}</span></span>
<span id="cb96-701"><a href="#cb96-701" aria-hidden="true" tabindex="-1"></a>roc_obj_treino <span class="ot">&lt;-</span> <span class="fu">roc</span>(<span class="at">response =</span> dadosTreino<span class="sc">$</span>sobreviveu, <span class="at">predictor =</span> prob_pred_treino) </span>
<span id="cb96-702"><a href="#cb96-702" aria-hidden="true" tabindex="-1"></a>roc_obj_teste <span class="ot">&lt;-</span> <span class="fu">roc</span>(<span class="at">response =</span> dadosTeste<span class="sc">$</span>sobreviveu, <span class="at">predictor =</span> prob_pred_teste) </span>
<span id="cb96-703"><a href="#cb96-703" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-704"><a href="#cb96-704" aria-hidden="true" tabindex="-1"></a>auc_valor_treino <span class="ot">&lt;-</span> <span class="fu">auc</span>(roc_obj_treino)</span>
<span id="cb96-705"><a href="#cb96-705" aria-hidden="true" tabindex="-1"></a>auc_valor_teste <span class="ot">&lt;-</span> <span class="fu">auc</span>(roc_obj_teste)</span>
<span id="cb96-706"><a href="#cb96-706" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-707"><a href="#cb96-707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-708"><a href="#cb96-708" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">Visualização da curva ROC</span><span class="co">]</span>{.underline}</span>
<span id="cb96-709"><a href="#cb96-709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-710"><a href="#cb96-710" aria-hidden="true" tabindex="-1"></a>Com as informações obtidas, pode-se visualizar a curva ROC. Para criar um gráfico mais atraente, será usado, agora, o pacote <span class="in">`ggplot2`</span>.\</span>
<span id="cb96-711"><a href="#cb96-711" aria-hidden="true" tabindex="-1"></a>inicialmente, serão criados dataframes com os dados para serem usados na função <span class="in">`ggplot()`</span>:</span>
<span id="cb96-712"><a href="#cb96-712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-715"><a href="#cb96-715" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb96-716"><a href="#cb96-716" aria-hidden="true" tabindex="-1"></a><span class="co"># Uma coluna chamada Model é adicionada para identificar qual curva pertence a qual modelo</span></span>
<span id="cb96-717"><a href="#cb96-717" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-718"><a href="#cb96-718" aria-hidden="true" tabindex="-1"></a><span class="co"># # Dataframe dos dados treino</span></span>
<span id="cb96-719"><a href="#cb96-719" aria-hidden="true" tabindex="-1"></a>dados_roc_treino <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb96-720"><a href="#cb96-720" aria-hidden="true" tabindex="-1"></a>  <span class="at">TFP =</span> <span class="dv">1</span> <span class="sc">-</span> roc_obj_treino<span class="sc">$</span>specificities,</span>
<span id="cb96-721"><a href="#cb96-721" aria-hidden="true" tabindex="-1"></a>  <span class="at">TVP =</span> roc_obj_treino<span class="sc">$</span>sensitivities,</span>
<span id="cb96-722"><a href="#cb96-722" aria-hidden="true" tabindex="-1"></a>  <span class="at">Model =</span> <span class="st">"Treino"</span>)</span>
<span id="cb96-723"><a href="#cb96-723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-724"><a href="#cb96-724" aria-hidden="true" tabindex="-1"></a><span class="co"># Dataframe dos dados teste</span></span>
<span id="cb96-725"><a href="#cb96-725" aria-hidden="true" tabindex="-1"></a>dados_roc_teste <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb96-726"><a href="#cb96-726" aria-hidden="true" tabindex="-1"></a>  <span class="at">TFP =</span> <span class="dv">1</span> <span class="sc">-</span> roc_obj_teste<span class="sc">$</span>specificities,</span>
<span id="cb96-727"><a href="#cb96-727" aria-hidden="true" tabindex="-1"></a>  <span class="at">TVP =</span> roc_obj_teste<span class="sc">$</span>sensitivities,</span>
<span id="cb96-728"><a href="#cb96-728" aria-hidden="true" tabindex="-1"></a>  <span class="at">Model =</span> <span class="st">"Teste"</span>)</span>
<span id="cb96-729"><a href="#cb96-729" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-730"><a href="#cb96-730" aria-hidden="true" tabindex="-1"></a>dados_roc_combinados <span class="ot">&lt;-</span> <span class="fu">rbind</span>(dados_roc_treino, dados_roc_teste)</span>
<span id="cb96-731"><a href="#cb96-731" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-732"><a href="#cb96-732" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-733"><a href="#cb96-733" aria-hidden="true" tabindex="-1"></a>Usando estes dois dataframes, obtemos a @fig-compareroc</span>
<span id="cb96-734"><a href="#cb96-734" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-737"><a href="#cb96-737" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb96-738"><a href="#cb96-738" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-compareroc</span></span>
<span id="cb96-739"><a href="#cb96-739" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb96-740"><a href="#cb96-740" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.align: "center"</span></span>
<span id="cb96-741"><a href="#cb96-741" aria-hidden="true" tabindex="-1"></a><span class="co">#| out.width: "60%"</span></span>
<span id="cb96-742"><a href="#cb96-742" aria-hidden="true" tabindex="-1"></a><span class="co">#| out.height: "60%"</span></span>
<span id="cb96-743"><a href="#cb96-743" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb96-744"><a href="#cb96-744" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb96-745"><a href="#cb96-745" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Desempenho do modelo treino e do modelo teste"</span></span>
<span id="cb96-746"><a href="#cb96-746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-747"><a href="#cb96-747" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dados_roc_combinados, </span>
<span id="cb96-748"><a href="#cb96-748" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> TFP, <span class="at">y =</span> TVP, <span class="at">color =</span> Model)) <span class="sc">+</span></span>
<span id="cb96-749"><a href="#cb96-749" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb96-750"><a href="#cb96-750" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"navy"</span>, <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb96-751"><a href="#cb96-751" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Comparação de Curvas ROC"</span>,</span>
<span id="cb96-752"><a href="#cb96-752" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Taxa de Falsos Positivos (TFP)"</span>,</span>
<span id="cb96-753"><a href="#cb96-753" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Taxa de Verdadeiros Positivos (TVP)"</span>,</span>
<span id="cb96-754"><a href="#cb96-754" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"Dados"</span>) <span class="sc">+</span> <span class="co"># Legenda para as cores</span></span>
<span id="cb96-755"><a href="#cb96-755" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fl">0.6</span>, <span class="at">y =</span> <span class="fl">0.2</span>, <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">"AUC Teste ="</span>, <span class="fu">round</span>(auc_valor_teste, <span class="dv">2</span>)),</span>
<span id="cb96-756"><a href="#cb96-756" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">"tomato"</span>, <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb96-757"><a href="#cb96-757" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fl">0.6</span>, <span class="at">y =</span> <span class="fl">0.1</span>, <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">"AUC Treino ="</span>, <span class="fu">round</span>(auc_valor_treino, <span class="dv">2</span>)),</span>
<span id="cb96-758"><a href="#cb96-758" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">"steelblue"</span>, <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb96-759"><a href="#cb96-759" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Teste"</span> <span class="ot">=</span> <span class="st">"tomato"</span>,</span>
<span id="cb96-760"><a href="#cb96-760" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"Treino"</span> <span class="ot">=</span> <span class="st">"steelblue"</span>)) <span class="sc">+</span></span>
<span id="cb96-761"><a href="#cb96-761" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb96-762"><a href="#cb96-762" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb96-763"><a href="#cb96-763" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-764"><a href="#cb96-764" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-765"><a href="#cb96-765" aria-hidden="true" tabindex="-1"></a>A **Curva ROC** mostra o quão bem seu modelo distingue entre as classes positiva e negativa em diferentes limites de classificação. Uma curva que se aproxima do canto superior esquerdo indica um modelo com bom poder de discriminação.</span>
<span id="cb96-766"><a href="#cb96-766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-767"><a href="#cb96-767" aria-hidden="true" tabindex="-1"></a>A **AUC (Area Under the Curve)** é um resumo numérico desse desempenho. Um valor de AUC de 1 significa um modelo perfeito, enquanto 0.5 indica um modelo que se comporta aleatoriamente (como jogar uma moeda para classificar). Quanto maior a AUC, melhor o desempenho geral do seu modelo em separar as classes. Em geral, uma AUC acima de 0.7 é considerada razoável, acima de 0.8 é boa e acima de 0.9 é excelente.</span>
<span id="cb96-768"><a href="#cb96-768" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-769"><a href="#cb96-769" aria-hidden="true" tabindex="-1"></a>A AUC Teste = <span class="in">`r round(auc_valor_teste, 2)`</span> é considerada **excelente**. Isso significa que o modelo tem uma capacidade muito alta de distinguir entre as classes positiva e negativa no conjunto de dados não visto (teste). Uma AUC Treino = <span class="in">`r round(auc_valor_treino, 2)`</span> também é um desempenho muito forte. A diferença entre as duas é mínima (<span class="in">`r round((auc_valor_teste - auc_valor_treino), 2)`</span>). Isso é um sinal extremamente positivo. Significa que o modelo não está sofrendo de:</span>
<span id="cb96-770"><a href="#cb96-770" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-771"><a href="#cb96-771" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Overfitting** (sobreajuste): Se houvesse *overfitting*, a AUC de treino seria significativamente mais alta que a AUC de teste, indicando que o modelo "memorizou" os dados de treino e não generaliza bem para dados novos.\</span>
<span id="cb96-772"><a href="#cb96-772" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Underfitting** (subajuste): Se houvesse *underfitting*, ambas as AUCs seriam baixas, indicando que o modelo não aprendeu os padrões nos dados.</span>
<span id="cb96-773"><a href="#cb96-773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-774"><a href="#cb96-774" aria-hidden="true" tabindex="-1"></a>Concluindo o modelo de regressão logística apresentou um excelente desempenho e está generalizando muito bem para novos dados. A performance consistente entre treino e teste é um indicativo de um modelo robusto e confiável para a tarefa de classificação.</span>
<span id="cb96-775"><a href="#cb96-775" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-776"><a href="#cb96-776" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Outras avaliações do modelo {#sec-vif}</span></span>
<span id="cb96-777"><a href="#cb96-777" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-778"><a href="#cb96-778" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">Linearidade e Colinearidade</span><span class="co">]</span>{.underline}</span>
<span id="cb96-779"><a href="#cb96-779" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-780"><a href="#cb96-780" aria-hidden="true" tabindex="-1"></a>Esta suposição pode ser testada de diversas maneiras. O pacote <span class="in">`performance`</span> (moderno e abrangente), usando a função <span class="in">`check_model()`</span> faz várias verificações que inclui a linearidade de forma visual (@fig-linearidade) e @fig-linearidade2), para preditores contínuos através de resíduos parciais. Serão avaliados os dois modelos (<span class="in">`modelo2`</span> e <span class="in">`modelo3`</span>)</span>
<span id="cb96-781"><a href="#cb96-781" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-782"><a href="#cb96-782" aria-hidden="true" tabindex="-1"></a><span class="in">```{r  message=FALSE, warning=FALSE, echo=TRUE, eval=FALSE}</span></span>
<span id="cb96-783"><a href="#cb96-783" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-784"><a href="#cb96-784" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">check_model</span>(modelo2, <span class="at">residual_type =</span> <span class="st">"normal"</span>))</span>
<span id="cb96-785"><a href="#cb96-785" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-786"><a href="#cb96-786" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-789"><a href="#cb96-789" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb96-790"><a href="#cb96-790" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-linearidade</span></span>
<span id="cb96-791"><a href="#cb96-791" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb96-792"><a href="#cb96-792" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.align: "center"</span></span>
<span id="cb96-793"><a href="#cb96-793" aria-hidden="true" tabindex="-1"></a><span class="co">#| out.width: "100%"</span></span>
<span id="cb96-794"><a href="#cb96-794" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb96-795"><a href="#cb96-795" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb96-796"><a href="#cb96-796" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Avaliação do modelo com foco na linearidade"</span></span>
<span id="cb96-797"><a href="#cb96-797" aria-hidden="true" tabindex="-1"></a> knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">"https://imgur.com/t4WqHJA.png"</span>)</span>
<span id="cb96-798"><a href="#cb96-798" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-799"><a href="#cb96-799" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-800"><a href="#cb96-800" aria-hidden="true" tabindex="-1"></a>O <span class="in">`modelo3`</span> (com interação sexo:classe) que em outras testagens ele teve um melhor ajuste, será avaliado:</span>
<span id="cb96-801"><a href="#cb96-801" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-804"><a href="#cb96-804" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb96-805"><a href="#cb96-805" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb96-806"><a href="#cb96-806" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb96-807"><a href="#cb96-807" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb96-808"><a href="#cb96-808" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb96-809"><a href="#cb96-809" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-810"><a href="#cb96-810" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">check_model</span>(modelo3, <span class="at">residual_type =</span> <span class="st">"normal"</span>))</span>
<span id="cb96-811"><a href="#cb96-811" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-812"><a href="#cb96-812" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-815"><a href="#cb96-815" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb96-816"><a href="#cb96-816" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-linearidade2</span></span>
<span id="cb96-817"><a href="#cb96-817" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb96-818"><a href="#cb96-818" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.align: "center"</span></span>
<span id="cb96-819"><a href="#cb96-819" aria-hidden="true" tabindex="-1"></a><span class="co">#| out.width: "100%"</span></span>
<span id="cb96-820"><a href="#cb96-820" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb96-821"><a href="#cb96-821" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb96-822"><a href="#cb96-822" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Avaliação do modelo com interação com foco na linearidade"</span></span>
<span id="cb96-823"><a href="#cb96-823" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">"https://i.imgur.com/hH8aPw7.png"</span>)</span>
<span id="cb96-824"><a href="#cb96-824" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-825"><a href="#cb96-825" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-826"><a href="#cb96-826" aria-hidden="true" tabindex="-1"></a>Os gráficos gerados incluem diversas verificações fundamentais que devem ser observadas comparativamente nas @fig-linearidade e @fig-linearidade2.</span>
<span id="cb96-827"><a href="#cb96-827" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-828"><a href="#cb96-828" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Verificação preditiva posterior** (*Posterior Predictive Check*) – Compara os dados observados com os preditos pelo modelo. Os intervalos do modelo devem incluir os pontos observados. Comparando os dois modelos, os pontos observados os parecem ter um alinhamento dos intervalos preditivos semelhantes.</span>
<span id="cb96-829"><a href="#cb96-829" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-830"><a href="#cb96-830" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Resíduos agrupados** (*Binned Residuals*) – Avalia se há padrões nos resíduos. Pontos vermelhos indicam desvios que podem sugerir problemas de ajuste. Aqui, o modelo de interação tem uma maior quantidade de pontos fora do intervalo de erro.</span>
<span id="cb96-831"><a href="#cb96-831" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-832"><a href="#cb96-832" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Observações Influentes** (*Influential Observations*) – Identifica pontos com alta influência no modelo, o que pode indicar necessidade de ajustes ou remoção de *outliers*. Ambos os modelos não parecem ter pontos pontos influentes. A inclusão da interação não impactou muito quais observações têm maior peso sobre o modelo.</span>
<span id="cb96-833"><a href="#cb96-833" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-834"><a href="#cb96-834" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Colinearidade** – Exibe o VIF (Fator de Inflação da Variância) das variáveis preditoras. Valores altos (acima de 5) podem indicar problemas de multicolinearidade. Na comparação dos dois modelos, este é um ponto importante, pois com a introdução da interação, os VIFs ficaram elevados. Pode significar que as variáveis interagem de forma redundante, prejudicando a interpretação dos coeficientes. O VIF pode ser também obtido para cada variável, usando a função <span class="in">`vif()`</span> do pacote <span class="in">`car`</span>:</span>
<span id="cb96-835"><a href="#cb96-835" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-838"><a href="#cb96-838" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb96-839"><a href="#cb96-839" aria-hidden="true" tabindex="-1"></a>vif_valores <span class="ot">&lt;-</span> car<span class="sc">::</span><span class="fu">vif</span>(modelo2)</span>
<span id="cb96-840"><a href="#cb96-840" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(vif_valores)</span>
<span id="cb96-841"><a href="#cb96-841" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-842"><a href="#cb96-842" aria-hidden="true" tabindex="-1"></a>vif_valores2 <span class="ot">&lt;-</span> car<span class="sc">::</span><span class="fu">vif</span>(modelo3)</span>
<span id="cb96-843"><a href="#cb96-843" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(vif_valores2)</span>
<span id="cb96-844"><a href="#cb96-844" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-845"><a href="#cb96-845" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-846"><a href="#cb96-846" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Normalidade dos Resíduos** (*Normality of Residuals*) – Usa um gráfico Q-Q para verificar se os resíduos seguem uma distribuição normal. Desvios sistemáticos podem sinalizar problemas. Ambos, como era de esperar, parecem não ter uma distribuição normal. Entretanto, ao contrário da regressão linear, a regressão logística não assume a normalidade dos resíduos. Os resíduos de um modelo de regressão logística não se distribuem normalmente, pois a variável resposta é binária (0 ou 1) e o modelo prediz probabilidades.</span>
<span id="cb96-847"><a href="#cb96-847" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-848"><a href="#cb96-848" aria-hidden="true" tabindex="-1"></a>Concluindo, com esses resultados, parece que a interação <span class="in">`sexo:classe`</span> não agregou muito ao modelo. Ela aumentou a colinearidade e fez os resíduos se tornarem menos confiáveis, sem impacto positivo claro nas previsões.</span>
<span id="cb96-849"><a href="#cb96-849" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-850"><a href="#cb96-850" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">Razão de Verossimilhança</span><span class="co">]</span>{.underline}</span>
<span id="cb96-851"><a href="#cb96-851" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-852"><a href="#cb96-852" aria-hidden="true" tabindex="-1"></a>Em estatística, a verossimilhança (**Likelihood**) de um modelo é uma medida da probabilidade de observar os dados amostrais que temos, dada uma certa configuração dos parâmetros do modelo. Em outras palavras, ela nos diz quão "provável" é que o modelo, com seus coeficientes estimados, tenha gerado os dados que observamos.</span>
<span id="cb96-853"><a href="#cb96-853" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-854"><a href="#cb96-854" aria-hidden="true" tabindex="-1"></a>No contexto da regressão logística, os parâmetros do modelo (os coeficientes $\beta$) são estimados usando o método de **máxima verossimilhança** (veja também @sec-logisticfunction). Esse método busca encontrar os valores dos coeficientes que maximizam a probabilidade de que os eventos observados (por exemplo, "sucesso" ou "fracasso" da variável dependente) tenham ocorrido.</span>
<span id="cb96-855"><a href="#cb96-855" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-856"><a href="#cb96-856" aria-hidden="true" tabindex="-1"></a>A **razão de verossimilhança (-2LL)**, ou mais precisamente, **-2 vezes o logaritmo da verossimilhança**, é uma medida de desajuste do modelo. É uma transformação do valor da verossimilhança que é mais conveniente para cálculos e interpretação.</span>
<span id="cb96-857"><a href="#cb96-857" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-858"><a href="#cb96-858" aria-hidden="true" tabindex="-1"></a>Matematicamente, ela é expressa como:$$-2LL=-2 \times ln(L)$$ Onde:</span>
<span id="cb96-859"><a href="#cb96-859" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-860"><a href="#cb96-860" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>L é a verossimilhança do modelo</span>
<span id="cb96-861"><a href="#cb96-861" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>ln é o logaritmo natural</span>
<span id="cb96-862"><a href="#cb96-862" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-863"><a href="#cb96-863" aria-hidden="true" tabindex="-1"></a>Quanto **menor** o valor de -2LL, **melhor** é o ajuste do modelo aos dados. Isso ocorre porque um modelo com um bom ajuste tem uma verossimilhança (L) maior, e como -2LL envolve o logaritmo negativo da verossimilhança, um L maior resulta em um -2LL menor.</span>
<span id="cb96-864"><a href="#cb96-864" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-865"><a href="#cb96-865" aria-hidden="true" tabindex="-1"></a>A importância do -2LL reside principalmente em sua utilização para realizar o **Teste da Razão de Verossimilhança (Likelihood Ratio Test)**. Este teste compara a qualidade do ajuste de dois modelos:</span>
<span id="cb96-866"><a href="#cb96-866" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-867"><a href="#cb96-867" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>**Modelo Nulo (ou Modelo Base)**: Um modelo mais simples, geralmente contendo apenas a constante (intercepto), sem as variáveis preditoras de interesse.</span>
<span id="cb96-868"><a href="#cb96-868" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>**Modelo Proposto**: O modelo completo que se está testando, que inclui as variáveis preditoras.</span>
<span id="cb96-869"><a href="#cb96-869" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-870"><a href="#cb96-870" aria-hidden="true" tabindex="-1"></a>O teste da razão de verossimilhança calcula a diferença entre o -2LL do modelo nulo e o -2LL do modelo proposto:</span>
<span id="cb96-871"><a href="#cb96-871" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-872"><a href="#cb96-872" aria-hidden="true" tabindex="-1"></a>$$G = (-2LL _{Modelo \ Nulo}) - (-2LL_{Modelo \ Proposto})$$ Essa estatística G segue uma distribuição qui-quadrado ($\chi^2$) com graus de liberdade iguais à diferença no número de parâmetros entre os dois modelos.Um valor G grande e estatisticamente significativo (com um p-valor baixo), indica que o modelo proposto se ajusta significativamente melhor aos dados do que o modelo nulo (sem as variáveis preditoras). Isso sugere que as variáveis independentes no modelo contribuem para explicar a variável dependente.\</span>
<span id="cb96-873"><a href="#cb96-873" aria-hidden="true" tabindex="-1"></a>O -2LL do modelo nulo (<span class="in">`Null deviance`</span>) e do modelo proposto (<span class="in">`Residual deviance`</span>) podem ser verificados através de:</span>
<span id="cb96-874"><a href="#cb96-874" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-877"><a href="#cb96-877" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb96-878"><a href="#cb96-878" aria-hidden="true" tabindex="-1"></a>modelo2<span class="sc">$</span>null.deviance</span>
<span id="cb96-879"><a href="#cb96-879" aria-hidden="true" tabindex="-1"></a>modelo2<span class="sc">$</span>deviance</span>
<span id="cb96-880"><a href="#cb96-880" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-881"><a href="#cb96-881" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-882"><a href="#cb96-882" aria-hidden="true" tabindex="-1"></a>O cálculo da estatística G (Teste da Razão de Verossimilhança) pode ser obtido, como visto pela diferença entre deviance do modelo nulo e do modelo ajustado:</span>
<span id="cb96-883"><a href="#cb96-883" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-886"><a href="#cb96-886" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb96-887"><a href="#cb96-887" aria-hidden="true" tabindex="-1"></a>estatistica_G <span class="ot">&lt;-</span> modelo2<span class="sc">$</span>null.deviance <span class="sc">-</span> modelo2<span class="sc">$</span>deviance </span>
<span id="cb96-888"><a href="#cb96-888" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(estatistica_G)</span>
<span id="cb96-889"><a href="#cb96-889" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-890"><a href="#cb96-890" aria-hidden="true" tabindex="-1"></a><span class="co"># Graus de liberdade para o teste G</span></span>
<span id="cb96-891"><a href="#cb96-891" aria-hidden="true" tabindex="-1"></a>df_G <span class="ot">&lt;-</span> modelo2<span class="sc">$</span>df.null <span class="sc">-</span> modelo2<span class="sc">$</span>df.residual</span>
<span id="cb96-892"><a href="#cb96-892" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(df_G)</span>
<span id="cb96-893"><a href="#cb96-893" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-894"><a href="#cb96-894" aria-hidden="true" tabindex="-1"></a><span class="co"># Teste de significância </span></span>
<span id="cb96-895"><a href="#cb96-895" aria-hidden="true" tabindex="-1"></a>valor_p <span class="ot">&lt;-</span> <span class="fu">format</span>(<span class="dv">1</span> <span class="sc">-</span> <span class="fu">pchisq</span>(estatistica_G, </span>
<span id="cb96-896"><a href="#cb96-896" aria-hidden="true" tabindex="-1"></a>                             <span class="at">df =</span> df_G), </span>
<span id="cb96-897"><a href="#cb96-897" aria-hidden="true" tabindex="-1"></a>                  <span class="at">sientific =</span> <span class="cn">TRUE</span>)</span>
<span id="cb96-898"><a href="#cb96-898" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(valor_p)</span>
<span id="cb96-899"><a href="#cb96-899" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-900"><a href="#cb96-900" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-901"><a href="#cb96-901" aria-hidden="true" tabindex="-1"></a>O valor *P* é extremamente baixo, isso é interpretado como uma diferença altamente significativa entre os modelos. No contexto de teste de verossimilhança, isso sugere que o modelo mais complexo se ajusta significativamente melhor do que o modelo nulo.</span>
<span id="cb96-902"><a href="#cb96-902" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-903"><a href="#cb96-903" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">Estatística $R^2$</span><span class="co">]</span>{.underline}</span>
<span id="cb96-904"><a href="#cb96-904" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-905"><a href="#cb96-905" aria-hidden="true" tabindex="-1"></a>**R ao quadrado** é uma métrica útil para a avaliação da regressão linear simples e múltipla, mas não tem o mesmo significado na regressão logística.\</span>
<span id="cb96-906"><a href="#cb96-906" aria-hidden="true" tabindex="-1"></a>Os estatísticos criaram análogos do $R^2$ para regressão logística referidas, coletivamente, como **pseudo R ao quadrado**. Este não tem a mesma interpretação, na medida em que não é simplesmente a proporção da variância explicada pelo modelo.\</span>
<span id="cb96-907"><a href="#cb96-907" aria-hidden="true" tabindex="-1"></a>Existem muitas maneiras diferentes de calcular um $R^2$ para regressão logística e nenhum consenso sobre qual é a melhor. Os dois métodos mais frequentemente relatados em softwares estatísticos são um proposto por McFadden @mcfadden1974conditional e outro por Cox-Snell @CoxSnell1989analysis. Também é bastante relatado o de Nagelkerke @nagelkerke1991note. Os valores mais altos indicam um melhor ajuste do modelo.</span>
<span id="cb96-908"><a href="#cb96-908" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-909"><a href="#cb96-909" aria-hidden="true" tabindex="-1"></a>O $R^2$ de McFadden é uma versão, baseada no *log-likelihood* para o modelo somente com o intercepto e o modelo estimado completo. O $R^2$ de Cox e Snell é baseado no l*og-likelihood* para o modelo em comparação com o *log-likelihood* para um modelo basal. No entanto, com resultados categóricos, tem um valor máximo teórico inferior a 1, mesmo para um modelo "perfeito".\</span>
<span id="cb96-910"><a href="#cb96-910" aria-hidden="true" tabindex="-1"></a>O $R^2$ de Nagelkerke é uma versão ajustada do $R^2$ de Cox e Snell que ajusta a escala da estatística para cobrir todo o intervalo de 0 a 1.\</span>
<span id="cb96-911"><a href="#cb96-911" aria-hidden="true" tabindex="-1"></a>Pode-se obter os vários valores de $R^2$, usando a função <span class="in">`PseudoR2()`</span> do pacote <span class="in">`DescTools`</span>:</span>
<span id="cb96-912"><a href="#cb96-912" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-913"><a href="#cb96-913" aria-hidden="true" tabindex="-1"></a><span class="in">```{r message=FALSE, warning=FALSE}</span></span>
<span id="cb96-914"><a href="#cb96-914" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DescTools)</span>
<span id="cb96-915"><a href="#cb96-915" aria-hidden="true" tabindex="-1"></a><span class="fu">PseudoR2</span>(modelo2, <span class="at">which =</span><span class="fu">c</span>(<span class="st">"Nagelkerke"</span>, <span class="st">"McFadden"</span>, <span class="st">"CoxSnell"</span>))</span>
<span id="cb96-916"><a href="#cb96-916" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-917"><a href="#cb96-917" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-918"><a href="#cb96-918" aria-hidden="true" tabindex="-1"></a>Como se verifica, na Saída do código, todos os valores de $R^2$ diferem ligeiramente, mas podem ser usados como medidas de tamanho de efeito para o modelo. Então, basicamente, o pseudo R quadrado pode ser interpretado como $R^2$, mas não se espera que seja tão grande. Uma regra prática, bastante útil é que o pseudo R quadrado de McFadden variando de 0,2 a 0,4 indica um ajuste muito bom do modelo @mcfadden2021quantitative.</span>
<span id="cb96-919"><a href="#cb96-919" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-920"><a href="#cb96-920" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">Pesquisa de valores atípicos e pontos de alavancagem</span><span class="co">]</span>{.underline}</span>
<span id="cb96-921"><a href="#cb96-921" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-922"><a href="#cb96-922" aria-hidden="true" tabindex="-1"></a>Um *outlier* é uma observação que não é bem prevista pelo modelo de regressão ajustado (ou seja, tem um grande resíduo positivo ou negativo). Uma observação com um alto valor de alavancagem possui uma combinação incomum de valores preditores. Ou seja, é um *outlier* no espaço do preditor.\</span>
<span id="cb96-923"><a href="#cb96-923" aria-hidden="true" tabindex="-1"></a>Uma observação influente é uma observação que tem um impacto desproporcional na determinação dos parâmetros do modelo. As observações influentes são identificadas usando uma estatística chamada *distância de Cook* ou *D de Cook*.</span>
<span id="cb96-924"><a href="#cb96-924" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-925"><a href="#cb96-925" aria-hidden="true" tabindex="-1"></a>A identificação dos *outliers* é feita essencialmente através dos resíduos padronizados @bobbitt2020residuals, com a função <span class="in">`rstandard()`</span>:</span>
<span id="cb96-926"><a href="#cb96-926" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-929"><a href="#cb96-929" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb96-930"><a href="#cb96-930" aria-hidden="true" tabindex="-1"></a>residuos_p <span class="ot">&lt;-</span> <span class="fu">rstandard</span>(modelo2)</span>
<span id="cb96-931"><a href="#cb96-931" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(residuos_p)</span>
<span id="cb96-932"><a href="#cb96-932" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-933"><a href="#cb96-933" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-934"><a href="#cb96-934" aria-hidden="true" tabindex="-1"></a>Em uma amostra normalmente distribuída, ao redor de 95% dos valores estão entre –1,96 e +1,96, 99% deve estar entre –2,58 e +2,58 e quase todos (99,9%) devem situar-se entre –3,09 e +3,09. Portanto, resíduos padronizados com um valor absoluto maior que 3 são motivo de preocupação porque em uma amostra média é improvável que aconteça um valor tão alto por acaso <span class="co">[</span><span class="ot">@field2012outliers</span><span class="co">]</span>. Na Saída da função <span class="in">`rstandard()`</span>, observa-se que os valores estão dentro de –3 e +3.</span>
<span id="cb96-935"><a href="#cb96-935" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-936"><a href="#cb96-936" aria-hidden="true" tabindex="-1"></a>Essa avaliação pode ser acompanhada de um gráfico diagnóstico, usando a função <span class="in">`plot()`</span> para o modelo <span class="in">`modelo2`</span>(para maiores detalhes veja as @sec-graphdiag e @sec-BP).</span>
<span id="cb96-937"><a href="#cb96-937" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-938"><a href="#cb96-938" aria-hidden="true" tabindex="-1"></a><span class="in">```{r #fig-graph5, warning=FALSE, out.width="60%", out.height="60%", fig.align="center", fig.cap="Gráfico diagnóstico dos resíduos e pontos de alavancagem.", fig.pos="H"}</span></span>
<span id="cb96-939"><a href="#cb96-939" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span> (modelo2, <span class="at">which =</span> <span class="dv">5</span>)</span>
<span id="cb96-940"><a href="#cb96-940" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-941"><a href="#cb96-941" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-942"><a href="#cb96-942" aria-hidden="true" tabindex="-1"></a>São produzidos vários gráficos com a função <span class="in">`plot()`</span>, mas o foco é o gráfico 5 (@fig-graph5) que confirma os achados de não existirem valores atípicos que comprometam o ajuste do modelo. A @fig-linearidade exibe um gráfico igual, sem mostrar as distância s de Cook.</span>
<span id="cb96-943"><a href="#cb96-943" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-944"><a href="#cb96-944" aria-hidden="true" tabindex="-1"></a>Para a análise dos pontos influentes, pode-se verificar os pontos de alavancagem (<span class="in">`leverage`</span>) com a função <span class="in">`hatvalues()`</span> do pacote <span class="in">`stats`</span>, incluído no R base.</span>
<span id="cb96-945"><a href="#cb96-945" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-948"><a href="#cb96-948" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb96-949"><a href="#cb96-949" aria-hidden="true" tabindex="-1"></a>hat <span class="ot">&lt;-</span> <span class="fu">hatvalues</span>(modelo2)</span>
<span id="cb96-950"><a href="#cb96-950" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span> (hat)</span>
<span id="cb96-951"><a href="#cb96-951" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-952"><a href="#cb96-952" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-953"><a href="#cb96-953" aria-hidden="true" tabindex="-1"></a>Os valores de alavancagem podem estar entre 0 (indicando que o caso não tem qualquer influência) e 1 (indicando que o caso tem grande influência). Se nenhum caso exercer influência indevida sobre o modelo, se espera que todos os valores de alavancagem estivessem próximos do valor médio. Alguns autores @hoaglin1978hat, recomendam investigar casos com valores superiores a duas vezes a média (<span class="in">`r 2*mean(hat)`</span>) como ponto de corte para identificar casos com influência indevida. Alguns valores ($\sim$ 5%) estão acima de duas vezes a média, o que se pode considerar pouco. Principalmente, porque o maior valor está bem longe do valor igual a 1 (<span class="in">`r max(hat)`</span>). É interessante fazer a análise, observando junto a *distância de Cook* para ver se um ponto é um *outlier* significativo.</span>
<span id="cb96-954"><a href="#cb96-954" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-957"><a href="#cb96-957" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb96-958"><a href="#cb96-958" aria-hidden="true" tabindex="-1"></a>cook <span class="ot">&lt;-</span> <span class="fu">cooks.distance</span>(modelo2)</span>
<span id="cb96-959"><a href="#cb96-959" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span> (cook)</span>
<span id="cb96-960"><a href="#cb96-960" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb96-961"><a href="#cb96-961" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-962"><a href="#cb96-962" aria-hidden="true" tabindex="-1"></a>Se a distância de Cook é $\lt$ 1, não há necessidade real de excluir esses valores, uma vez que não tem um grande efeito na análise de regressão @stevens1984outliers. Na @fig-graph5), verifica-se que os casos mais distantes não alcançam a distância de Cook.</span>
</code><button title="Copiar para a área de transferência" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>